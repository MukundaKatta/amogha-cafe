function io(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}function V(e){try{return localStorage.getItem(e)}catch(t){return null}}function J(e,t){try{localStorage.setItem(e,t)}catch(n){}}function Vt(e,t){navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(e).then(function(){t&&(t.textContent="Copied!")}).catch(function(){De(e,t)}):De(e,t)}function De(e,t){var n=document.createElement("textarea");n.value=e,n.style.cssText="position:fixed;opacity:0",document.body.appendChild(n),n.select();try{document.execCommand("copy"),t&&(t.textContent="Copied!")}catch(a){}document.body.removeChild(n)}var Re=0;function G(){Re=window.pageYOffset||document.documentElement.scrollTop,document.body.style.top=-Re+"px",document.body.classList.add("modal-open")}function D(){document.body.classList.remove("modal-open"),document.body.style.top="",window.scrollTo(0,Re)}Object.assign(window,{safeGetItem:V,safeCopy:Vt,fallbackCopy:De,unlockScroll:D});const jt="rzp_test_1DP5mmOlF5G5ag",Yt="+919121004999",Jt="AMOGHA CAFE & RESTAURANT",me=500,fe=49;var ee=[{name:"Bronze",min:0,color:"#cd7f32",icon:"ðŸ¥‰"},{name:"Silver",min:500,color:"#c0c0c0",icon:"ðŸ¥ˆ"},{name:"Gold",min:1e3,color:"#D4A017",icon:"ðŸ¥‡"}],Je=[{days:[1,2,3,4,5],startHour:14,endHour:17,discount:15,label:"Happy Hour â€” 15% OFF!",categories:["beverages"]},{days:[0,1,2,3,4,5,6],startHour:22,endHour:23,discount:20,label:"Late Night Deal â€” 20% OFF!",categories:["all"]}],ve={Raita:40,"Mirchi ka Salan":50,"Veg Manchurian":169,"Paneer 65":189,"Chicken 65":200,"Chicken Hot Wings":220,"Veg Spring Rolls":149,"Chicken Lollipop":230,"Paneer Butter Masala":199,"Dal Tadka":149,"Butter Chicken":249,"Chicken Curry":219,"Mutton Curry":319,"Gongura Chicken":239,"Veg Dum Biryani":199,"Chicken Dum Biryani":249,"Chicken 65 Biryani":249,"Mutton Dum Biryani":349,"Egg Biryani":199,"Paneer Biryani":229,"Paneer Tikka":209,"Chicken Seekh Kebab":229,"Tandoori Chicken":269,"Mutton Seekh Kebab":289,"Veg Hakka Noodles":169,"Chicken Hakka Noodles":199,"Egg Noodles":179,"Schezwan Noodles":189,"Veg Fried Rice":169,"Chicken Fried Rice":199,"Egg Fried Rice":179,"Schezwan Fried Rice":189,"Butter Naan":40,"Garlic Naan":50,"Tandoori Roti":30,"Butter Roti":35,"Laccha Paratha":45,Tea:30,Coffee:40,"Hot Chocolate":60,Lassi:50,Buttermilk:35,"Fresh Lime Soda":45},$e={en:{home:"Home",about:"About",menu:"Menu",specials:"Specials",gallery:"Gallery",reviews:"Reviews",contact:"Contact",signIn:"Sign In",orderNow:"Order Online",reserveTable:"Reserve Table",addToOrder:"Add to Order",yourOrder:"Your Order",clearCart:"Clear Cart",checkout:"Proceed to Checkout",orderSummary:"Order Summary",yourDetails:"Your Details",payment:"Payment",orderPlaced:"Order Placed!",thankYou:"Thank you! Your order has been received.",fullName:"Full Name",phoneNumber:"Phone Number",deliveryAddress:"Delivery Address",specialInstructions:"Special Instructions (Optional)",ourStory:"Our Story",whyChooseUs:"Why Choose Us?",ourMission:"Our Mission",search:"Search menu...",all:"All",veg:"Veg",nonVeg:"Non-Veg"},hi:{home:"à¤¹à¥‹à¤®",about:"à¤¹à¤®à¤¾à¤°à¥‡ à¤¬à¤¾à¤°à¥‡ à¤®à¥‡à¤‚",menu:"à¤®à¥‡à¤¨à¥à¤¯à¥‚",specials:"à¤¸à¥à¤ªà¥‡à¤¶à¤²",gallery:"à¤—à¥ˆà¤²à¤°à¥€",reviews:"à¤¸à¤®à¥€à¤•à¥à¤·à¤¾",contact:"à¤¸à¤‚à¤ªà¤°à¥à¤•",signIn:"à¤¸à¤¾à¤‡à¤¨ à¤‡à¤¨",orderNow:"à¤‘à¤°à¥à¤¡à¤° à¤•à¤°à¥‡à¤‚",reserveTable:"à¤Ÿà¥‡à¤¬à¤² à¤¬à¥à¤• à¤•à¤°à¥‡à¤‚",addToOrder:"à¤‘à¤°à¥à¤¡à¤° à¤®à¥‡à¤‚ à¤œà¥‹à¤¡à¤¼à¥‡à¤‚",yourOrder:"à¤†à¤ªà¤•à¤¾ à¤‘à¤°à¥à¤¡à¤°",clearCart:"à¤•à¤¾à¤°à¥à¤Ÿ à¤–à¤¾à¤²à¥€ à¤•à¤°à¥‡à¤‚",checkout:"à¤šà¥‡à¤•à¤†à¤‰à¤Ÿ à¤•à¤°à¥‡à¤‚",orderSummary:"à¤‘à¤°à¥à¤¡à¤° à¤¸à¤¾à¤°à¤¾à¤‚à¤¶",yourDetails:"à¤†à¤ªà¤•à¥€ à¤œà¤¾à¤¨à¤•à¤¾à¤°à¥€",payment:"à¤­à¥à¤—à¤¤à¤¾à¤¨",orderPlaced:"à¤‘à¤°à¥à¤¡à¤° à¤¹à¥‹ à¤—à¤¯à¤¾!",thankYou:"à¤§à¤¨à¥à¤¯à¤µà¤¾à¤¦! à¤†à¤ªà¤•à¤¾ à¤‘à¤°à¥à¤¡à¤° à¤®à¤¿à¤² à¤—à¤¯à¤¾ à¤¹à¥ˆà¥¤",fullName:"à¤ªà¥‚à¤°à¤¾ à¤¨à¤¾à¤®",phoneNumber:"à¤«à¥‹à¤¨ à¤¨à¤‚à¤¬à¤°",deliveryAddress:"à¤¡à¤¿à¤²à¥€à¤µà¤°à¥€ à¤ªà¤¤à¤¾",specialInstructions:"à¤µà¤¿à¤¶à¥‡à¤· à¤¨à¤¿à¤°à¥à¤¦à¥‡à¤¶ (à¤µà¥ˆà¤•à¤²à¥à¤ªà¤¿à¤•)",ourStory:"à¤¹à¤®à¤¾à¤°à¥€ à¤•à¤¹à¤¾à¤¨à¥€",whyChooseUs:"à¤¹à¤®à¥‡à¤‚ à¤•à¥à¤¯à¥‹à¤‚ à¤šà¥à¤¨à¥‡à¤‚?",ourMission:"à¤¹à¤®à¤¾à¤°à¤¾ à¤®à¤¿à¤¶à¤¨",search:"à¤®à¥‡à¤¨à¥à¤¯à¥‚ à¤–à¥‹à¤œà¥‡à¤‚...",all:"à¤¸à¤­à¥€",veg:"à¤¶à¤¾à¤•à¤¾à¤¹à¤¾à¤°à¥€",nonVeg:"à¤®à¤¾à¤‚à¤¸à¤¾à¤¹à¤¾à¤°à¥€"},te:{home:"à°¹à±‹à°®à±",about:"à°®à°¾ à°—à±à°°à°¿à°‚à°šà°¿",menu:"à°®à±†à°¨à±‚",specials:"à°¸à±à°ªà±†à°·à°²à±",gallery:"à°—à±à°¯à°¾à°²à°°à±€",reviews:"à°¸à°®à±€à°•à±à°·à°²à±",contact:"à°¸à°‚à°ªà±à°°à°¦à°¿à°‚à°šà°‚à°¡à°¿",signIn:"à°¸à±ˆà°¨à± à°‡à°¨à±",orderNow:"à°†à°°à±à°¡à°°à± à°šà±‡à°¯à°‚à°¡à°¿",reserveTable:"à°Ÿà±‡à°¬à±à°²à± à°¬à±à°•à± à°šà±‡à°¯à°‚à°¡à°¿",addToOrder:"à°†à°°à±à°¡à°°à±â€Œà°²à±‹ à°œà±‹à°¡à°¿à°‚à°šà°‚à°¡à°¿",yourOrder:"à°®à±€ à°†à°°à±à°¡à°°à±",clearCart:"à°•à°¾à°°à±à°Ÿà± à°–à°¾à°³à±€ à°šà±‡à°¯à°‚à°¡à°¿",checkout:"à°šà±†à°•à± à°…à°µà±à°Ÿà±",orderSummary:"à°†à°°à±à°¡à°°à± à°¸à°¾à°°à°¾à°‚à°¶à°‚",yourDetails:"à°®à±€ à°µà°¿à°µà°°à°¾à°²à±",payment:"à°šà±†à°²à±à°²à°¿à°‚à°ªà±",orderPlaced:"à°†à°°à±à°¡à°°à± à°ªà±‚à°°à±à°¤à°¯à°¿à°‚à°¦à°¿!",thankYou:"à°§à°¨à±à°¯à°µà°¾à°¦à°¾à°²à±! à°®à±€ à°†à°°à±à°¡à°°à± à°…à°‚à°¦à°¿à°‚à°¦à°¿.",fullName:"à°ªà±‚à°°à±à°¤à°¿ à°ªà±‡à°°à±",phoneNumber:"à°«à±‹à°¨à± à°¨à°‚à°¬à°°à±",deliveryAddress:"à°¡à±†à°²à°¿à°µà°°à±€ à°šà°¿à°°à±à°¨à°¾à°®à°¾",specialInstructions:"à°ªà±à°°à°¤à±à°¯à±‡à°• à°¸à±‚à°šà°¨à°²à± (à°à°šà±à°›à°¿à°•à°‚)",ourStory:"à°®à°¾ à°•à°¥",whyChooseUs:"à°®à°®à±à°®à°²à±à°¨à°¿ à°Žà°‚à°¦à±à°•à± à°Žà°‚à°šà±à°•à±‹à°µà°¾à°²à°¿?",ourMission:"à°®à°¾ à°²à°•à±à°·à±à°¯à°‚",search:"à°®à±†à°¨à±‚ à°µà±†à°¤à°•à°‚à°¡à°¿...",all:"à°…à°¨à±à°¨à±€",veg:"à°¶à°¾à°•à°¾à°¹à°¾à°°à°‚",nonVeg:"à°®à°¾à°‚à°¸à°¾à°¹à°¾à°°à°‚"}},te=[],tt={"Chicken Dum Biryani":["Raita","Mirchi ka Salan","Buttermilk"],"Chicken 65 Biryani":["Raita","Mirchi ka Salan","Fresh Lime Soda"],"Veg Dum Biryani":["Raita","Dal Tadka","Lassi"],"Mutton Dum Biryani":["Raita","Mirchi ka Salan","Buttermilk"],"Egg Biryani":["Raita","Buttermilk"],"Paneer Biryani":["Raita","Dal Tadka"],"Butter Chicken":["Butter Naan","Garlic Naan","Laccha Paratha"],"Paneer Butter Masala":["Butter Naan","Garlic Naan","Tandoori Roti"],"Chicken Curry":["Butter Naan","Butter Roti","Veg Fried Rice"],"Mutton Curry":["Butter Naan","Laccha Paratha"],"Gongura Chicken":["Butter Naan","Tandoori Roti"],"Dal Tadka":["Butter Naan","Tandoori Roti","Veg Fried Rice"],"Chicken 65":["Chicken Dum Biryani","Fresh Lime Soda"],"Paneer 65":["Veg Dum Biryani","Lassi"],"Veg Manchurian":["Veg Hakka Noodles","Veg Fried Rice"],"Chicken Hot Wings":["Fresh Lime Soda","Chicken Hakka Noodles"],"Chicken Lollipop":["Chicken Dum Biryani","Fresh Lime Soda"],"Veg Hakka Noodles":["Veg Manchurian","Veg Spring Rolls"],"Chicken Hakka Noodles":["Chicken 65","Fresh Lime Soda"]};function M(){return window.db}function ge(e){for(var t=ee.length-1;t>=0;t--)if(e>=ee[t].min)return ee[t];return ee[0]}function $t(e){var t=A();if(t){var n=Math.floor(e/10),a=new Date().toISOString().split("T")[0],o=t.orderDates||[];if(o[o.length-1]!==a&&o.push(a),o.length>=3){var r=o.slice(-3),i=new Date(r[0]),s=new Date(r[1]),l=new Date(r[2]),c=(s-i)/864e5,d=(l-s)/864e5;c===1&&d===1&&(n=n*2)}o.length>30&&(o=o.slice(-30));var p=(t.loyaltyPoints||0)+n,g=ge(t.loyaltyPoints||0),h=ge(p);t.loyaltyPoints=p,t.loyaltyTier=h.name,t.orderDates=o,_(t);var x=M();x&&x.collection("users").doc(t.phone).update({loyaltyPoints:p,loyaltyTier:h.name,orderDates:o}).catch(function(L){console.error("Loyalty tier update error:",L)});var C=n>Math.floor(e/10)?" (2x Streak Bonus!)":"";k("+"+n+" loyalty points earned!"+C),h.name!==g.name&&setTimeout(function(){k("Congratulations! You are now "+h.icon+" "+h.name+" tier!"),typeof launchConfetti=="function"&&launchConfetti()},2e3),Fe()}}function Fe(){var e=document.getElementById("loyalty-widget");if(e){var t=A();if(!t){e.style.display="none";return}var n=t.loyaltyPoints||0,a=ge(n);e.style.display="flex",e.innerHTML='<span class="loyalty-icon">'+a.icon+'</span><span class="loyalty-pts">'+n+" pts</span>",e.title=a.name+" Tier | "+n+" Points | Redeem 100pts = Rs.10 off",e.style.cursor="pointer",e.onclick=function(){nt()}}}function nt(){var e=A();if(!e){typeof window.openAuthModal=="function"&&window.openAuthModal();return}for(var t=e.loyaltyPoints||0,n=ge(t),a=null,o=0;o<ee.length;o++)if(ee[o].min>t){a=ee[o];break}var r=document.getElementById("loyalty-modal");r||(r=document.createElement("div"),r.id="loyalty-modal",r.className="modal",r.innerHTML='<div class="modal-content loyalty-modal-content"></div>',document.body.appendChild(r),r.addEventListener("click",function(c){c.target===r&&(r.style.display="none")}));var i=a?Math.min(100,(t-n.min)/(a.min-n.min)*100):100,s=a?'<p class="loyalty-next">'+(a.min-t)+" points to "+a.icon+" "+a.name+"</p>":'<p class="loyalty-next">You have reached the highest tier!</p>',l=Math.floor(t/100)*10;r.querySelector(".loyalty-modal-content").innerHTML='<span class="close" onclick="document.getElementById(\'loyalty-modal\').style.display=\'none\'">&times;</span><div class="loyalty-header"><div class="loyalty-tier-badge" style="background:'+n.color+'">'+n.icon+" "+n.name+"</div><h2>"+t+' Points</h2></div><div class="loyalty-progress-bar"><div class="loyalty-progress-fill" style="width:'+i+"%;background:"+n.color+'"></div></div>'+s+'<div class="loyalty-info"><div class="loyalty-info-row"><span>Redeemable Value</span><span>Rs.'+l+'</span></div><div class="loyalty-info-row"><span>Points per Rs.10 spent</span><span>1 point</span></div><div class="loyalty-info-row"><span>3-Day Streak Bonus</span><span>2x points</span></div></div><div class="loyalty-tiers-list">'+ee.map(function(c){var d=c.name===n.name?" active":"";return'<div class="loyalty-tier-item'+d+'"><span>'+c.icon+" "+c.name+"</span><span>"+c.min+"+ pts</span></div>"}).join("")+"</div>",r.style.display="block"}function Xt(){var e=document.getElementById("loyalty-modal");e&&(e.style.display="none")}function Kt(){setTimeout(Fe,500)}function at(e){if(!e||!e.dob)return!1;var t=new Date,n=new Date(e.dob);return t.getMonth()===n.getMonth()}function Ie(e){if(!(!e||!at(e))&&!document.getElementById("birthday-banner")){var t=(e.name||"Guest").split(" ")[0],n=document.createElement("div");n.id="birthday-banner",n.className="birthday-banner",n.innerHTML='<span class="birthday-banner-icon">&#127874;</span><span class="birthday-banner-text">Happy Birthday, '+t+'! Enjoy special offers this month!</span><button class="birthday-banner-close" onclick="closeBirthdayBanner()">&times;</button>';var a=document.querySelector("header")||document.querySelector("nav");a&&a.nextSibling?a.parentNode.insertBefore(n,a.nextSibling):document.body.insertBefore(n,document.body.firstChild)}}function Qt(){var e=document.getElementById("birthday-banner");e&&(e.style.opacity="0",e.style.transform="translateY(-100%)",setTimeout(function(){e.parentNode&&e.parentNode.removeChild(e)},400))}Object.assign(window,{openLoyaltyModal:nt,closeLoyaltyModal:Xt,updateLoyaltyWidget:Fe,awardLoyaltyPoints:$t,getLoyaltyTier:ge,checkBirthdayRewards:at,showBirthdayBanner:Ie,closeBirthdayBanner:Qt});function A(){try{const e=V("amoghaUser");return e?JSON.parse(e):null}catch(e){return null}}function _(e){J("amoghaUser",JSON.stringify(e));var t=M();e&&e.phone&&typeof t<"u"&&t&&!window._notifListenerActive&&(window._notifListenerActive=!0,t.collection("notifications").where("userPhone","==",e.phone).where("read","==",!1).onSnapshot(function(n){n.docChanges().forEach(function(a){if(a.type==="added"){var o=a.doc.data();typeof sendPushNotification=="function"&&sendPushNotification(o.title,o.body),a.doc.ref.update({read:!0})}})},function(n){console.error("Notification listener error:",n)}))}function Zt(){const e=A();if(e){confirm("Signed in as "+(e.name||"Guest")+"\n\nDo you want to sign out?")&&rt();return}document.getElementById("auth-modal").style.display="block",G(),ot("signup")}function re(){document.getElementById("auth-modal").style.display="none",D(),document.getElementById("signup-name").value="",document.getElementById("signup-phone").value="",document.getElementById("signup-password").value="",document.getElementById("signin-phone").value="",document.getElementById("signin-password").value="",document.getElementById("signup-msg").textContent="",document.getElementById("signup-msg").className="auth-msg",document.getElementById("signin-msg").textContent="",document.getElementById("signin-msg").className="auth-msg",document.getElementById("forgot-phone").value="",document.getElementById("forgot-name").value="",document.getElementById("forgot-new-password").value="",document.getElementById("forgot-confirm-password").value="",document.getElementById("forgot-msg").textContent="",document.getElementById("forgot-msg").className="auth-msg",document.getElementById("forgot-step-1").style.display="",document.getElementById("forgot-step-2").style.display="none",Ee=null}function ot(e){document.querySelectorAll(".auth-view").forEach(t=>t.classList.remove("active")),document.getElementById("auth-"+e).classList.add("active")}function en(){var e=document.getElementById("signup-name").value.trim(),t=document.getElementById("signup-phone").value.trim(),n=document.getElementById("signup-password").value,a=document.getElementById("signup-msg");if(!e){a.textContent="Please enter your name.",a.className="auth-msg error";return}if(!/^\d{10}$/.test(t)){a.textContent="Please enter a valid 10-digit phone number.",a.className="auth-msg error";return}if(!/^\d{4}$/.test(n)){a.textContent="Please enter a 4-digit PIN.",a.className="auth-msg error";return}a.textContent="Creating account...",a.className="auth-msg";var o=M();if(typeof o>"u"||!o){a.textContent="Service unavailable. Please refresh and try again.",a.className="auth-msg error";return}o.collection("users").doc(t).get().then(function(r){if(r.exists){a.textContent="This phone number is already registered. Please sign in.",a.className="auth-msg error";return}var i={name:e,phone:t,pin:n,usedWelcomeBonus:!1,createdAt:new Date().toISOString()};return o.collection("users").doc(t).set(i).then(function(){try{_(i),ke(i),ye(),re(),k("Welcome, "+(e||"Guest")+"! 25% off applied to your first order!"),setTimeout(function(){Ie(i)},500);var s=document.getElementById("signup-referral"),l=s?s.value.trim():"";l&&setTimeout(function(){typeof applyReferralAtSignup=="function"&&applyReferralAtSignup(l)},2e3)}catch(c){console.error("SignUp UI error:",c),re(),k("Account created successfully!")}})}).catch(function(r){console.error("SignUp error:",r);var i=r.code==="permission-denied"?"Access denied. Please contact support.":"Connection error. Please check your internet and try again.";a.textContent=i+" ("+(r.code||r.message||"unknown")+")",a.className="auth-msg error"})}function tn(){var e=document.getElementById("signin-phone").value.trim(),t=document.getElementById("signin-password").value,n=document.getElementById("signin-msg");if(!/^\d{10}$/.test(e)){n.textContent="Please enter a valid 10-digit phone number.",n.className="auth-msg error";return}if(!/^\d{4}$/.test(t)){n.textContent="Please enter your 4-digit PIN.",n.className="auth-msg error";return}n.textContent="Signing in...",n.className="auth-msg";var a=M();if(typeof a>"u"||!a){n.textContent="Service unavailable. Please refresh and try again.",n.className="auth-msg error";return}a.collection("users").doc(e).get().then(function(o){if(!o.exists){n.textContent="No account found with this number. Please sign up.",n.className="auth-msg error";return}var r=o.data();if((r.pin||r.password)!==t){n.textContent="Incorrect PIN. Please try again.",n.className="auth-msg error";return}try{_(r),ke(r),ye(),re();var i=r.name||"Guest",s=r.usedWelcomeBonus?"":" Your 25% welcome bonus is still active!";k("Welcome back, "+i+"!"+s),setTimeout(function(){Ie(r)},500)}catch(l){console.error("SignIn UI error:",l),re(),k("Signed in successfully!")}}).catch(function(o){console.error("SignIn error:",o),n.textContent="Connection error. Please check your internet and try again.",n.className="auth-msg error"})}var Ee=null;function nn(){var e=document.getElementById("forgot-phone").value.trim(),t=document.getElementById("forgot-name").value.trim(),n=document.getElementById("forgot-msg");if(!/^\d{10}$/.test(e)){n.textContent="Please enter a valid 10-digit phone number.",n.className="auth-msg error";return}if(!t){n.textContent="Please enter your registered name.",n.className="auth-msg error";return}n.textContent="Verifying...",n.className="auth-msg";var a=M();if(typeof a>"u"||!a){n.textContent="Service unavailable. Please refresh and try again.",n.className="auth-msg error";return}a.collection("users").doc(e).get().then(function(o){if(!o.exists){n.textContent="No account found with this phone number.",n.className="auth-msg error";return}var r=o.data();if(r.name.toLowerCase()!==t.toLowerCase()){n.textContent="Name does not match our records.",n.className="auth-msg error";return}Ee=e,n.textContent="",n.className="auth-msg",document.getElementById("forgot-step-1").style.display="none",document.getElementById("forgot-step-2").style.display="block"}).catch(function(o){console.error("Forgot password error:",o),n.textContent=o.code==="permission-denied"?"Access denied. Please contact support.":"Network error. Please check your connection and try again.",n.className="auth-msg error"})}function an(){var e=document.getElementById("forgot-new-password").value,t=document.getElementById("forgot-confirm-password").value,n=document.getElementById("forgot-msg");if(!/^\d{4}$/.test(e)){n.textContent="Please enter a 4-digit PIN.",n.className="auth-msg error";return}if(e!==t){n.textContent="PINs do not match.",n.className="auth-msg error";return}n.textContent="Resetting PIN...",n.className="auth-msg";var a=M();if(typeof a>"u"||!a){n.textContent="Service unavailable. Please refresh and try again.",n.className="auth-msg error";return}a.collection("users").doc(Ee).update({pin:e}).then(function(){Ee=null,n.textContent="",n.className="auth-msg",re(),k("PIN reset successful! Please sign in.")}).catch(function(){n.textContent="Something went wrong. Please try again.",n.className="auth-msg error"})}function rt(){try{localStorage.removeItem("amoghaUser")}catch(t){}const e=document.getElementById("signin-btn");e.className="signin-nav-btn",e.innerHTML='<svg class="signin-icon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/><circle cx="12" cy="7" r="4"/></svg><span id="signin-text">Sign In</span>',ye(),typeof updateLoyaltyWidget=="function"&&updateLoyaltyWidget(),k("You have been signed out.")}function ke(e){const t=document.getElementById("signin-btn");if(!(!t||!e)){var n=e.name||"Guest",a=n.split(" ").filter(function(o){return o.length>0}).map(function(o){return o[0]}).join("").toUpperCase().slice(0,2)||"G";t.className="signin-nav-btn signed-in",t.innerHTML='<span class="user-avatar">'+a+'</span><span id="signin-text">'+n.split(" ")[0]+'</span><div class="user-dropdown" id="user-dropdown"><a href="#" onclick="event.preventDefault();event.stopPropagation();openProfileModal()">My Profile</a><a href="#" onclick="event.preventDefault();event.stopPropagation();signOut()">Sign Out</a></div>',t.onclick=function(o){o.preventDefault();var r=document.getElementById("user-dropdown");r&&r.classList.toggle("show")},typeof updateLoyaltyWidget=="function"&&updateLoyaltyWidget()}}function on(e,t){var n=document.getElementById(e),a=t.querySelector(".eye-open"),o=t.querySelector(".eye-closed");n.type==="password"?(n.type="text",a.style.display="none",o.style.display=""):(n.type="password",a.style.display="",o.style.display="none")}function k(e){var t=document.getElementById("auth-toast");t||(t=document.createElement("div"),t.id="auth-toast",document.body.appendChild(t)),t.textContent=e,t.classList.remove("visible"),t.offsetWidth,t.classList.add("visible"),setTimeout(function(){t.classList.remove("visible")},4e3)}function ye(){var e=document.getElementById("carousel-greeting");if(e){var t=A();t&&t.name?e.textContent="Hey "+t.name.split(" ")[0]+", ":e.textContent=""}}function rn(){try{const t=V("amoghaUser");if(t){var e=JSON.parse(t);ke(e),setTimeout(function(){Ie(e)},1e3)}ye()}catch(t){console.error("Auth restore error:",t)}window.addEventListener("click",function(t){var n=document.getElementById("auth-modal");t.target===n&&re();var a=document.getElementById("user-dropdown");a&&a.classList.contains("show")&&!t.target.closest(".signin-nav-btn")&&a.classList.remove("show")}),setTimeout(function(){var t=document.getElementById("signup-form");if(!(!t||t.dataset.refEnhanced==="true")){t.dataset.refEnhanced="true";var n=t.querySelector(".password-field");if(n){var a=document.createElement("input");a.type="text",a.id="signup-referral",a.placeholder="Referral Code (Optional)",a.maxLength=20,a.style.textTransform="uppercase",n.after(a)}}},1e3),setTimeout(function(){var t=document.getElementById("signin-btn");if(t){var n=document.createElement("div");n.id="user-dropdown",n.className="user-dropdown",n.innerHTML='<button onclick="openMyOrders(); closeUserDropdown();">My Orders</button><button onclick="openReferralModal(); closeUserDropdown();">Refer a Friend</button><button onclick="openLoyaltyModal(); closeUserDropdown();">Loyalty Points</button><button onclick="openAuthModal(); closeUserDropdown();">Sign Out</button>',t.parentElement.style.position="relative",t.parentElement.appendChild(n),t.addEventListener("click",function(a){var o=A();o&&(a.preventDefault(),a.stopPropagation(),n.classList.toggle("visible"))}),document.addEventListener("click",function(a){t.parentElement.contains(a.target)||n.classList.remove("visible")})}},1e3)}function sn(){var e=document.getElementById("user-dropdown");e&&e.classList.remove("visible")}Object.assign(window,{openAuthModal:Zt,closeAuthModal:re,switchAuthView:ot,handleSignUp:en,handleSignIn:tn,handleForgotPassword:nn,handleResetPassword:an,signOut:rt,updateSignInUI:ke,togglePassword:on,showAuthToast:k,updateCarouselGreeting:ye,closeUserDropdown:sn});let I=[];var le=[];function ln(){try{var e=localStorage.getItem("addons_cache");if(e){var t=JSON.parse(e);if(t.ts&&Date.now()-t.ts<6e5&&t.data){le.push(...t.data);return}}}catch(a){}var n=M();n&&n.collection("addons").where("active","==",!0).orderBy("sortOrder").get().then(function(a){a.forEach(function(o){le.push(o.data())});try{localStorage.setItem("addons_cache",JSON.stringify({ts:Date.now(),data:le}))}catch(o){}}).catch(function(){})}var U=null,ne=[];function cn(){try{const t=V("amoghaCart");if(t){var e=JSON.parse(t);I.length=0,e.forEach(function(n){I.push(n)}),K()}}catch(t){I.length=0}}function ae(){J("amoghaCart",JSON.stringify(I))}function K(){const e=I.reduce((n,a)=>n+a.quantity,0);var t=document.getElementById("cart-count");t&&(t.textContent=e)}function ie(e,t,n){I.length===0&&!A()&&gn();var a="medium";if(n){var o=n.closest(".menu-item-card");if(o){var r=o.querySelector(".spice-level.active");r&&(a=r.textContent.trim().toLowerCase())}}if(le.length>0){U={name:e,price:parseFloat(t),spiceLevel:a,btnEl:n},ne.length=0,un(e,parseFloat(t));return}Le(e,parseFloat(t),a,[],n)}function dn(e){var t=document.getElementById("cart-icon");if(!(!e||!t)){var n=e.getBoundingClientRect(),a=t.getBoundingClientRect(),o=document.createElement("div");o.className="cart-fly-item",o.style.left=n.left+n.width/2-6+"px",o.style.top=n.top+n.height/2-6+"px",document.body.appendChild(o),requestAnimationFrame(function(){o.style.transition="left 0.55s cubic-bezier(0.4,0,0.2,1), top 0.55s cubic-bezier(0.4,0,0.2,1), opacity 0.55s, transform 0.55s",o.style.left=a.left+a.width/2-6+"px",o.style.top=a.top+a.height/2-6+"px",o.style.opacity="0",o.style.transform="scale(0.3)"}),setTimeout(function(){o.remove()},600),t.classList.remove("cart-jiggle"),t.offsetWidth,t.classList.add("cart-jiggle"),setTimeout(function(){t.classList.remove("cart-jiggle")},400)}}function Le(e,t,n,a,o){var r=a.map(function(s){return s.name}).sort().join(","),i=I.find(function(s){var l=(s.addons||[]).map(function(c){return c.name}).sort().join(",");return s.name===e&&s.spiceLevel===n&&l===r});i?i.quantity++:I.push({name:e,price:t,quantity:1,spiceLevel:n,addons:a||[]}),o&&(o.classList.remove("cart-adding"),o.offsetWidth,o.classList.add("cart-adding"),dn(o)),K(),ae(),se(e),oe(),_e();try{window.analytics&&window.analytics.logEvent("add_to_cart",{item_name:e,value:t})}catch(s){}}function un(e,t){var n=document.getElementById("addon-picker-overlay"),a=document.getElementById("addon-item-name"),o=document.getElementById("addon-sheet-list");a.textContent=e+" â€” â‚¹"+t,o.innerHTML=le.map(function(r,i){return'<div class="addon-option" data-idx="'+i+'" onclick="toggleAddonOption(this, '+i+')"><div class="addon-checkbox"></div><div class="addon-option-info"><div class="addon-option-name">'+r.name+'</div><div class="addon-option-cat">'+(r.category||"")+'</div></div><div class="addon-option-price">+â‚¹'+r.price+"</div></div>"}).join(""),it(),n.style.display="flex"}function mn(e,t){e.classList.toggle("selected");var n=le[t],a=e.querySelector(".addon-checkbox");if(e.classList.contains("selected"))ne.push({name:n.name,price:n.price}),a.textContent="âœ“";else{var o=ne.findIndex(function(r){return r.name===n.name});o!==-1&&ne.splice(o,1),a.textContent=""}it()}function it(){if(U){var e=ne.reduce(function(n,a){return n+a.price},0),t=U.price+e;document.getElementById("addon-total").textContent="Total: â‚¹"+t}}function fn(){document.getElementById("addon-picker-overlay").style.display="none",U&&(Le(U.name,U.price,U.spiceLevel,[]),U=null,ne.length=0)}function pn(){if(U){var e=U,t=ne.slice();U=null,ne.length=0,document.getElementById("addon-picker-overlay").style.display="none",Le(e.name,e.price,e.spiceLevel,t)}}function vn(e){var t=e.closest(".add-to-cart")||e,n=document.createElement("span");n.className="atc-checkmark",n.textContent="âœ“",t.appendChild(n),setTimeout(function(){n.remove()},800)}function gn(){var e=document.getElementById("signin-prompt");e||(e=document.createElement("div"),e.id="signin-prompt",e.innerHTML='<div class="signin-prompt-content"><span class="signin-prompt-icon">ðŸŽ‰</span><div class="signin-prompt-text"><strong>Sign up & get 25% OFF!</strong><span>Create an account to unlock your welcome bonus</span></div><button class="signin-prompt-btn" onclick="closeSignInPrompt(); openAuthModal();">Sign Up</button><button class="signin-prompt-close" onclick="closeSignInPrompt()">&times;</button></div>',document.body.appendChild(e)),e.classList.remove("visible"),e.offsetWidth,e.classList.add("visible"),setTimeout(function(){st()},8e3)}function st(){var e=document.getElementById("signin-prompt");e&&e.classList.remove("visible")}function se(e){document.querySelectorAll(".add-to-cart").forEach(t=>{if(t.dataset.item===e){const n=I.find(o=>o.name===e),a=n?n.quantity:0;a>0&&!t.classList.contains("has-qty")?(t.classList.add("has-qty"),t.innerHTML='<span class="qty-minus" data-item="'.concat(e,'">âˆ’</span><span class="qty-count">').concat(a,'</span><span class="qty-plus" data-item="').concat(e,'">+</span>')):a>0?t.querySelector(".qty-count").textContent=a:(t.classList.remove("has-qty"),t.innerHTML="Add to Order")}})}function yn(){I.forEach(e=>se(e.name))}function oe(){let e=document.getElementById("floating-cart");e||(e=document.createElement("div"),e.id="floating-cart",e.innerHTML='\n            <div class="fc-header">\n                <span class="fc-title">Your Order</span>\n                <span class="fc-close" onclick="closeFloatingCart()">&times;</span>\n            </div>\n            <div class="fc-items"></div>\n            <div class="fc-footer">\n                <span class="fc-total"></span>\n                <button class="fc-checkout" onclick="document.getElementById(\'cart-icon\').click(); closeFloatingCart();">View Cart</button>\n            </div>\n        ',document.body.appendChild(e));const t=e.querySelector(".fc-items"),n=e.querySelector(".fc-total");if(I.length===0){e.classList.remove("visible"),xe();return}let a="",o=0;I.forEach(r=>{const i=r.price*r.quantity;o+=i,a+='<div class="fc-item"><span>'.concat(r.name," x").concat(r.quantity,"</span><span>â‚¹").concat(i,"</span></div>")}),t.innerHTML=a,n.textContent="Total: â‚¹".concat(o),e.classList.add("visible"),xe()}function _e(){var e=document.getElementById("floating-cart-bar");if(e){var t=I.reduce(function(i,s){return i+s.quantity},0),n=I.reduce(function(i,s){return i+s.price*s.quantity},0);if(t===0){e.classList.remove("visible");return}var a=e.querySelector(".floating-cart-count"),o=e.querySelector(".floating-cart-total"),r=e.querySelector(".floating-cart-label");a&&(a.textContent=t),o&&(o.textContent="â‚¹"+n),r&&(r.textContent=t===1?"1 item":t+" items"),e.classList.add("visible")}}function xe(e){var t=document.getElementById("cart-fab");t||(t=document.createElement("div"),t.id="cart-fab",t.className="cart-fab",t.innerHTML='<svg viewBox="0 0 24 24"><path d="M6 2L3 6v14a2 2 0 002 2h14a2 2 0 002-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/><path d="M16 10a4 4 0 01-8 0"/></svg><span class="cart-fab-badge">0</span>',t.addEventListener("click",function(){var o=document.getElementById("cart-icon");o&&o.click()}),document.body.appendChild(t));var n=t.querySelector(".cart-fab-badge"),a=I.reduce(function(o,r){return o+r.quantity},0);a>0?(n.textContent=a,t.classList.add("visible"),t.classList.remove("pop"),t.offsetWidth,t.classList.add("pop")):t.classList.remove("visible")}function hn(){const e=document.getElementById("floating-cart");e&&e.classList.remove("visible")}function he(){const e=document.getElementById("cart-items");if(!e)return;if(I.length===0){e.innerHTML='<div class="empty-cart">Your cart is empty</div>';var t=document.getElementById("subtotal-amount"),n=document.getElementById("total-amount");t&&(t.textContent="0.00"),n&&(n.textContent="0.00");return}let a="",o=0;I.forEach((c,d)=>{const p=(c.addons||[]).reduce((C,L)=>C+L.price,0),g=(c.price+p)*c.quantity;o+=g;const h=c.spiceLevel&&c.spiceLevel!=="medium"?' <span style="font-size:0.7rem;color:#e67e22">('+c.spiceLevel+")</span>":"",x=(c.addons||[]).map(C=>'<span style="font-size:0.7rem;color:var(--gold,#D4A017)">+ '+C.name+" â‚¹"+C.price+"</span>").join(" ");a+='\n            <div class="cart-item">\n                <div class="cart-item-info">\n                    <div class="cart-item-name">'.concat(c.name).concat(h,"</div>\n                    ").concat(x?'<div style="margin-top:2px">'+x+"</div>":"",'\n                    <div class="cart-item-price">â‚¹').concat((c.price+p).toFixed(2),'</div>\n                </div>\n                <div class="cart-item-quantity">\n                    <button class="qty-btn" onclick="updateQuantity(').concat(d,', -1)">-</button>\n                    <span>').concat(c.quantity,'</span>\n                    <button class="qty-btn" onclick="updateQuantity(').concat(d,', 1)">+</button>\n                </div>\n                <button class="remove-item" onclick="removeItem(').concat(d,')">Remove</button>\n            </div>\n        ')}),e.innerHTML=a;const r=o>=me?0:fe,i=o+r;var s=document.getElementById("subtotal-amount"),l=document.getElementById("total-amount");s&&(s.textContent=o.toFixed(2)),l&&(l.textContent=i.toFixed(2))}function bn(e,t){const n=I[e].name;I[e].quantity+=t,I[e].quantity<=0&&I.splice(e,1),K(),ae(),he(),se(n),oe()}function wn(e){const t=I[e].name;I.splice(e,1),K(),ae(),he(),se(t),oe()}function lt(){if(confirm("Are you sure you want to clear your cart?")){const e=I.map(t=>t.name);I.length=0,K(),ae(),he(),e.forEach(t=>se(t)),oe(),document.getElementById("cart-modal").style.display="none",D()}}function En(){var e=document.getElementById("cart-icon"),t=document.getElementById("cart-modal");e&&e.addEventListener("click",r=>{r.preventDefault(),he(),t&&(t.style.display="block"),G()});var n=document.querySelectorAll(".close");n.forEach(r=>{r.addEventListener("click",()=>{if(!r.closest("#auth-modal")){t&&(t.style.display="none");var i=document.getElementById("reservation-modal");i&&(i.style.display="none"),D()}})}),window.addEventListener("click",r=>{r.target===t&&(t.style.display="none",D()),r.target===document.getElementById("reservation-modal")&&(document.getElementById("reservation-modal").style.display="none",D())}),document.addEventListener("click",r=>{if(r.target.classList.contains("qty-plus")){const i=r.target.dataset.item,s=r.target.closest(".add-to-cart");ie(i,s.dataset.price);return}if(r.target.classList.contains("qty-minus")){const i=r.target.dataset.item,s=I.find(l=>l.name===i);s&&(s.quantity--,s.quantity<=0&&I.splice(I.indexOf(s),1),K(),ae(),se(i),oe());return}if(r.target.classList.contains("add-to-cart")&&!r.target.classList.contains("has-qty")){const i=r.target.dataset.item,s=r.target.dataset.price;ie(i,s,r.target),vn(r.target)}});var a=document.getElementById("clear-cart");a&&a.addEventListener("click",lt);var o=document.getElementById("checkout");o&&o.addEventListener("click",function(){typeof window.checkout=="function"&&window.checkout()})}Object.assign(window,{addToCart:ie,finalizeAddToCart:Le,updateQuantity:bn,removeItem:wn,clearCart:lt,closeAddonPicker:fn,toggleAddonOption:mn,confirmAddonSelection:pn,closeFloatingCart:hn,closeSignInPrompt:st,updateFloatingCartBar:_e});var N=null,z=null,ct=500;function ze(){var e=I.reduce(function(r,i){return r+i.price*i.quantity},0),t=e>=me?0:fe,n=0,a=e+t;if(N&&(N.type==="percent"?n=Math.floor(e*N.discount/100):N.type==="flat"&&(n=N.discount),n=Math.min(n,e),a=e-n+t),z&&z.balance>0){var o=Math.min(z.balance,a);a=Math.max(0,a-o)}return{subtotal:e,deliveryFee:t,discount:n,total:a}}function xn(e,t){return e?e.active?e.expiresAt&&new Date(e.expiresAt)<new Date?{valid:!1,reason:"This coupon has expired."}:e.usageLimit&&e.usedCount>=e.usageLimit?{valid:!1,reason:"This coupon has reached its usage limit."}:e.minOrder&&t<e.minOrder?{valid:!1,reason:"Minimum order â‚¹"+e.minOrder+" required."}:{valid:!0}:{valid:!1,reason:"This coupon is no longer active."}:{valid:!1,reason:"No coupon"}}function dt(e,t){if(!e)return 0;var n=e.type==="percent"?t*e.discount/100:e.discount;return e.maxDiscount&&e.type==="percent"&&(n=Math.min(n,e.maxDiscount)),n=Math.min(n,t),n}function Cn(){if(I.length===0){k("Your cart is empty!");return}if(!A()){document.getElementById("cart-modal").style.display="none",D(),typeof window.openAuthModal=="function"&&window.openAuthModal(),k("Please sign in to continue with your order");return}document.getElementById("cart-modal").style.display="none",G(),typeof window.checkAllergenWarning=="function"?window.checkAllergenWarning(I,function(e){e?Ce():D()}):Ce()}function Ce(){var e=I.reduce(function(x,C){return x+C.price*C.quantity},0),t=e>=me?0:fe,n=e+t,a="";I.forEach(function(x){a+='<div class="co-item"><span>'+x.name+" x"+x.quantity+"</span><span>â‚¹"+x.price*x.quantity+"</span></div>"});var o="";if(typeof window.getUpsellItems=="function"){var r=window.getUpsellItems(I);r&&r.length>0&&(o='<div class="upsell-section" id="upsell-section"><div class="upsell-title">Customers also ordered</div><div class="upsell-items">',r.forEach(function(x){o+='<div class="upsell-card"><div class="upsell-info"><div class="upsell-name">'+x.name+'</div><div class="upsell-reason">'+x.reason+'</div></div><span class="upsell-price">â‚¹'+x.price+'</span><button class="upsell-add-btn" onclick="addUpsellItem(\''+x.name.replace(/'/g,"\\'")+"',"+x.price+')">+ Add</button></div>'}),o+="</div></div>")}document.getElementById("checkout-items").innerHTML=a+o,document.getElementById("co-subtotal").textContent="â‚¹"+e,document.getElementById("co-delivery").textContent=t===0?"FREE":"â‚¹"+t,document.getElementById("co-total").textContent="â‚¹"+n;var i=document.getElementById("loyalty-redeem-btn");if(i){var s=A();if(s&&s.loyaltyPoints>=100){var l=Math.floor(s.loyaltyPoints/100)*10;i.textContent="Redeem "+s.loyaltyPoints+" pts (â‚¹"+l+" off)",i.style.display="block"}else i.style.display="none"}Be(1),document.getElementById("checkout-modal").style.display="block";var c=A(),d=document.getElementById("coupon-code"),p=document.getElementById("coupon-msg");if(c&&!c.usedWelcomeBonus){N={discount:25,type:"percent",label:"25% off (Welcome Bonus!)"},d.value="WELCOME25",p.textContent="Welcome bonus applied! You get 25% off!",p.className="coupon-msg success";var g=e*.25;g=Math.min(g,e);var h=e-g+t;document.getElementById("co-total").textContent="â‚¹"+h.toFixed(0)}else N=null,d.value="",p.textContent="",p.className="coupon-msg"}function Sn(){document.getElementById("checkout-modal").style.display="none",D(),document.getElementById("co-name").value="",document.getElementById("co-phone").value="",document.getElementById("co-address").value="",document.getElementById("co-notes").value=""}function Be(e){document.querySelectorAll(".checkout-step").forEach(function(t){t.classList.remove("active")}),document.getElementById("checkout-step-"+e).classList.add("active"),e===3&&Me()}function Me(){var e=ze(),t=e.total,n="â‚¹"+t.toFixed(0);document.getElementById("pay-total").textContent=n;var a=document.getElementById("cod-total");a&&(a.textContent=n),ut("razorpay")}function ut(e){["razorpay","cod"].forEach(function(t){var n=document.getElementById("tab-"+t),a=document.getElementById("pay-panel-"+t);n&&n.classList.toggle("active",t===e),a&&a.classList.toggle("active",t===e)})}function In(){var e=document.getElementById("co-name").value.trim(),t=document.getElementById("co-phone").value.trim(),n=document.getElementById("co-address").value.trim();if(!e||!t||!n){k("Please fill in all required fields.");return}if(t.length<10){k("Please enter a valid phone number.");return}var a=window.getScheduleInfo?window.getScheduleInfo():null;if(a&&(!a.date||!a.time)){k("Please select both date and time for scheduled order.");return}Be(3)}function kn(){if(typeof Razorpay>"u"){k("Payment gateway loading... please try again");return}var e=ze(),t=document.getElementById("co-name").value.trim(),n=document.getElementById("co-phone").value.trim(),a={key:jt,amount:Math.round(e.total*100),currency:"INR",name:Jt,description:"Food Order - Amogha Cafe",image:window.location.origin+"/amogha-logo.png",handler:function(i){var s=i.razorpay_payment_id;Ge("Razorpay",s,"paid")},prefill:{name:t,contact:n,method:"upi"},method:{upi:!0,card:!0,netbanking:!0,wallet:!0},config:{display:{blocks:{upi:{name:"Pay via UPI",instruments:[{method:"upi",flows:["qrcode","collect","intent"]}]}},sequence:["block.upi"],preferences:{show_default_blocks:!0}}},notes:{items:I.map(function(i){return i.name+" x"+i.quantity}).join(", ")},theme:{color:"#D4A017",backdrop_color:"rgba(8,6,4,0.85)"},modal:{ondismiss:function(){var i=document.getElementById("razorpay-pay-btn");i&&(i.disabled=!1,i.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg> Pay Now')}}},o=document.getElementById("razorpay-pay-btn");o&&(o.disabled=!0,o.innerHTML="Opening payment...");try{var r=new Razorpay(a);r.on("payment.failed",function(i){k("Payment failed: "+(i.error.description||"Please try again"));var s=document.getElementById("razorpay-pay-btn");s&&(s.disabled=!1,s.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg> Retry Payment')}),r.open()}catch(i){k("Error opening payment: "+i.message),o&&(o.disabled=!1,o.innerHTML='<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M12 2L2 7l10 5 10-5-10-5z"/><path d="M2 17l10 5 10-5"/><path d="M2 12l10 5 10-5"/></svg> Pay Now')}}function Ln(){Ge("Cash on Delivery",null,"cod-pending")}function Ge(e,t,n){var a=M();if(typeof a>"u"||!a){k("Service unavailable. Please refresh and try again.");return}var o=document.getElementById("co-name").value.trim(),r=document.getElementById("co-phone").value.trim(),i=document.getElementById("co-address").value.trim(),s=document.getElementById("co-notes").value.trim(),l=ze(),c=document.getElementById("schedule-order-check"),d=null;if(c&&c.checked){var p=document.getElementById("schedule-date"),g=document.getElementById("schedule-time");p&&g&&p.value&&g.value&&(d=new Date(p.value+"T"+g.value).toISOString())}document.getElementById("confirm-detail").textContent="Payment: "+e+(t?" (Ref: "+t+")":"")+" | Total: â‚¹"+l.total.toFixed(0);var h="*New Order - Amogha Cafe*\n\n";h+="*Customer:* "+o+"\n*Phone:* "+r+"\n*Address:* "+i+"\n",s&&(h+="*Notes:* "+s+"\n"),h+="\n*Items:*\n",I.forEach(function(T){h+="- "+T.name+" x"+T.quantity+" = â‚¹"+T.price*T.quantity+"\n"}),h+="\n*Subtotal:* â‚¹"+l.subtotal,h+="\n*Delivery:* "+(l.deliveryFee===0?"FREE":"â‚¹"+l.deliveryFee),h+="\n*Total:* â‚¹"+l.total.toFixed(0),h+="\n*Payment:* "+e,t&&(h+="\n*Payment Ref:* "+t);var x="https://wa.me/"+Yt+"?text="+encodeURIComponent(h);document.getElementById("whatsapp-link").href=x,Be(4);var C=A(),L={customer:o,phone:r,address:i,notes:s,items:I.map(function(T){return{name:T.name,qty:T.quantity,price:T.price,spiceLevel:T.spiceLevel||"medium",addons:T.addons||[]}}),subtotal:l.subtotal,deliveryFee:l.deliveryFee,total:l.total,payment:e,paymentRef:t||null,paymentStatus:n,paymentVerifiedAt:t?new Date().toISOString():null,status:d?"scheduled":"pending",createdAt:new Date().toISOString(),scheduledFor:d||null,userId:C?C.phone:null},q=I.map(function(T){return T.name});a.collection("orders").add(L).then(function(T){try{window.analytics&&window.analytics.logEvent("purchase",{transaction_id:T.id,value:L.total,payment_type:e})}catch(u){}window._lastOrderId=T.id,window._lastOrderTotal=L.total;var H=window.location.origin+"/track/index.html?id="+T.id,F=document.getElementById("order-tracking-link");if(F&&(F.innerHTML='<div style="margin-top:1rem;padding:1rem;background:rgba(212,160,23,0.08);border:1px solid rgba(212,160,23,0.15);border-radius:12px;text-align:center"><p style="font-size:0.82rem;color:#a09080;margin-bottom:0.5rem">Track your order in real-time:</p><a href="'+H+'" target="_blank" rel="noopener noreferrer" style="color:#D4A017;font-weight:600;font-size:0.9rem;word-break:break-all">'+H+"</a><br><button onclick=\"safeCopy('"+H+'\',this)" style="margin-top:0.6rem;padding:0.4rem 1rem;background:linear-gradient(135deg,#D4A017,#B8860B);color:#1a0f08;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:0.78rem">Copy Link</button></div>'),C&&!C.usedWelcomeBonus&&N&&N.label&&N.label.indexOf("Welcome")!==-1&&(C.usedWelcomeBonus=!0,_(C),a.collection("users").doc(C.phone).update({usedWelcomeBonus:!0}).catch(function(u){console.error("Bonus update error:",u)})),N=null,z&&z.code){var $=Math.min(z.balance,L.total);a.collection("giftCards").doc(z.code).update({balance:firebase.firestore.FieldValue.increment(-$),redeemedAt:new Date().toISOString()}).catch(function(u){console.error("Gift card deduction error:",u)}),z=null}if(I.length=0,K(),ae(),q.forEach(function(u){se(u)}),oe(),typeof launchConfetti=="function"&&launchConfetti(),typeof awardLoyaltyPoints=="function"&&awardLoyaltyPoints(L.total),typeof checkAndAwardBadges=="function"){var Q=A();Q&&checkAndAwardBadges(Q,L)}if(C&&a&&a.collection("referrals").where("refereePhone","==",C.phone).where("redeemed","==",!1).limit(1).get().then(function(u){if(!u.empty){var v=u.docs[0],b=v.data().referrerPhone;a.collection("users").doc(b).get().then(function(y){if(y.exists){var w=(y.data().loyaltyPoints||0)+100;a.collection("users").doc(b).update({loyaltyPoints:w}).catch(function(E){console.error("Referrer points error:",E)})}}),v.ref.update({redeemed:!0}).catch(function(y){console.error("Referral redeem error:",y)})}}).catch(function(u){console.error("Referral lookup error:",u)}),typeof scheduleReviewPrompt=="function"&&scheduleReviewPrompt(L.items.map(function(u){return{name:u.name}})),typeof sendPushNotification=="function"&&sendPushNotification("Order Placed!","Your order from Amogha has been placed successfully."),r){var m=r.replace(/\D/g,"");m.length===10&&(m="91"+m);var f="Hi "+o+"! ðŸ™\n\nYour order at *Amogha Cafe & Restaurant* has been placed successfully!\n\n";f+="*Order ID:* "+T.id+"\n",f+="*Items:* "+L.items.map(function(u){return u.name+" x"+u.qty}).join(", ")+"\n",f+="*Total:* â‚¹"+l.total.toFixed(0)+"\n\n",f+="ðŸ“ Track your order: "+window.location.origin+"/track/?id="+T.id+"\n\n",f+="Thank you for dining with us! ðŸ›",window.open("https://wa.me/"+m+"?text="+encodeURIComponent(f),"_blank")}a.collection("inventory").get().then(function(u){var v={};u.forEach(function(w){var E=w.data();v[(E.name||"").toLowerCase()]={id:w.id,qty:E.quantity||0}});var b=a.batch(),y=!1;L.items.forEach(function(w){var E=w.name.toLowerCase();if(v[E]&&v[E].qty>0){var S=a.collection("inventory").doc(v[E].id);b.update(S,{quantity:Math.max(0,v[E].qty-w.qty)}),y=!0}}),y&&b.commit().catch(function(w){console.error("Inventory deduction error:",w)})}).catch(function(u){console.error("Inventory fetch error:",u)})}).catch(function(T){console.error("Order save error:",T),k("Order failed to save. Please try again or check your connection.")})}function Bn(){var e=document.getElementById("coupon-code"),t=document.getElementById("coupon-msg"),n=e.value.trim().toUpperCase(),a={AMOGHA20:{discount:20,type:"percent",label:"20% off"},WELCOME50:{discount:50,type:"flat",label:"â‚¹50 off"},FIRST10:{discount:10,type:"percent",label:"10% off"},WELCOME25:{discount:25,type:"percent",label:"25% off (Welcome Bonus!)"}};function o(i){N=i,t.textContent="Coupon applied! "+i.label,t.className="coupon-msg success";var s=I.reduce((p,g)=>p+g.price*g.quantity,0),l=s>=me?0:fe,c=dt(i,s),d=s-c+l;document.getElementById("co-total").textContent="â‚¹"+d.toFixed(0)}var r=M();r?r.collection("coupons").doc(n).get().then(function(i){if(i.exists){var s=i.data(),l=I.reduce((d,p)=>d+p.price*p.quantity,0),c=xn(s,l);if(!c.valid){t.textContent=c.reason,t.className="coupon-msg error",N=null;return}o(s),r.collection("coupons").doc(n).update({usedCount:firebase.firestore.FieldValue.increment(1)})}else a[n]?o(a[n]):(N=null,t.textContent="Invalid coupon code. Please check and try again.",t.className="coupon-msg error")}).catch(function(){a[n]?o(a[n]):(N=null,t.textContent="Invalid coupon code.",t.className="coupon-msg error")}):a[n]?o(a[n]):(N=null,t.textContent="Invalid coupon code. Please check and try again.",t.className="coupon-msg error")}function Mn(){N=null;var e=document.getElementById("coupon-code"),t=document.getElementById("coupon-msg");e&&(e.value=""),t&&(t.textContent="",t.className="coupon-msg"),Me()}function An(){var e=document.getElementById("giftcard-code"),t=document.getElementById("giftcard-msg"),n=e.value.trim().toUpperCase();if(!n){t.textContent="Please enter a gift card code",t.className="coupon-msg error";return}var a=M();if(!a){t.textContent="Service unavailable",t.className="coupon-msg error";return}a.collection("giftCards").doc(n).get().then(function(o){if(!o.exists){t.textContent="Invalid gift card code",t.className="coupon-msg error",z=null;return}var r=o.data();if(!r.active){t.textContent="This gift card is no longer active",t.className="coupon-msg error",z=null;return}if(r.balance<=0){t.textContent="This gift card has no remaining balance",t.className="coupon-msg error",z=null;return}z={code:n,balance:r.balance},t.textContent="Gift card applied! Balance: â‚¹"+r.balance,t.className="coupon-msg success";var i=I.reduce(function(g,h){return g+h.price*h.quantity},0),s=i>=me?0:fe,l=N?dt(N,i):0,c=i-l+s,d=Math.min(r.balance,c),p=c-d;document.getElementById("co-total").textContent="â‚¹"+p.toFixed(0)}).catch(function(o){t.textContent="Error: "+o.message,t.className="coupon-msg error"})}function Tn(){z=null;var e=document.getElementById("giftcard-code"),t=document.getElementById("giftcard-msg");e&&(e.value=""),t&&(t.textContent="",t.className="coupon-msg"),Me()}function Pn(){document.getElementById("giftcard-modal").style.display="block",G()}function Nn(){document.getElementById("giftcard-modal").style.display="none",D()}function qn(e,t){ct=e,document.querySelectorAll(".gc-amount-btn").forEach(function(n){n.classList.remove("active")}),t&&t.classList.add("active")}function On(){var e=document.getElementById("gc-recipient-phone").value.trim(),t=document.getElementById("gc-msg");if(!e||e.length!==10){t.textContent="Please enter a valid 10-digit phone number",t.className="coupon-msg error";return}var n=A(),a=n?n.phone:"guest",o=ct,r="GC-"+Date.now().toString(36).toUpperCase().slice(-4)+"-"+Math.random().toString(36).toUpperCase().slice(2,6);if(typeof Razorpay>"u"){t.textContent="Payment system loading. Please try again.",t.className="coupon-msg error";return}var i=M(),s={key:"rzp_live_bfHYCYWDyoSHFn",amount:o*100,currency:"INR",name:"Amogha Cafe",description:"Gift Card - "+r,image:"https://amogha-cafe.web.app/amogha-logo.png",handler:function(c){i.collection("giftCards").doc(r).set({code:r,amount:o,balance:o,purchaserPhone:a,recipientPhone:e,paymentRef:c.razorpay_payment_id,active:!0,createdAt:new Date().toISOString()}).then(function(){t.textContent="Gift card "+r+" created successfully! Share this code with the recipient.",t.className="coupon-msg success",document.getElementById("gc-recipient-phone").value=""}).catch(function(d){t.textContent="Payment received but error saving: "+d.message,t.className="coupon-msg error"})},prefill:{name:n?n.name:"",contact:a},theme:{color:"#D4A017"}},l=new Razorpay(s);l.open()}function Dn(){var e=A();if(!(!e||!e.loyaltyPoints||e.loyaltyPoints<100)){var t=Math.floor(e.loyaltyPoints/100)*10,n=Math.floor(e.loyaltyPoints/100)*100,a=I.reduce(function(c,d){return c+d.price*d.quantity},0),o=Math.min(t,a);if(!(o<=0)){var r=a>=me?0:fe,i=a-o+r;N={discount:o,type:"flat",label:"Rs."+o+" (Loyalty Points)"},document.getElementById("co-total").textContent="Rs."+i.toFixed(0);var s=document.getElementById("coupon-msg");s.textContent="Redeemed "+n+" points for Rs."+o+" off!",s.className="coupon-msg success",document.getElementById("coupon-code").value="LOYALTY",e.loyaltyPoints-=n,_(e);var l=M();l&&l.collection("users").doc(e.phone).update({loyaltyPoints:e.loyaltyPoints}).catch(function(c){console.error("Loyalty update error:",c)}),typeof updateLoyaltyWidget=="function"&&updateLoyaltyWidget()}}}function Rn(){var e="I just ordered from Amogha Cafe & Restaurant! ðŸ½ï¸ Check them out at https://amoghahotels.com";function t(){var n=A();if(n){var a=[];try{a=JSON.parse(localStorage.getItem("amoghaSharedOrders")||"[]")}catch(i){}Date.now().toString();var o=a.length>0?a[a.length-1]:0;if(!(Date.now()-o<3e5)){a.push(Date.now());try{localStorage.setItem("amoghaSharedOrders",JSON.stringify(a))}catch(i){}n.loyaltyPoints=(n.loyaltyPoints||0)+10,_(n);var r=M();r&&r.collection("users").doc(n.phone).update({loyaltyPoints:n.loyaltyPoints}).catch(function(i){console.error("Share loyalty update error:",i)}),k("Thanks for sharing! +10 loyalty points")}}}navigator.share?navigator.share({text:e}).then(function(){t()}).catch(function(){}):(window.open("https://wa.me/?text="+encodeURIComponent(e),"_blank"),t())}function Hn(e,t){for(var n=!1,a=0;a<I.length;a++)if(I[a].name===e){I[a].quantity++,n=!0;break}n||I.push({name:e,price:t,quantity:1,spiceLevel:"medium",addons:[]}),K(),ae(),oe(),k(e+" added to your order!"),Ce()}Object.assign(window,{checkout:Cn,openCheckout:Ce,closeCheckout:Sn,goToStep:Be,setupPayment:Me,switchPayTab:ut,validateAndPay:In,openRazorpay:kn,placeCodOrder:Ln,placeOrderToFirestore:Ge,applyCoupon:Bn,removeCoupon:Mn,applyGiftCard:An,removeGiftCard:Tn,openGiftCardModal:Pn,closeGiftCardModal:Nn,buyGiftCard:On,selectGcAmount:qn,redeemLoyaltyAtCheckout:Dn,shareOrder:Rn,addUpsellItem:Hn});function be(e,t,n,a,o,r){var i=M();if(!(typeof i>"u"||!i)){try{var s=localStorage.getItem(t);if(s){var l=JSON.parse(s);if(l.ts&&Date.now()-l.ts<n*1e3){o(l.data);return}}}catch(d){}var c=i.collection(e);r&&r.orderBy&&(c=c.orderBy(r.orderBy[0])),r&&r.where&&(c=c.where(r.where[0],r.where[1],r.where[2])),c.get().then(function(d){var p=a(d);o(p);try{localStorage.setItem(t,JSON.stringify({ts:Date.now(),data:p}))}catch(g){}}).catch(function(d){console.error("cachedGet "+e+" error:",d);try{var p=localStorage.getItem(t);p&&o(JSON.parse(p).data)}catch(g){}})}}function Fn(){var e=M();if(!e)return;function t(o){document.querySelectorAll(".menu-item-card").forEach(function(r){var i=r.querySelector("h4");if(i){var s=i.textContent.replace(/Bestseller|Must Try|New/gi,"").trim(),l=o[s];if(l&&l.count>0){var c=(l.total/l.count).toFixed(1),d=r.querySelector(".item-rating");d&&d.remove();var p=document.createElement("div");p.className="item-rating",p.innerHTML='<span class="rating-stars">'+_n(parseFloat(c))+'</span><span class="rating-text">'+c+" ("+l.count+")</span>";var g=r.querySelector(".item-description");g&&g.after(p)}}})}try{var n=V("amoghaRatings");if(n){var a=JSON.parse(n);if(a.ts&&Date.now()-a.ts<6e5&&a.data){t(a.data);return}}}catch(o){}e.collection("reviews").get().then(function(o){var r={};o.forEach(function(i){var s=i.data();r[s.itemName]||(r[s.itemName]={total:0,count:0}),r[s.itemName].total+=s.rating,r[s.itemName].count++}),t(r),J("amoghaRatings",JSON.stringify({ts:Date.now(),data:r}))}).catch(function(){try{var o=V("amoghaRatings");if(o){var r=JSON.parse(o);r.data&&t(r.data)}}catch(i){}})}function _n(e){for(var t="",n=1;n<=5;n++)n<=Math.floor(e)?t+='<span class="star filled">&#9733;</span>':n-.5<=e?t+='<span class="star half">&#9733;</span>':t+='<span class="star empty">&#9734;</span>';return t}function zn(e){var t=document.querySelector(".specials-grid");if(t){if(e.length===0){var n=t.closest(".specials");n&&(n.style.display="none");return}var n=t.closest(".specials");n&&(n.style.display=""),t.innerHTML=e.map(function(a){var o=a.available?"":" item-unavailable";return'<div class="special-card'+o+'" data-id="'+a.name+'"><div class="glow-border"></div><div class="special-badge">'+(a.badge||"Special")+"</div><h3>"+a.name+"</h3><p>"+(a.description||"")+'</p><div class="special-price"><span class="new-price">&#8377;'+a.price+'</span></div><button class="add-to-cart" data-item="'+a.name+'" data-price="'+a.price+'">Order Now</button></div>'}).join("")}}function Gn(){var e='<div class="menu-skeleton-card"><div class="skeleton-line h-img"></div><div class="skeleton-line w-60"></div><div class="skeleton-line w-100"></div><div class="skeleton-line w-80"></div><div class="skeleton-btn"></div></div>';document.querySelectorAll(".menu-items").forEach(function(t){t.querySelector(".menu-skeleton-card")||t.insertAdjacentHTML("afterbegin",e+e+e)})}function Xe(){document.querySelectorAll(".menu-skeleton-card").forEach(function(e){e.remove()})}function Un(){document.querySelectorAll(".menu-item-card").forEach(function(e){var t=e.querySelector(".menu-badge"),n=e.querySelector("h4"),a=t||n;if(a){var o=(t?t.textContent:"")+a.closest(".menu-item-card").dataset.id,r=/chef|spicy|hot|bestseller/i.test(o);if(r&&!e.querySelector(".flame-badge")){var i=document.createElement("span");i.className="flame-badge",i.textContent="ðŸ”¥",i.title="Popular pick!",t?t.after(i):n&&n.appendChild(i)}}})}function Wn(){var e=M();if(!e)return;Gn();function t(i){var s=i.querySelector(".menu-item-img-wrap");if(s)return s;s=document.createElement("div"),s.className="menu-item-img-wrap";var l=document.createElement("img");l.className="menu-item-img",l.alt="",l.loading="lazy";var c=document.createElement("div");return c.className="menu-item-img-placeholder",c.innerHTML='<svg width="36" height="36" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg><span>Image coming soon</span>',s.appendChild(l),s.appendChild(c),i.insertBefore(s,i.firstChild),s}e.collection("menu").onSnapshot(function(i){Xe();var s={};i.forEach(function(l){s[l.id]=l.data()}),document.querySelectorAll(".menu-item-card[data-id]").forEach(function(l){var c=l.dataset.id,d=s[c];if(!d){l.style.display="none";return}l.style.display="",d.available?(l.classList.remove("item-unavailable"),l.style.opacity="",l.style.pointerEvents="",l.style.filter=""):(l.classList.add("item-unavailable"),l.style.opacity="0.45",l.style.pointerEvents="none",l.style.filter="grayscale(0.3)");var p=l.querySelector(".add-to-cart");if(p&&d.price!==parseInt(p.dataset.price)){p.dataset.price=d.price;var g=l.querySelector(".price");g&&(g.innerHTML="&#8377;"+d.price)}var h=t(l),x=h.querySelector(".menu-item-img");d.imageUrl?(x.dataset.currentUrl!==d.imageUrl&&(x.dataset.currentUrl=d.imageUrl,x.src=d.imageUrl,x.onload=function(){x.classList.add("loaded"),h.classList.add("has-image")},x.onerror=function(){x.classList.remove("loaded"),h.classList.remove("has-image"),x.src=""}),l.dataset.imageUrl=d.imageUrl):(x.classList.remove("loaded"),h.classList.remove("has-image"),x.src="",x.dataset.currentUrl="",delete l.dataset.imageUrl);var C=d.allergens||[];l.dataset.allergens=C.join(",");var L=l.querySelector(".menu-allergen-icons");if(L&&L.remove(),C.length>0){var q={nuts:"ðŸ¥œ",dairy:"ðŸ¥›",gluten:"ðŸŒ¾",eggs:"ðŸ¥š",soy:"ðŸ«˜",shellfish:"ðŸ¦",sesame:"âšª",fish:"ðŸŸ"},T='<div class="menu-allergen-icons">';C.forEach(function(F){T+='<span class="allergen-icon">'+(q[F]||"")+" "+F+"</span>"}),T+="</div>";var H=l.querySelector(".item-description")||l.querySelector(".price");H&&H.insertAdjacentHTML("afterend",T)}}),Un(),window._safeForMeActive&&mt()},function(i){console.error("Menu listener error:",i),Xe()}),be("specials","specials_cache",300,function(i){var s=[];return i.forEach(function(l){var c=l.data();c.id=l.id,s.push(c)}),s},zn,{orderBy:["sortOrder"]}),be("heroSlides","heroSlides_cache",300,function(i){var s=[];return i.forEach(function(l){var c=l.data();c.active&&s.push(c)}),s},function(i){i.length!==0&&typeof window.updateHeroSlides=="function"&&window.updateHeroSlides(i)},{orderBy:["sortOrder"]});try{var n=localStorage.getItem("theme_cache");if(n){var a=JSON.parse(n);if(a.ts&&Date.now()-a.ts<6e5&&a.theme&&a.theme!=="default"){document.body.classList.add("theme-"+a.theme);return}}}catch(i){}e.collection("settings").doc("global").get().then(function(i){var s=i.exists&&i.data().activeTheme?i.data().activeTheme:"default";s!=="default"&&document.body.classList.add("theme-"+s);try{localStorage.setItem("theme_cache",JSON.stringify({ts:Date.now(),theme:s}))}catch(l){}}).catch(function(){});var o=document.getElementById("testimonials-grid");o&&be("testimonials","testimonials_cache",600,function(s){var l=[];return s.forEach(function(c){var d=c.data();d.active&&l.push(d)}),l},function(s){if(s.length===0){var l=o.closest(".testimonials");l&&(l.style.display="none");return}o.innerHTML=s.map(function(c){var d=c.thumbnailUrl||(c.videoUrl?c.videoUrl.replace("/upload/","/upload/f_jpg,so_1/"):"");return'<div class="testimonial-card" onclick="openVideoLightbox(\''+(c.videoUrl||"")+'\')"><div class="testimonial-thumb">'+(d?'<img src="'+d+'" alt="" loading="lazy">':'<div class="testimonial-placeholder">ðŸŽ¬</div>')+'<div class="testimonial-play">&#9654;</div></div><p class="testimonial-name">'+(c.customerName||"")+"</p>"+(c.caption?'<p class="testimonial-caption">'+c.caption+"</p>":"")+"</div>"}).join("")},{orderBy:["sortOrder"]});var r=document.getElementById("social-feed-strip");r&&be("socialPosts","socialPosts_cache",600,function(s){var l=[];return s.forEach(function(c){var d=c.data();d.active&&l.push(d)}),l},function(s){if(s.length===0){var l=r.closest(".social-feed");l&&(l.style.display="none");return}r.innerHTML=s.map(function(c){var d=c.link?'<a href="'+c.link+'" target="_blank" rel="noopener">':"<div>",p=c.link?"</a>":"</div>";return d+'<div class="social-card"><img src="'+c.imageUrl+'" alt="" loading="lazy">'+(c.caption?'<span class="social-caption">'+c.caption+"</span>":"")+"</div>"+p}).join("")},{orderBy:["sortOrder"]})}window._safeForMeActive=!1;function Vn(){window._safeForMeActive=!window._safeForMeActive;var e=document.getElementById("safe-for-me-btn");e&&e.classList.toggle("active",window._safeForMeActive),mt()}function mt(){var e=null;try{var t=localStorage.getItem("amoghaUser");t&&(e=JSON.parse(t))}catch(a){}var n=e&&e.allergenAlerts||[];document.querySelectorAll(".menu-item-card[data-id]").forEach(function(a){if(!window._safeForMeActive||n.length===0){a.classList.remove("allergen-hidden"),a.classList.contains("item-unavailable")||(a.style.display="");return}var o=(a.dataset.allergens||"").split(",").filter(Boolean),r=o.some(function(i){return n.indexOf(i)!==-1});r?(a.classList.add("allergen-hidden"),a.style.display="none"):(a.classList.remove("allergen-hidden"),a.classList.contains("item-unavailable")||(a.style.display=""))})}function jn(e,t){var n=null;try{var a=localStorage.getItem("amoghaUser");a&&(n=JSON.parse(a))}catch(s){}var o=n&&n.allergenAlerts||[];if(o.length===0){t(!0);return}var r=[];if(document.querySelectorAll(".menu-item-card[data-id]").forEach(function(s){var l=(s.dataset.allergens||"").split(",").filter(Boolean),c=s.querySelector("h4"),d=c?c.textContent.replace(/Bestseller|Must Try|New/gi,"").trim():s.dataset.id;e.forEach(function(p){if(p.name===d||p.name===s.dataset.id){var g=l.filter(function(h){return o.indexOf(h)!==-1});g.length>0&&r.push({name:p.name,allergens:g})}})}),r.length===0){t(!0);return}var i='<div class="allergen-warning-popup" id="allergen-warning-popup"><div class="allergen-warning-box"><h3>Allergen Warning</h3><div class="allergen-list">';r.forEach(function(s){i+="<p><strong>"+s.name+"</strong> contains: "+s.allergens.join(", ")+"</p>"}),i+='</div><button class="btn-proceed" onclick="document.getElementById(\'allergen-warning-popup\').remove();window._allergenCb(true)">Proceed Anyway</button><button class="btn-cancel" onclick="document.getElementById(\'allergen-warning-popup\').remove();window._allergenCb(false)">Go Back</button></div></div>',window._allergenCb=t,document.body.insertAdjacentHTML("beforeend",i)}window.toggleSafeForMe=Vn;window.checkAllergenWarning=jn;function Yn(){const e=["Authentic Indian Cuisine","Crafted with Passion","A Legacy of Flavour","Where Taste Meets Art","Born from Tradition"],t=["Tradition, Perfection & Soul in Every Dish","Handcrafted Recipes Passed Down Generations","An Unforgettable Culinary Journey Awaits","Every Flavour Tells a Story of Heritage","Experience the Art of Indian Fine Dining"],n=document.querySelector(".hero-tagline .hero-text-inner"),a=document.querySelector(".hero-subtitle .hero-text-inner");if(!n||!a)return;let o=0;function r(){o=(o+1)%e.length,n.classList.add("fade-out"),a.classList.add("fade-out"),setTimeout(()=>{n.textContent=e[o],a.textContent=t[o],window._scrambleReveal?window._scrambleReveal(e[o],n):n.classList.remove("fade-out"),a.classList.remove("fade-out")},700)}setTimeout(()=>{setInterval(r,6e3)},5e3)}function Jn(){const e=document.querySelectorAll(".header-slideshow .slide");if(e.length===0)return;let t=0;setInterval(()=>{e[t].classList.remove("active");let n;do n=Math.floor(Math.random()*e.length);while(n===t&&e.length>1);t=n,e[t].classList.add("active")},3e3)}function $n(){var e=document.querySelectorAll("#hero-slideshow .hero-slide"),t=document.getElementById("hero-sparkles"),n=0,a=window.innerWidth<=768;function o(){if(t){t.innerHTML="";for(var c=a?5:12,d=a?3:6,p=a?4:10,g=a?2:4,h=0;h<g;h++){var x=document.createElement("span");x.className="sp-glow";var C=200+Math.random()*250,L=10+h/g*70+Math.random()*15,q=20+Math.random()*50,T=10+Math.random()*8,H=h*3+Math.random()*2;x.style.cssText="left:"+L+"%;top:"+q+"%;width:"+C+"px;height:"+C+"px;--glow-dur:"+T+"s;--glow-delay:"+H+"s;",t.appendChild(x)}for(var F=0;F<c;F++){var $=document.createElement("span"),Q=["","thin","accent","thin",""],m=Q[F%Q.length];$.className="sp-line"+(m?" "+m:"");var f=140+Math.random()*180,u=3+F/c*90+Math.random()*6,v=12+Math.random()*10,b=F/c*v,y=7+Math.random()*6,w=2.5+Math.random()*2;$.style.cssText="left:"+u+"%;height:"+f+"px;--line-dur:"+v+"s;--line-delay:"+b+"s;--sway-dur:"+y+"s;--shimmer-dur:"+w+"s;",t.appendChild($)}for(var E=0;E<d;E++){var S=document.createElement("span");S.className="sp-dot";var B=4+Math.random()*5,P=8+Math.random()*84,O=18+Math.random()*12,R=E*3.5+Math.random()*4;S.style.cssText="left:"+P+"%;width:"+B+"px;height:"+B+"px;--dot-dur:"+O+"s;--dot-delay:"+R+"s;",t.appendChild(S)}for(var j=0;j<p;j++){var Pe=document.createElement("span");Pe.className="sp-mote";var Ye=2+Math.random()*3,zt=5+Math.random()*90,Gt=18+Math.random()*14,Ut=j*2.5+Math.random()*3,Wt=1.5+Math.random()*2;Pe.style.cssText="left:"+zt+"%;width:"+Ye+"px;height:"+Ye+"px;--mote-dur:"+Gt+"s;--mote-delay:"+Ut+"s;--twinkle-dur:"+Wt+"s;",t.appendChild(Pe)}}}o();var r=["kb-zoom-left","kb-zoom-right","kb-pan-down","kb-zoom-center"],i=null;function s(){i&&clearInterval(i),e=document.querySelectorAll("#hero-slideshow .hero-slide"),n=0,e.length>1&&(i=setInterval(function(){e[n].classList.remove("active"),n=(n+1)%e.length;for(var c=0;c<r.length;c++)e[n].classList.remove(r[c]);e[n].classList.add(r[Math.floor(Math.random()*r.length)]),e[n].classList.add("active")},2e3))}s(),window.updateHeroSlides=function(c){var d=document.getElementById("hero-slideshow");if(!(!d||c.length===0)){i&&clearInterval(i);for(var p=d.querySelectorAll(".hero-slide"),g=0;g<p.length;g++)p[g].remove();c.forEach(function(h,x){var C=document.createElement("div");if(C.className="hero-slide"+(x===0?" active":""),x===0&&C.classList.add(r[Math.floor(Math.random()*r.length)]),h.type==="video"){C.classList.add("hero-slide-video");var L=document.createElement("video");L.src=h.url,L.autoplay=!0,L.muted=!0,L.loop=!0,L.playsInline=!0,L.setAttribute("playsinline",""),L.setAttribute("webkit-playsinline",""),C.appendChild(L)}else C.style.backgroundImage="url("+h.url+")";d.appendChild(C)}),e=d.querySelectorAll(".hero-slide"),n=0,e.length>1&&(i=setInterval(function(){e[n].classList.remove("active");var h=e[n].querySelector("video");h&&h.pause(),n=(n+1)%e.length;for(var x=0;x<r.length;x++)e[n].classList.remove(r[x]);e[n].classList.add(r[Math.floor(Math.random()*r.length)]),e[n].classList.add("active");var C=e[n].querySelector("video");C&&(C.currentTime=0,C.play())},2e3))}};var l=document.querySelector(".hero-tagline .hero-text-inner");if(l&&(window._scrambleReveal=function(c,d){d.textContent=c,d.classList.remove("fade-out"),d.style.opacity="1",d.style.transform="translateY(0)",d.classList.remove("blur-reveal"),d.offsetWidth,d.classList.add("blur-reveal")},setTimeout(function(){window._scrambleReveal(l.textContent,l)},2800)),window.innerWidth>768){const c=document.querySelector(".hero"),d=document.querySelector(".hero-mouse-spotlight");c&&d&&c.addEventListener("mousemove",function(p){const g=c.getBoundingClientRect(),h=p.clientX-g.left,x=p.clientY-g.top;d.style.setProperty("--mouse-x",h+"px"),d.style.setProperty("--mouse-y",x+"px")})}}function Xn(){const e=document.getElementById("confetti-canvas");if(!e)return;const t=e.getContext("2d");e.width=window.innerWidth,e.height=window.innerHeight;const n=[],a=["#EFB31A","#8B1A1A","#27ae60","#e74c3c","#3498db","#f39c12","#9b59b6"];for(let i=0;i<150;i++)n.push({x:Math.random()*e.width,y:Math.random()*e.height-e.height,w:Math.random()*10+5,h:Math.random()*6+3,color:a[Math.floor(Math.random()*a.length)],vy:Math.random()*3+2,vx:Math.random()*2-1,rot:Math.random()*360,rotSpeed:Math.random()*6-3});let o=0;function r(){t.clearRect(0,0,e.width,e.height),n.forEach(i=>{i.y+=i.vy,i.x+=i.vx,i.rot+=i.rotSpeed,t.save(),t.translate(i.x,i.y),t.rotate(i.rot*Math.PI/180),t.fillStyle=i.color,t.fillRect(-i.w/2,-i.h/2,i.w,i.h),t.restore()}),o++,o<200?requestAnimationFrame(r):t.clearRect(0,0,e.width,e.height)}r()}function we(){var e=document.getElementById("nav-links"),t=document.getElementById("mobile-menu-overlay"),n=document.getElementById("mobile-menu-toggle");e&&e.classList.remove("active"),t&&t.classList.remove("active"),n&&(n.textContent="â˜°"),D()}function Kn(){"scrollRestoration"in history&&(history.scrollRestoration="manual"),window.scrollTo(0,0),window.addEventListener("load",()=>{const m=document.getElementById("page-transition");m&&setTimeout(()=>m.classList.add("loaded"),100),setTimeout(()=>{const f=document.getElementById("preloader");f&&f.classList.add("hidden")},2200)}),function(){const m=document.getElementById("theme-toggle");if(!m)return;V("amogha-dark-mode")==="true"&&(document.body.classList.add("dark-mode"),m.textContent="â˜€ï¸"),m.addEventListener("click",()=>{document.body.classList.toggle("dark-mode");const u=document.body.classList.contains("dark-mode");m.textContent=u?"â˜€ï¸":"ðŸŒ™",J("amogha-dark-mode",u)})}(),function(){const m=document.querySelectorAll(".stat-number");function f(){if(window.innerWidth<=768){m.forEach(function(E){var S=parseFloat(E.dataset.target);E.textContent=S%1!==0?S.toFixed(1):S.toLocaleString()});return}var v=[];m.forEach(function(E){v.push({el:E,target:parseFloat(E.dataset.target),isDecimal:parseFloat(E.dataset.target)%1!==0,lastValue:-1})});var b=2e3,y=performance.now();function w(E){for(var S=E-y,B=Math.min(S/b,1),P=1-Math.pow(1-B,3),O=0;O<v.length;O++){var R=v[O],j=R.isDecimal?+(R.target*P).toFixed(1):Math.floor(R.target*P);j!==R.lastValue&&(R.el.textContent=R.isDecimal?j.toFixed(1):j.toLocaleString(),R.lastValue=j)}B<1&&requestAnimationFrame(w)}requestAnimationFrame(w)}const u=document.querySelector(".stats-section");if(u){let v=!1;const b=new IntersectionObserver(y=>{y[0].isIntersecting&&!v&&(v=!0,f(),b.unobserve(u))},{threshold:.3});b.observe(u)}}(),function(){var m=document.querySelectorAll(".reveal");if(!(!m.length||typeof IntersectionObserver>"u")){var f=new IntersectionObserver(function(u){u.forEach(function(v){v.isIntersecting&&(v.target.classList.add("in-view"),f.unobserve(v.target))})},{threshold:.12,rootMargin:"0px 0px -40px 0px"});m.forEach(function(u){f.observe(u)})}}(),function(){var m=document.getElementById("nav-links"),f=document.getElementById("mobile-menu-toggle"),u=document.getElementById("mobile-menu-overlay");if(!m||!f)return;var v=m.parentElement;function b(){window.innerWidth<=768?m.parentElement!==document.body&&document.body.appendChild(m):m.parentElement===document.body&&v.appendChild(m)}b();var y;window.addEventListener("resize",function(){clearTimeout(y),y=setTimeout(b,100)}),f.addEventListener("click",()=>{const w=m.classList.toggle("active");u&&u.classList.toggle("active",w),f.textContent=w?"âœ•":"â˜°",w?G():D()}),u&&u.addEventListener("click",we),m.querySelectorAll("a").forEach(function(w){w.addEventListener("click",function(E){var S=w.getAttribute("href"),B=w.id==="signin-btn"||w.closest("#signin-btn");if(B){m.classList.remove("active"),u&&u.classList.remove("active"),f.textContent="â˜°";return}if(we(),S&&S.startsWith("#")){E.preventDefault();var P=document.querySelector(S);P&&setTimeout(function(){P.scrollIntoView({behavior:"smooth",block:"start"})},50)}})})}(),document.querySelectorAll('a[href^="#"]').forEach(m=>{m.addEventListener("click",function(f){if(this.id==="cart-icon")return;f.preventDefault();const u=document.querySelector(this.getAttribute("href"));u&&(u.scrollIntoView({behavior:"smooth",block:"start"}),we())})});const e=document.getElementById("back-to-top");e&&e.addEventListener("click",()=>{window.scrollTo({top:0,behavior:"smooth"})});const t=document.querySelector(".hero-slideshow"),n=document.querySelectorAll("section[id]"),a=document.querySelectorAll('.nav-links a[href^="#"]'),o=document.querySelector("header");var r=0,i=document.querySelector(".hero-scroll-indicator"),s=document.getElementById("btt-ring-fill"),l=document.getElementById("sticky-order-bar"),c=document.querySelector(".hero"),d=2*Math.PI*16,p=c?c.offsetHeight:600,g=[];(function(){n.forEach(function(f){g.push({id:f.getAttribute("id"),top:f.offsetTop})})})();var h=document.querySelector(".about"),x=document.querySelector(".chef-content"),C=document.querySelector(".stats-grid"),L=h?h.offsetTop:0,q=x?x.closest("section")||x.closest(".chef-section"):null,T=q?q.offsetTop:0,H=C?C.closest(".stats-section"):null,F=H?H.offsetTop:0;window.addEventListener("resize",function(){p=c?c.offsetHeight:600,g=[],n.forEach(function(m){g.push({id:m.getAttribute("id"),top:m.offsetTop})}),L=h?h.offsetTop:0,T=q?q.offsetTop:0,F=H?H.offsetTop:0});var $=!1;window.addEventListener("scroll",function(){$||(requestAnimationFrame(function(){var m=window.pageYOffset,f=window.innerWidth>768;if(t&&f&&(t.style.transform="translateY("+m*.35+"px)"),f){var u=window.innerHeight;if(h&&m>L-u&&m<L+h.offsetHeight){var v=(m-L+u)*.06;h.style.setProperty("--section-parallax",v+"px")}x&&m>T-u&&m<T+800&&(x.style.transform="translateY("+(m-T+u)*.04+"px)"),C&&m>F-u&&m<F+600&&(C.style.transform="translateY("+(m-F+u)*.035+"px)")}if(i&&m<300?i.style.opacity=Math.max(0,1-m/300):i&&i.style.opacity!=="0"&&(i.style.opacity=0),o&&f&&(m>r&&m>100?o.style.transform="translateY(-100%)":o.style.transform="translateY(0)"),r=m,e){var b=m>400,y=e.classList.contains("visible");b&&!y?e.classList.add("visible"):!b&&y&&e.classList.remove("visible")}if(s){var w=document.documentElement.scrollHeight-document.documentElement.clientHeight,E=w>0?m/w:0;s.style.strokeDashoffset=d*(1-E)}if(l){var S=m>p,B=l.classList.contains("visible");S&&!B?l.classList.add("visible"):!S&&B&&l.classList.remove("visible")}if(f){for(var P="",O=0;O<g.length;O++)m>=g[O].top-150&&(P=g[O].id);a.forEach(function(R){R.classList.remove("active"),R.getAttribute("href")==="#"+P&&R.classList.add("active")})}$=!1}),$=!0)},{passive:!0}),function(){document.querySelectorAll(".about-text, .special-card, .menu-category, .gallery-item, .review-card, .faq-item, .info-block, .contact-form-section, .stat-item, .chef-content, .trust-badge").forEach(y=>{y.classList.add("reveal");const E=(y.parentElement?Array.from(y.parentElement.children).filter(B=>B.classList.contains(y.classList[0])):[]).indexOf(y);if(E>0){var S=.07*E+.04*Math.sin(E*Math.PI/4);y.style.transitionDelay=Math.max(0,S).toFixed(3)+"s"}}),document.querySelectorAll(".menu-item-card").forEach(y=>{y.classList.add("reveal");const E=(y.parentElement?Array.from(y.parentElement.children):[]).indexOf(y);var S=Math.floor(E/2),B=E%2;y.style.transitionDelay=(S*.12+B*.06).toFixed(3)+"s"}),document.querySelectorAll(".about, .specials, .menu, .gallery, .reviews, .contact, .faq").forEach(y=>{y.classList.add("section-reveal")});const f=document.querySelector(".chef-image"),u=document.querySelector("#chef-info");f&&f.classList.add("reveal-left"),u&&u.classList.add("reveal-right"),document.querySelectorAll(".stat-item").forEach(y=>{y.classList.remove("reveal"),y.classList.add("reveal-scale")});const v=document.querySelectorAll(".reveal, .reveal-left, .reveal-right, .reveal-scale, .section-reveal"),b=new IntersectionObserver(y=>{y.forEach(w=>{w.isIntersecting&&w.target.classList.add("visible")})},{threshold:.08,rootMargin:"0px 0px -50px 0px"});v.forEach(y=>b.observe(y))}(),function(){const m=document.querySelectorAll("#chef-slideshow .chef-slide"),f=document.querySelectorAll(".chef-info-slide");if(m.length<=1)return;let u=0;setInterval(()=>{m[u].classList.remove("active"),f[u]&&f[u].classList.remove("active"),u=(u+1)%m.length,m[u].classList.add("active"),f[u]&&f[u].classList.add("active")},4e3)}(),function(){const m=document.getElementById("category-carousel"),f=document.getElementById("cat-arrow-left"),u=document.getElementById("cat-arrow-right");if(!m||!f||!u)return;const v=250;function b(){f.disabled=m.scrollLeft<=5,u.disabled=m.scrollLeft>=m.scrollWidth-m.clientWidth-5}f.addEventListener("click",()=>{m.scrollBy({left:-v,behavior:"smooth"})}),u.addEventListener("click",()=>{m.scrollBy({left:v,behavior:"smooth"})}),m.addEventListener("scroll",b,{passive:!0}),b(),m.querySelectorAll(".category-item").forEach(y=>{y.addEventListener("click",w=>{w.preventDefault();const E=y.getAttribute("href"),S=document.querySelector(E);if(S){const P=S.getBoundingClientRect().top+window.pageYOffset-100;window.scrollTo({top:P,behavior:"smooth"})}})})}(),function(){var m=document.getElementById("menu-search");m&&m.addEventListener("input",function(f){var u=f.target.value.toLowerCase();document.querySelectorAll(".menu-item-card").forEach(function(v){var b=v.querySelector("h4"),y=v.querySelector(".item-description"),w=b?b.textContent.toLowerCase():"",E=y?y.textContent.toLowerCase():"";v.style.display=w.includes(u)||E.includes(u)?"":"none"})})}(),document.querySelectorAll(".filter-btn").forEach(m=>{m.addEventListener("click",()=>{document.querySelectorAll(".filter-btn").forEach(u=>u.classList.remove("active")),m.classList.add("active");const f=m.dataset.filter;document.querySelectorAll(".menu-item-card").forEach(u=>{const v=u.querySelector(".veg-badge"),b=u.querySelector(".nonveg-badge");f==="all"?u.style.display="":f==="veg"?u.style.display=v?"":"none":f==="non-veg"&&(u.style.display=b?"":"none")})})});var Q=document.getElementById("contact-form");Q&&Q.addEventListener("submit",m=>{m.preventDefault(),typeof showAuthToast=="function"&&showAuthToast("Thank you for your message! We will get back to you shortly."),m.target.reset()}),function(){const m=document.getElementById("food-particles");if(!m)return;const f=["ðŸ›","ðŸš","ðŸŒ¶ï¸","ðŸ—","ðŸ¥˜","ðŸ«“","â˜•","ðŸ²"];for(let u=0;u<12;u++){const v=document.createElement("span");v.className="food-particle",v.textContent=f[Math.floor(Math.random()*f.length)],v.style.left=Math.random()*100+"%",v.style.animationDuration=15+Math.random()*20+"s",v.style.animationDelay=Math.random()*15+"s",v.style.fontSize=1+Math.random()*1.5+"rem",m.appendChild(v)}}(),function(){let m;var f=document.getElementById("pwa-prompt"),u=document.getElementById("pwa-install-btn"),v=document.getElementById("pwa-dismiss-btn");function b(){f&&(f.style.opacity="0",f.style.transform="translateX(-50%) translateY(30px)",setTimeout(function(){f.style.display="none"},400))}window.addEventListener("beforeinstallprompt",function(y){y.preventDefault(),m=y,f&&(f.style.display="flex")}),u&&u.addEventListener("click",function(){m&&(m.prompt(),m.userChoice.then(function(){m=null,b()}))}),v&&v.addEventListener("click",b)}(),function(){if(window.innerWidth<=768)return;document.querySelectorAll(".cta-button, .add-to-cart").forEach(f=>{f.addEventListener("mousemove",u=>{const v=f.getBoundingClientRect(),b=u.clientX-v.left-v.width/2,y=u.clientY-v.top-v.height/2;f.style.transform="translate(".concat(b*.15,"px, ").concat(y*.15,"px)")}),f.addEventListener("mouseleave",()=>{f.style.transform=""})})}(),function(){function m(u){u.complete&&u.naturalHeight>0?u.classList.add("loaded"):u.addEventListener("load",()=>u.classList.add("loaded"))}document.querySelectorAll('img[loading="lazy"]').forEach(m),new MutationObserver(u=>{u.forEach(v=>{v.addedNodes.forEach(b=>{b.tagName==="IMG"&&b.loading==="lazy"&&m(b)})})}).observe(document.body,{childList:!0,subtree:!0})}(),function(){if(window.innerWidth<=768)return;const m=document.querySelectorAll(".menu-item-card"),f=4;m.forEach(function(u){var v=null;u.addEventListener("mouseenter",function(){v=u.getBoundingClientRect()}),u.addEventListener("mousemove",function(b){if(!v)return;const y=b.clientX-v.left,w=b.clientY-v.top,E=v.width/2,S=v.height/2,B=(w-S)/S*-f,P=(y-E)/E*f;u.style.transform="perspective(800px) rotateX("+B+"deg) rotateY("+P+"deg) translateY(-4px)"}),u.addEventListener("mouseleave",function(){v=null,u.style.transition="transform 0.5s cubic-bezier(0.34, 1.56, 0.64, 1)",u.style.transform="perspective(800px) rotateX(0) rotateY(0) translateY(0)",setTimeout(function(){u.style.transition=""},500)})})}(),function(){if(window.innerWidth<=768)return;var m=document.getElementById("cursor-glow");if(!m)return;var f=0,u=0,v=0,b=0,y=!1;document.addEventListener("mousemove",function(E){f=E.clientX,u=E.clientY,y||(y=!0,m.classList.add("active"))}),document.addEventListener("mouseleave",function(){y=!1,m.classList.remove("active")});function w(){v+=(f-v)*.12,b+=(u-b)*.12,m.style.left=v+"px",m.style.top=b+"px",requestAnimationFrame(w)}w()}(),function(){var m=document.querySelectorAll(".svg-ornament");if(m.length!==0){var f=new IntersectionObserver(function(u){u.forEach(function(v){v.isIntersecting&&v.target.classList.add("visible")})},{threshold:.5});m.forEach(function(u){f.observe(u)})}}(),function(){if(window.innerWidth<=768)return;var m=document.getElementById("menu-preview-img");if(!m)return;var f={starters:"pics/Gemini_Generated_Image_wnzsqxwnzsqxwnzs.png",curries:"pics/Gemini_Generated_Image_tu348stu348stu34.png",biryanis:"pics/Gemini_Generated_Image_h1vezgh1vezgh1ve.png",kebabs:"pics/Gemini_Generated_Image_5jdcgq5jdcgq5jdc.png",noodles:"pics/Gemini_Generated_Image_1ojbou1ojbou1ojb.png",friedrice:"pics/Gemini_Generated_Image_bfgo8abfgo8abfgo.png",rotis:"pics/Gemini_Generated_Image_6lqqu6lqqu6lqqu6.png"};function u(v){var b=v.closest(".menu-category");if(!b)return null;var y=b.id||"";return y.indexOf("starters")!==-1?"starters":y.indexOf("curries")!==-1?"curries":y.indexOf("biryanis")!==-1?"biryanis":y.indexOf("kebabs")!==-1?"kebabs":y.indexOf("noodles")!==-1?"noodles":y.indexOf("friedrice")!==-1?"friedrice":y.indexOf("rotis")!==-1?"rotis":null}document.querySelectorAll(".menu-item-card").forEach(function(v){v.addEventListener("mouseenter",function(){var b=v.dataset.imageUrl;if(b)m.src=b,m.classList.add("active");else{var y=u(v);y&&f[y]&&(m.src=f[y],m.classList.add("active"))}}),v.addEventListener("mousemove",function(b){m.style.left=b.clientX+20+"px",m.style.top=b.clientY-90+"px"}),v.addEventListener("mouseleave",function(){m.classList.remove("active")})})}(),function(){if(!(window.innerWidth<=768)){var m=document.querySelectorAll(".chef-slide, .gallery-slide-item img, .gallery-item img"),f=.03;m.forEach(function(u){u.classList.add("magnetic-image");var v=null;u.addEventListener("mouseenter",function(){v=u.getBoundingClientRect()}),u.addEventListener("mousemove",function(b){if(v){var y=b.clientX-v.left-v.width/2,w=b.clientY-v.top-v.height/2;u.style.transform="translate("+y*f+"px, "+w*f+"px) scale(1.02)"}}),u.addEventListener("mouseleave",function(){v=null,u.style.transform=""})})}}(),function(){if(!(window.innerWidth<=768)){var m=document.querySelectorAll(".menu-item-card, .about-text");m.forEach(function(f){var u=document.createElement("div");u.className="card-reflection",f.appendChild(u);var v=null;f.addEventListener("mouseenter",function(){v=f.getBoundingClientRect()}),f.addEventListener("mousemove",function(b){v&&(u.style.setProperty("--ref-x",b.clientX-v.left+"px"),u.style.setProperty("--ref-y",b.clientY-v.top+"px"))}),f.addEventListener("mouseleave",function(){v=null})})}}(),function(){var m=document.querySelectorAll(".section-wipe");if(m.length!==0){var f=new IntersectionObserver(function(u){u.forEach(function(v){v.isIntersecting&&!v.target.classList.contains("wipe-active")&&v.target.classList.add("wipe-active")})},{threshold:.15});m.forEach(function(u){f.observe(u)})}}(),function(){document.addEventListener("click",function(m){var f=m.target.closest(".add-to-cart, .cta-button, .btn-primary, .pay-now-btn, .combo-add-btn");if(f){var u=document.createElement("span");u.className="btn-ripple";var v=f.getBoundingClientRect(),b=Math.max(v.width,v.height)*2;u.style.width=u.style.height=b+"px",u.style.left=m.clientX-v.left-b/2+"px",u.style.top=m.clientY-v.top-b/2+"px",f.appendChild(u),setTimeout(function(){u.remove()},700)}})}(),function(){if(window.innerWidth<=768)return;function m(f,u){for(var v=10,b=0;b<v;b++){var y=document.createElement("span");y.className="gold-particle";var w=b/v*Math.PI*2,E=40+Math.random()*30,S=Math.cos(w)*E,B=Math.sin(w)*E;y.style.left=f+"px",y.style.top=u+"px",y.style.setProperty("--tx",S+"px"),y.style.setProperty("--ty",B+"px"),y.style.animationDelay=Math.random()*.1+"s",document.body.appendChild(y),y.addEventListener("animationend",function(){this.remove()})}}document.addEventListener("click",function(f){(f.target.classList.contains("add-to-cart")||f.target.closest(".add-to-cart"))&&m(f.clientX,f.clientY)})}(),function(){var m={Mild:"Subtle warmth, family-friendly",Medium:"Balanced heat, our recommendation",Spicy:"Andhra-level heat, for the brave!"};document.querySelectorAll(".spice-level").forEach(function(f){var u=f.textContent.trim();m[u]&&(f.setAttribute("data-tooltip",m[u]),f.classList.add("has-tooltip"))})}(),function(){var m=50;function f(u,v){if(u){var b=0,y=0,w=!1;u.addEventListener("touchstart",function(E){b=E.touches[0].clientX,y=E.touches[0].clientY,w=!0},{passive:!0}),u.addEventListener("touchmove",function(E){if(w){var S=E.touches[0].clientX-b,B=E.touches[0].clientY-y;Math.abs(S)>Math.abs(B)&&Math.abs(S)>10&&E.preventDefault()}},{passive:!1}),u.addEventListener("touchend",function(E){if(w){w=!1;var S=E.changedTouches[0].clientX-b;Math.abs(S)>m&&v(S<0?1:-1)}},{passive:!0})}}f(document.querySelector(".gallery-slideshow-wrapper"),function(u){typeof window.moveGallerySlide=="function"&&window.moveGallerySlide(u)}),f(document.querySelector(".reviews-carousel-wrapper"),function(u){typeof window.moveCarousel=="function"&&window.moveCarousel(u)})}(),function(){var m=document.getElementById("menu-search");if(!m)return;var f=document.createElement("div");f.id="search-autocomplete",f.className="search-autocomplete-dropdown",m.parentElement.classList.add("search-autocomplete-wrap"),m.parentElement.appendChild(f);var u=[];document.querySelectorAll(".menu-item-card").forEach(function(w){var E=w.querySelector("h4"),S=w.querySelector(".item-description"),B=w.querySelector(".price"),P=!!w.querySelector(".veg-badge"),O=w.closest(".menu-category"),R=O?O.querySelector(".category-title"):null,j=R?R.textContent:"";u.push({name:E?E.textContent.replace(/Bestseller|Popular|Chef's Pick|Must Try/g,"").trim():"",desc:S?S.textContent:"",price:B?B.textContent:"",isVeg:P,category:j,card:w})});var v;m.addEventListener("input",function(){clearTimeout(v),v=setTimeout(function(){var w=m.value.toLowerCase().trim();if(document.querySelectorAll(".menu-item-card").forEach(function(S){var B=S.querySelector("h4"),P=S.querySelector(".item-description"),O=B?B.textContent.toLowerCase():"",R=P?P.textContent.toLowerCase():"";S.style.display=!w||O.includes(w)||R.includes(w)?"":"none"}),w.length<2){f.classList.remove("visible"),f.innerHTML="";return}var E=u.filter(function(S){return S.name.toLowerCase().includes(w)||S.desc.toLowerCase().includes(w)}).slice(0,6);if(E.length===0){f.classList.remove("visible"),f.innerHTML="";return}f.innerHTML=E.map(function(S){var B=S.isVeg?'<span class="ac-badge veg">VEG</span>':'<span class="ac-badge non-veg">NON-VEG</span>';return'<button class="ac-item" data-name="'+S.name+'"><div class="ac-info"><span class="ac-name">'+S.name+'</span><span class="ac-meta">'+B+' <span class="ac-cat">'+S.category+'</span></span></div><span class="ac-price">'+S.price+"</span></button>"}).join(""),f.classList.add("visible")},150)}),f.addEventListener("click",function(w){var E=w.target.closest(".ac-item");if(E){var S=E.dataset.name;m.value=S,f.classList.remove("visible");var B=u.find(function(P){return P.name===S});B&&B.card&&(document.querySelectorAll(".menu-item-card").forEach(function(P){P.style.display=""}),B.card.scrollIntoView({behavior:"smooth",block:"center"}),B.card.classList.add("search-highlight"),setTimeout(function(){B.card.classList.remove("search-highlight")},2e3))}}),document.addEventListener("click",function(w){w.target.closest(".search-autocomplete-wrap")||f.classList.remove("visible")}),m.addEventListener("keydown",function(w){w.key==="Escape"&&(f.classList.remove("visible"),m.blur())});var b;m.addEventListener("input",function(){clearTimeout(b);var w=m.value.trim();if(w.length<4){y();return}b=setTimeout(async function(){try{var E=document.getElementById("ai-search-badge");E||(E=document.createElement("span"),E.id="ai-search-badge",E.className="ai-search-badge",m.parentElement.appendChild(E)),E.textContent="AI searching...",E.style.display="inline-block";var S=await fetch("/api/smart-search",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({query:w})}),B=await S.json();E.textContent="AI: "+(B.interpretation||"results"),B.results&&B.results.length>0&&(document.querySelectorAll(".menu-item-card").forEach(function(P){P.classList.remove("ai-highlighted")}),B.results.forEach(function(P){var O=document.querySelector('.menu-item-card[data-id="'+P.name+'"]');O&&(O.style.display="",O.classList.add("ai-highlighted"))}))}catch(P){y()}},800)});function y(){var w=document.getElementById("ai-search-badge");w&&(w.style.display="none"),document.querySelectorAll(".menu-item-card.ai-highlighted").forEach(function(E){E.classList.remove("ai-highlighted")})}}(),document.addEventListener("DOMContentLoaded",function(){document.querySelectorAll('img[loading="lazy"]').forEach(function(f){f.complete?f.classList.add("loaded"):(f.addEventListener("load",function(){f.classList.add("loaded")}),f.addEventListener("error",function(){f.classList.add("loaded")}))});var m=new MutationObserver(function(f){f.forEach(function(u){u.addedNodes.forEach(function(v){if(v.nodeType===1){var b=v.querySelectorAll?v.querySelectorAll('img[loading="lazy"]'):[];b.forEach(function(y){y.complete?y.classList.add("loaded"):y.addEventListener("load",function(){y.classList.add("loaded")})})}})})});m.observe(document.body,{childList:!0,subtree:!0})})}Object.assign(window,{closeMobileMenu:we,launchConfetti:Xn});function Qn(){if("Notification"in window){if(Notification.permission==="granted"){J("amoghaNotifPerm","granted");return}if(Notification.permission!=="denied"){var e=document.getElementById("notif-banner");!e&&!V("amoghaNotifDismissed")&&(e=document.createElement("div"),e.id="notif-banner",e.className="notif-banner",e.innerHTML='<span class="notif-icon">ðŸ””</span><span class="notif-text">Get notified when your order is ready!</span><button class="notif-allow" onclick="enableNotifications()">Enable</button><button class="notif-dismiss" onclick="dismissNotifBanner()">&times;</button>',document.body.appendChild(e),setTimeout(function(){e.classList.add("visible")},3e3))}}}function Zn(){Notification.requestPermission().then(function(e){J("amoghaNotifPerm",e),ft(),e==="granted"&&k("Notifications enabled!")})}function ft(){var e=document.getElementById("notif-banner");e&&(e.classList.remove("visible"),setTimeout(function(){e.remove()},400)),J("amoghaNotifDismissed","true")}function Se(e,t){if(!(!("Notification"in window)||Notification.permission!=="granted"))try{new Notification(e,{body:t,icon:"amogha-logo.png",badge:"amogha-logo.png",tag:"amogha-order"})}catch(n){navigator.serviceWorker&&navigator.serviceWorker.ready&&navigator.serviceWorker.ready.then(function(a){a.showNotification(e,{body:t,icon:"amogha-logo.png",tag:"amogha-order"})})}}function pt(){if(!(typeof firebase>"u"||!firebase.messaging))try{var e=firebase.messaging();e.getToken({vapidKey:"BAmoghaVapidKeyPlaceholder"}).then(function(t){t&&ea(t)}).catch(function(t){console.log("FCM token error (expected on some browsers):",t.message)}),e.onMessage(function(t){var n=t.notification?t.notification.title:"Amogha Cafe",a=t.notification?t.notification.body:"";Se(n,a),k(a||n)})}catch(t){}}function ea(e){try{var t=JSON.parse(localStorage.getItem("amoghaUser"));t&&t.phone&&window.db&&window.db.collection("users").doc(t.phone).update({fcmToken:e,fcmUpdatedAt:new Date().toISOString()}).catch(function(){})}catch(n){}J("amoghaFcmToken",e)}function ta(){setTimeout(Qn,5e3),setTimeout(pt,8e3)}async function na(e){var t=null;try{t=JSON.parse(localStorage.getItem("amoghaUser"))}catch(i){}if(t){var n=[];try{var a=JSON.parse(localStorage.getItem("amoghaMyOrders"));a&&(n=a.map(function(i){return i.data}))}catch(i){}try{var o=await fetch("/api/smart-notify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t.phone,context:e||"general",orderHistory:n.slice(0,5)})}),r=await o.json();Se(r.title||"Amogha Cafe",r.body||"Something delicious awaits!")}catch(i){Se("Amogha Cafe","We have something delicious waiting for you!")}}}Object.assign(window,{enableNotifications:Zn,dismissNotifBanner:ft,sendPushNotification:Se,initFCM:pt,sendSmartNotification:na});function vt(){var e=document.getElementById("reservation-modal");if(e){var t=document.getElementById("reservation-form");if(!t||t.dataset.enhanced==="true"){e.style.display="block";return}t.dataset.enhanced="true";var n=new Date().toISOString().split("T")[0],a=new Date(Date.now()+7*864e5).toISOString().split("T")[0];t.innerHTML='<input type="text" id="res-name" placeholder="Your Name" required><input type="tel" id="res-phone" placeholder="Phone Number (10 digits)" required maxlength="10"><input type="date" id="res-date" min="'+n+'" max="'+a+'" required><div class="res-time-slots" id="res-time-slots"></div><input type="hidden" id="res-time" value=""><div class="res-party-size"><label>Party Size</label><div class="party-btns" id="party-btns"></div></div><textarea id="res-requests" placeholder="Special Requests (Optional)" rows="2"></textarea><div id="res-msg" class="auth-msg"></div><button type="submit" class="cta-button">Confirm Reservation</button>';for(var o=document.getElementById("party-btns"),r=1;r<=12;r++){var i=document.createElement("button");i.type="button",i.className="party-btn",i.textContent=r,i.dataset.size=r,i.onclick=function(){document.querySelectorAll(".party-btn").forEach(function(l){l.classList.remove("active")}),this.classList.add("active")},o.appendChild(i)}document.getElementById("res-date").addEventListener("change",function(){oa(this.value)}),t.onsubmit=function(l){l.preventDefault(),gt()};var s=A();s&&(document.getElementById("res-name").value=s.name||"",document.getElementById("res-phone").value=s.phone||""),e.style.display="block"}}function aa(){var e=document.getElementById("reservation-modal");e&&(e.style.display="none")}function oa(e){var t=document.getElementById("res-time-slots");if(t){t.innerHTML='<label>Select Time</label><div class="time-grid" id="time-grid"></div>';for(var n=document.getElementById("time-grid"),a=new Date(e).getDay(),o=a===0?12:11,r=a===5||a===6?22:21,i=o;i<=r;i++)for(var s=0;s<60&&!(i===r&&s>0);s+=30){var l=String(i).padStart(2,"0")+":"+String(s).padStart(2,"0"),c=(i>12?i-12:i)+":"+String(s).padStart(2,"0")+(i>=12?" PM":" AM"),d=document.createElement("button");d.type="button",d.className="time-slot-btn",d.textContent=c,d.dataset.time=l,d.onclick=function(){document.querySelectorAll(".time-slot-btn").forEach(function(p){p.classList.remove("active")}),this.classList.add("active"),document.getElementById("res-time").value=this.dataset.time},n.appendChild(d)}}}function gt(){var e=document.getElementById("res-name").value.trim(),t=document.getElementById("res-phone").value.trim(),n=document.getElementById("res-date").value,a=document.getElementById("res-time").value,o=document.querySelector(".party-btn.active"),r=o?parseInt(o.dataset.size):0,i=document.getElementById("res-requests").value.trim(),s=document.getElementById("res-msg");if(!e||!t||!n||!a||!r){s.textContent="Please fill in all required fields.",s.className="auth-msg error";return}if(!/^\d{10}$/.test(t)){s.textContent="Please enter a valid 10-digit phone number.",s.className="auth-msg error";return}s.textContent="Booking your table...",s.className="auth-msg";var l=M();if(!l){s.textContent="Service unavailable. Please refresh and try again.",s.className="auth-msg error";return}var c={name:e,phone:t,date:n,time:a,partySize:r,requests:i,status:"pending",createdAt:new Date().toISOString()};l.collection("reservations").add(c).then(function(d){var p=document.getElementById("reservation-form"),g=new Date(n).toLocaleDateString("en-IN",{weekday:"long",day:"numeric",month:"long"}),h=a,x=parseInt(a.split(":")[0]),C=a.split(":")[1];h=(x>12?x-12:x)+":"+C+(x>=12?" PM":" AM"),p.innerHTML='<div class="res-confirmed"><div class="res-check">&#10003;</div><h3>Reservation Confirmed!</h3><p class="res-id">Booking #'+d.id.slice(-6).toUpperCase()+'</p><div class="res-details"><p>'+g+" at "+h+"</p><p>"+r+" Guest"+(r>1?"s":"")+'</p></div><a class="whatsapp-btn" href="https://wa.me/919121004999?text='+encodeURIComponent("Hi Amogha! I have a reservation:\nDate: "+g+"\nTime: "+h+"\nGuests: "+r+"\nName: "+e+"\nBooking: #"+d.id.slice(-6).toUpperCase())+'" target="_blank">Confirm via WhatsApp</a><button class="cta-button" onclick="document.getElementById(\'reservation-modal\').style.display=\'none\'" style="margin-top:1rem">Done</button></div>'}).catch(function(){s.textContent="Failed to book. Please try again.",s.className="auth-msg error"})}function ra(){var e=document.querySelector(".cta-button.secondary");e&&e.textContent.indexOf("Reserve")!==-1&&(e.onclick=function(){vt()});var t=document.getElementById("reservation-form");t&&t.addEventListener("submit",n=>{n.preventDefault(),typeof showAuthToast=="function"&&showAuthToast("Reservation request received! We will confirm shortly."),n.target.reset();var a=document.getElementById("reservation-modal");a&&(a.style.display="none")})}Object.assign(window,{openReservationModal:vt,closeReservationModal:aa,submitReservation:gt});function yt(e){e.parentElement.querySelectorAll(".spice-level").forEach(n=>n.classList.remove("active")),e.classList.add("active")}window.selectSpice=yt;function ia(){const e=document.getElementById("reviews-carousel");if(!e)return;let t=0,n;function a(){return window.innerWidth<=768?1:window.innerWidth<=1024?2:3}function o(){const c=e.querySelector(".review-card");if(!c)return 0;const d=window.getComputedStyle(c);return c.offsetWidth+parseFloat(d.marginLeft)+parseFloat(d.marginRight)}function r(){const c=o();e.style.transform="translateX(-".concat(t*c,"px)")}window.moveCarousel=function(c){const d=e.querySelectorAll(".review-card"),p=a(),g=Math.max(0,d.length-p);t=Math.max(0,Math.min(t+c,g)),r(),s()};function i(){const c=e.querySelectorAll(".review-card"),d=a(),p=Math.max(0,c.length-d);t++,t>p&&(t=0),r()}function s(){clearInterval(n),n=setInterval(i,4e3)}const l=document.querySelector(".reviews-carousel-wrapper");l&&(l.addEventListener("mouseenter",()=>{clearInterval(n)}),l.addEventListener("mouseleave",()=>{s()})),window.addEventListener("resize",()=>{t=0,r(),s()}),n=setInterval(i,4e3)}function sa(){const e=document.querySelectorAll(".gallery-slide"),t=document.getElementById("gallery-dots");let n=0;t&&e.length>1&&e.forEach((o,r)=>{const i=document.createElement("button");i.className="gallery-dot"+(r===0?" active":""),i.addEventListener("click",()=>a(r)),t.appendChild(i)});function a(o){e.forEach(i=>i.classList.remove("active")),e[o]&&e[o].classList.add("active"),n=o,document.querySelectorAll(".gallery-dot").forEach((i,s)=>i.classList.toggle("active",s===o))}window.moveGallerySlide=function(o){if(e.length===0)return;let r=(n+o+e.length)%e.length;a(r)},e.length>1&&setInterval(()=>{window.moveGallerySlide(1)},5e3)}function la(){const e=document.querySelectorAll(".gallery-item img"),t=document.querySelectorAll(".gallery-slide-item img"),n=[...e,...t],a=document.getElementById("lightbox"),o=document.getElementById("lightbox-img");let r=0;n.forEach((i,s)=>{i.addEventListener("click",()=>{r=s,o.src=i.src,a.classList.add("active"),G()})}),window.closeLightbox=function(){a.classList.remove("active"),D()},window.navigateLightbox=function(i){r=(r+i+n.length)%n.length,o.src=n[r].src},document.addEventListener("keydown",i=>{a.classList.contains("active")&&(i.key==="Escape"&&window.closeLightbox(),i.key==="ArrowLeft"&&window.navigateLightbox(-1),i.key==="ArrowRight"&&window.navigateLightbox(1))})}function ca(e){if(e){var t=document.getElementById("video-lightbox"),n=document.getElementById("lightbox-video");!t||!n||(n.src=e,t.style.display="flex",n.play())}}function da(){var e=document.getElementById("video-lightbox"),t=document.getElementById("lightbox-video");e&&(e.style.display="none"),t&&(t.pause(),t.src="")}function ht(e){var t=A();if(t){var n=document.getElementById("review-modal");n||(n=document.createElement("div"),n.id="review-modal",n.className="modal",n.innerHTML='<div class="modal-content review-modal-content"></div>',document.body.appendChild(n),n.addEventListener("click",function(r){r.target===n&&(n.style.display="none")}));var a=e||I.map(function(r){return{name:r.name}}),o="<span class=\"close\" onclick=\"document.getElementById('review-modal').style.display='none'\">&times;</span>";o+='<h2>Rate Your Order</h2><p class="review-subtitle">Help us serve you better!</p>',o+='<div id="review-items">',a.forEach(function(r,i){o+='<div class="review-item" data-item="'+r.name+'"><span class="review-item-name">'+r.name+'</span><div class="review-stars" data-idx="'+i+'">';for(var s=1;s<=5;s++)o+='<span class="review-star" data-star="'+s+'" onclick="setReviewStar(this, '+i+", "+s+')">&#9734;</span>';o+="</div></div>"}),o+="</div>",o+='<textarea id="review-text" class="review-textarea" placeholder="Share your thoughts (optional)" maxlength="200"></textarea>',o+='<button class="cta-button" onclick="submitReviews()">Submit Review</button><span style="color:#D4A017;font-size:0.75rem;margin-left:8px">Earn 25 pts</span>',n.querySelector(".review-modal-content").innerHTML=o,n.style.display="block",window._reviewRatings=new Array(a.length).fill(0),window._reviewItems=a}}function ua(e,t,n){window._reviewRatings[t]=n;var a=e.parentElement;a.querySelectorAll(".review-star").forEach(function(o,r){o.innerHTML=r<n?"&#9733;":"&#9734;",o.classList.toggle("active",r<n)})}function ma(){var e=A();if(e){var t=document.getElementById("review-text").value.trim(),n=M(),a=n.batch(),o=!1;if(window._reviewItems.forEach(function(r,i){var s=window._reviewRatings[i];if(s>0){o=!0;var l=n.collection("reviews").doc();a.set(l,{itemName:r.name,rating:s,text:t,userName:e.name,userPhone:e.phone,createdAt:new Date().toISOString()})}}),!o){k("Please rate at least one item");return}a.commit().then(function(){document.getElementById("review-modal").style.display="none",k("Thank you for your review!");var r=A();if(r){r.loyaltyPoints=(r.loyaltyPoints||0)+25,_(r);var i=M();i&&i.collection("users").doc(r.phone).update({loyaltyPoints:r.loyaltyPoints}).catch(function(s){console.error("Review loyalty update error:",s)}),setTimeout(function(){k("+25 loyalty points for your review!")},1500)}setTimeout(function(){typeof window.loadMenuRatings=="function"&&window.loadMenuRatings()},1e3)}).catch(function(){k("Failed to submit review. Please try again.")})}}function fa(e){setTimeout(function(){A()&&ht(e)},6e4)}function pa(){var e={biryanis:[{name:"Veg Dum Biryani",price:179},{name:"Paneer Biryani",price:219},{name:"Egg Biryani",price:189},{name:"Chicken Fry Piece Biryani",price:219},{name:"Chicken 65 Biryani",price:249},{name:"Boneless Chicken Biryani",price:219}],starters:[{name:"Veg Manchurian",price:169},{name:"Paneer 65",price:189},{name:"Chicken 65",price:200},{name:"Chicken Hot Wings",price:220},{name:"Chilli Chicken",price:200}],drinks:[{name:"Tea",price:30},{name:"Coffee",price:40},{name:"Lassi",price:50},{name:"Buttermilk",price:35},{name:"Fresh Lime Soda",price:45}]},t={biryani:null,starter:null,drink:null},n=.15;function a(s,l,c){var d=document.getElementById(s);d&&(d.innerHTML=l.map(function(p){return'<button class="combo-option" data-category="'+c+'" data-name="'+p.name+'" data-price="'+p.price+'"><span class="combo-opt-name">'+p.name+'</span><span class="combo-opt-price">â‚¹'+p.price+"</span></button>"}).join(""))}function o(){a("combo-biryanis",e.biryanis,"biryani"),a("combo-starters",e.starters,"starter"),a("combo-drinks",e.drinks,"drink")}document.addEventListener("click",function(s){var l=s.target.closest(".combo-option");if(l){var c=l.dataset.category,d=l.dataset.name,p=parseInt(l.dataset.price);l.parentElement.querySelectorAll(".combo-option").forEach(function(g){g.classList.remove("selected")}),l.classList.add("selected"),t[c]={name:d,price:p},r()}});function r(){var s=document.getElementById("combo-selected"),l=document.getElementById("combo-original"),c=document.getElementById("combo-total"),d=document.getElementById("combo-add-btn");if(s){var p=[],g=0;if(t.biryani&&(p.push(t.biryani.name),g+=t.biryani.price),t.starter&&(p.push(t.starter.name),g+=t.starter.price),t.drink&&(p.push(t.drink.name),g+=t.drink.price),s.textContent=p.length>0?p.join(" + "):"Select items above",g>0){var h=Math.round(g*(1-n));l.textContent="â‚¹"+g,l.style.textDecoration="line-through",c.textContent="â‚¹"+h}else l.textContent="",c.textContent="";d&&(d.disabled=!(t.biryani&&t.starter&&t.drink))}}window.openComboModal=function(){o(),t={biryani:null,starter:null,drink:null},r();var s=document.getElementById("combo-modal");s&&(s.style.display="block",G())},window.closeComboModal=function(){var s=document.getElementById("combo-modal");s&&(s.style.display="none",D())};var i=document.getElementById("combo-modal");i&&i.addEventListener("click",function(s){s.target===i&&window.closeComboModal()}),window.addComboToCart=function(){if(!(!t.biryani||!t.starter||!t.drink)){var s=t.biryani.price+t.starter.price+t.drink.price,l=Math.round(s*(1-n)),c="Combo: "+t.biryani.name+" + "+t.starter.name+" + "+t.drink.name,d=I.find(function(p){return p.name===c});d?d.quantity++:I.push({name:c,price:l,quantity:1}),K(),ae(),oe(),xe(),k("Combo added! You saved â‚¹"+(s-l)),window.closeComboModal()}}}function bt(){for(var e=new Date,t=e.getDay(),n=e.getHours(),a=0;a<Je.length;a++){var o=Je[a];if(o.days.indexOf(t)!==-1&&n>=o.startHour&&n<o.endHour)return o}return null}function Ke(){var e=bt(),t=document.getElementById("happy-hour-banner");if(!e){t&&(t.style.display="none"),document.querySelectorAll(".hh-price").forEach(function(s){s.remove()}),document.querySelectorAll(".price.hh-crossed").forEach(function(s){s.classList.remove("hh-crossed")});return}if(!t){t=document.createElement("div"),t.id="happy-hour-banner",t.className="happy-hour-banner";var n=document.getElementById("menu");n&&n.insertBefore(t,n.firstChild)}var a=new Date;a.setHours(e.endHour,0,0,0);var o=Math.max(0,a-new Date),r=Math.floor(o/6e4),i=Math.floor(o%6e4/1e3);t.innerHTML='<span class="hh-icon">ðŸ”¥</span> <strong class="hh-text">'+e.label+'</strong> <span class="hh-timer">Ends in '+r+"m "+i+"s</span>",t.style.display="flex",document.querySelectorAll(".menu-item-card").forEach(function(s){var l=s.querySelector(".price");if(l){var c=s.closest(".menu-category");if(c){var d=(c.id||"").toLowerCase(),p=e.categories.indexOf("all")!==-1;if(p||e.categories.forEach(function(L){d.indexOf(L)!==-1&&(p=!0)}),!!p){var g=parseInt(l.textContent.replace(/[^\d]/g,"")),h=Math.round(g*(1-e.discount/100));l.classList.add("hh-crossed");var x=s.querySelector(".hh-price");if(x)x.textContent="â‚¹"+h;else{var C=document.createElement("span");C.className="hh-price",C.textContent="â‚¹"+h,l.after(C)}}}}})}function wt(){if(I.length===0)return[];var e={},t=I.map(function(a){return a.name});t.forEach(function(a){var o=tt[a]||[];o.forEach(function(r){t.indexOf(r)===-1&&ve[r]&&(e[r]=(e[r]||0)+1)})});var n=Object.keys(e).sort(function(a,o){return e[o]-e[a]});return n.slice(0,4).map(function(a){return{name:a,price:ve[a]}})}function Ue(){var e=document.getElementById("cart-recommendations");if(e){var t=wt();if(t.length===0){e.style.display="none";return}var n='<p class="rec-title">You might also like:</p><div class="rec-items">';t.forEach(function(a){n+='<button class="rec-item" onclick="addToCart(\''+a.name.replace(/'/g,"\\'")+"', "+a.price+'); displayCart(); showRecommendations();"><span class="rec-name">'+a.name+'</span><span class="rec-price">â‚¹'+a.price+'</span><span class="rec-add">+</span></button>'}),n+="</div>",e.innerHTML=n,e.style.display="block"}}var ce=!1,X=null;function Et(){var e=window.SpeechRecognition||window.webkitSpeechRecognition;if(e){X=new e,X.continuous=!1,X.interimResults=!0;var t={en:"en-IN",hi:"hi-IN",te:"te-IN"};X.lang=t[de]||"en-IN",X.onresult=function(a){for(var o="",r=a.resultIndex;r<a.results.length;r++)o+=a.results[r][0].transcript;va(o),a.results[a.resultIndex].isFinal&&ga(o)},X.onend=function(){ce&&(ce=!1,Z())},X.onerror=function(){ce=!1,Z()};var n=document.createElement("button");n.id="voice-order-btn",n.className="voice-order-btn",n.innerHTML='<svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg>',n.title="Voice Order",n.onclick=xt,document.body.appendChild(n)}}function xt(){ce?(X.stop(),ce=!1,Z()):(ce=!0,Ct(),X.start())}function Ct(){var e=document.getElementById("voice-overlay");e||(e=document.createElement("div"),e.id="voice-overlay",e.className="voice-overlay",e.innerHTML='<div class="voice-content"><div class="voice-waves"><span></span><span></span><span></span><span></span><span></span></div><p class="voice-status">Listening...</p><p class="voice-transcript" id="voice-transcript"></p><p class="voice-hint">Say "Add chicken biryani" or "2 butter naan"</p><button class="voice-close" onclick="toggleVoice()">Cancel</button></div>',document.body.appendChild(e)),e.classList.add("active"),document.getElementById("voice-transcript").textContent=""}function Z(){var e=document.getElementById("voice-overlay");e&&e.classList.remove("active")}function va(e){var t=document.getElementById("voice-transcript");t&&(t.textContent=e)}function ga(e){if(e=e.toLowerCase().trim(),e.indexOf("my usual")!==-1||e.indexOf("same as last")!==-1||e.indexOf("last order")!==-1){var t=null;try{t=JSON.parse(localStorage.getItem("amoghaMyOrders"))}catch(l){}if(t&&t.length>0&&t[0].id){typeof window.reorderFromHistory=="function"&&window.reorderFromHistory(t[0].id),k("Reordering your last order!"),Z();return}}var n=e.match(/^(?:add\s+)?(\d+)\s+/),a=n?parseInt(n[1]):1,o=e.replace(/^(?:add\s+)?(\d+\s+)?/,"").replace(/^add\s+/,""),r=null,i=0;if(Object.keys(ve).forEach(function(l){var c=l.toLowerCase(),d=0;if(c===o)d=100;else if(c.indexOf(o)!==-1)d=80;else if(o.indexOf(c)!==-1)d=70;else{var p=o.split(" ");p.forEach(function(g){g.length>2&&c.indexOf(g)!==-1&&(d+=20)})}d>i&&(i=d,r=l)}),r&&i>=20){for(var s=0;s<a;s++)ie(r,ve[r]);k("Added "+a+"x "+r+" to cart"),Z()}else e.indexOf("checkout")!==-1||e.indexOf("check out")!==-1?(typeof window.checkout=="function"&&window.checkout(),Z()):e.indexOf("clear")!==-1?(typeof window.clearCart=="function"&&window.clearCart(),Z()):(Z(),k("AI is interpreting your request..."),fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:e,cart:[]})}).then(function(l){return l.json()}).then(function(l){l.suggestedItems&&l.suggestedItems.length>0?(l.suggestedItems.forEach(function(c){ie(c.name,c.price)}),k("Added "+l.suggestedItems.length+" item(s) via AI")):k(l.reply||"Could not understand. Try again.")}).catch(function(){k('Could not find: "'+o+'". Try again.')}))}var de=V("amoghaLang")||"en";function ya(e){de=e,J("amoghaLang",e),We(),document.querySelectorAll(".lang-btn").forEach(function(t){t.classList.toggle("active",t.dataset.lang===e)})}function We(){var e=$e[de]||$e.en;document.querySelectorAll("[data-i18n]").forEach(function(t){var n=t.dataset.i18n;e[n]&&((t.tagName==="INPUT"||t.tagName==="TEXTAREA")&&t.placeholder!==void 0?t.placeholder=e[n]:t.textContent=e[n])})}function St(e){if(!e)return"";var t=(e.name||"USER").replace(/[^A-Za-z]/g,"").toUpperCase().slice(0,4),n=(e.phone||"0000").slice(-4);return t+n}function ha(){var e=A();if(!e){typeof window.openAuthModal=="function"&&window.openAuthModal();return}var t=e.referralCode||St(e);if(!e.referralCode){e.referralCode=t,_(e);var n=M();n&&n.collection("users").doc(e.phone).update({referralCode:t}).catch(function(r){console.error("Referral code save error:",r)})}var a=document.getElementById("referral-modal");a||(a=document.createElement("div"),a.id="referral-modal",a.className="modal",a.innerHTML='<div class="modal-content referral-content"></div>',document.body.appendChild(a),a.addEventListener("click",function(r){r.target===a&&(a.style.display="none")}));var o="Order from Amogha Cafe & get Rs.50 off your first order! Use my referral code: "+t+" when signing up. Order at "+window.location.origin;a.querySelector(".referral-content").innerHTML='<span class="close" onclick="document.getElementById(\'referral-modal\').style.display=\'none\'">&times;</span><h2>Refer a Friend</h2><p class="referral-subtitle">Share your code and both get rewarded!</p><div class="referral-code-box"><span class="referral-code">'+t+'</span><button class="referral-copy" onclick="safeCopy(\''+t+'\',this)">Copy</button></div><div class="referral-rewards"><div class="referral-reward"><span class="referral-reward-icon">ðŸŽ</span><span>Your friend gets <strong>Rs.50 off</strong> first order</span></div><div class="referral-reward"><span class="referral-reward-icon">â­</span><span>You get <strong>100 loyalty points</strong></span></div></div><a class="whatsapp-btn referral-share" href="https://wa.me/?text='+encodeURIComponent(o)+'" target="_blank">Share via WhatsApp</a>',a.style.display="block"}function ba(){var e=document.getElementById("referral-modal");e&&(e.style.display="none")}function wa(e){if(e){var t=M();t&&(e=e.toUpperCase().trim(),t.collection("users").where("referralCode","==",e).limit(1).get().then(function(n){if(!n.empty){var a=n.docs[0],o=a.data(),r=A();!r||o.phone===r.phone||(t.collection("referrals").add({referrerPhone:o.phone,refereePhone:r.phone,redeemed:!1,createdAt:new Date().toISOString()}).catch(function(i){console.error("Referral save error:",i)}),r.referralDiscount=50,_(r),k("Referral applied! Rs.50 off your first order!"))}}))}}function Ea(){var e=A();if(!e){typeof window.openAuthModal=="function"&&window.openAuthModal();return}var t=document.getElementById("myorders-modal");t||(t=document.createElement("div"),t.id="myorders-modal",t.className="modal",t.innerHTML='<div class="modal-content myorders-content"><span class="close" onclick="document.getElementById(\'myorders-modal\').style.display=\'none\'">&times;</span><h2>My Orders</h2><div id="myorders-list" class="myorders-list"><p>Loading...</p></div></div>',document.body.appendChild(t),t.addEventListener("click",function(o){o.target===t&&(t.style.display="none")})),t.style.display="block";var n=document.getElementById("myorders-list");n.innerHTML='<p style="text-align:center;color:#a09080">Loading orders...</p>';var a=M();if(!a){n.innerHTML='<p style="text-align:center;color:#a09080;padding:2rem">Service unavailable. Please refresh.</p>';return}a.collection("orders").where("userId","==",e.phone).orderBy("createdAt","desc").limit(10).get().then(function(o){if(o.empty){n.innerHTML='<p style="text-align:center;color:#a09080;padding:2rem">No orders yet. Place your first order!</p>';return}var r="";o.forEach(function(i){var s=i.data(),l=s.createdAt?new Date(s.createdAt):new Date,c=l.toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"}),d={pending:"#f39c12",confirmed:"#3498db",preparing:"#e67e22",delivered:"#27ae60",cancelled:"#e74c3c"},p=d[s.status]||"#999",g=(s.items||[]).map(function(h){return h.name+" x"+h.qty}).join(", ");r+='<div class="myorder-card"><div class="myorder-header"><span class="myorder-date">'+c+'</span><span class="myorder-status" style="color:'+p+'">'+(s.status||"pending").toUpperCase()+'</span></div><p class="myorder-items">'+g+'</p><div class="myorder-footer"><span class="myorder-total">Rs.'+(s.total||0)+'</span><button class="myorder-reorder-btn" onclick="reorderFromHistory(\''+i.id+"')\">Order Again</button></div></div>"}),n.innerHTML=r,J("amoghaMyOrders",JSON.stringify(o.docs.map(function(i){return{id:i.id,data:i.data()}})))}).catch(function(o){console.error("Load orders error:",o);var r=V("amoghaMyOrders");if(r){var i=JSON.parse(r),s="";i.forEach(function(l){var c=l.data,d=c.createdAt?new Date(c.createdAt):new Date,p=d.toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"}),g=(c.items||[]).map(function(h){return h.name+" x"+h.qty}).join(", ");s+='<div class="myorder-card"><div class="myorder-header"><span class="myorder-date">'+p+'</span><span class="myorder-status">'+(c.status||"").toUpperCase()+'</span></div><p class="myorder-items">'+g+'</p><div class="myorder-footer"><span class="myorder-total">Rs.'+(c.total||0)+'</span><button class="myorder-reorder-btn" onclick="reorderFromHistory(\''+l.id+"')\">Order Again</button></div></div>"}),n.innerHTML=s}else n.innerHTML='<p style="text-align:center;color:#e74c3c">Failed to load orders. Please try again.</p>'})}function xa(){var e=document.getElementById("myorders-modal");e&&(e.style.display="none")}function Ca(e){var t=V("amoghaMyOrders");if(t){var n=JSON.parse(t),a=n.find(function(r){return r.id===e});if(a&&a.data.items){a.data.items.forEach(function(r){for(var i=0;i<r.qty;i++)ie(r.name,r.price)}),document.getElementById("myorders-modal").style.display="none",k("Items added to cart! Review and checkout.");return}}var o=M();o.collection("orders").doc(e).get().then(function(r){r.exists&&r.data().items&&(r.data().items.forEach(function(i){for(var s=0;s<i.qty;s++)ie(i.name,i.price)}),document.getElementById("myorders-modal").style.display="none",k("Items added to cart! Review and checkout."))})}function Sa(){var e=document.getElementById("schedule-order-check"),t=document.getElementById("schedule-fields"),n=document.getElementById("schedule-date"),a=document.getElementById("schedule-time");if(!e||!t||!n||!a)return;e.addEventListener("change",function(){t.style.display=this.checked?"block":"none",this.checked&&(o(),r())});function o(){var i=new Date,s=i.toISOString().split("T")[0],l=new Date(i);l.setDate(l.getDate()+3);var c=l.toISOString().split("T")[0];n.min=s,n.max=c,n.value=s}function r(){var i=["11:00 AM","11:30 AM","12:00 PM","12:30 PM","1:00 PM","1:30 PM","2:00 PM","2:30 PM","3:00 PM","3:30 PM","4:00 PM","4:30 PM","5:00 PM","5:30 PM","6:00 PM","6:30 PM","7:00 PM","7:30 PM","8:00 PM","8:30 PM","9:00 PM"];a.innerHTML='<option value="">Select Time</option>',i.forEach(function(s){a.innerHTML+='<option value="'+s+'">'+s+"</option>"})}window.getScheduleInfo=function(){return e.checked?{date:n.value,time:a.value}:null}}function Ia(){ia(),sa(),la(),pa(),Ke(),setInterval(Ke,6e4),setTimeout(Et,1e3),setTimeout(function(){var t=document.querySelector(".nav-links");if(t){var n=document.createElement("li");n.className="lang-switcher",n.innerHTML='<button class="lang-btn'+(de==="en"?" active":"")+'" data-lang="en" onclick="switchLanguage(\'en\')">EN</button><button class="lang-btn'+(de==="hi"?" active":"")+'" data-lang="hi" onclick="switchLanguage(\'hi\')">à¤¹à¤¿</button><button class="lang-btn'+(de==="te"?" active":"")+'" data-lang="te" onclick="switchLanguage(\'te\')">à°¤à±†</button>';var a=t.querySelector(".theme-toggle");a?t.insertBefore(n,a.parentElement):t.appendChild(n),We()}},500),setTimeout(function(){typeof window.loadMenuRatings=="function"&&window.loadMenuRatings()},2e3),Sa(),setTimeout(At,1500);var e=window.displayCart;typeof e=="function"&&(window.displayCart=function(){e(),Ue()})}function ka(e){var t=[],n;for(n=0;n<e.length;n++)t.push(e[n].name);var a=[],o={};for(n=0;n<e.length;n++){var r=e[n].name,i=tt[r];if(i)for(var s=0;s<i.length;s++){var l=i[s];if(t.indexOf(l)===-1&&!o[l]){var c=ve[l];if(c&&(o[l]=!0,a.push({name:l,price:c,reason:"Goes great with "+r}),a.length>=3))return a}}}return a}Object.assign(window,{selectSpice:yt,moveCarousel:window.moveCarousel,moveGallerySlide:window.moveGallerySlide,closeLightbox:window.closeLightbox,navigateLightbox:window.navigateLightbox,openVideoLightbox:ca,closeVideoLightbox:da,openReviewModal:ht,setReviewStar:ua,submitReviews:ma,scheduleReviewPrompt:fa,openComboModal:window.openComboModal,closeComboModal:window.closeComboModal,addComboToCart:window.addComboToCart,getActiveHappyHour:bt,getRecommendations:wt,showRecommendations:Ue,initVoiceOrdering:Et,toggleVoice:xt,showVoiceOverlay:Ct,switchLanguage:ya,applyTranslations:We,openReferralModal:ha,closeReferralModal:ba,generateReferralCode:St,applyReferralAtSignup:wa,openMyOrders:Ea,closeMyOrders:xa,reorderFromHistory:Ca,loadDailySpecial:It,initComboBuilder:kt,getUpsellItems:ka});function La(){var e=null;try{e=JSON.parse(localStorage.getItem("amoghaMyOrders"))}catch(i){}if(!(!e||!e.length)){var t=e[0].data;if(!(!t||!t.items||!t.items.length)){if(t.createdAt){var n=(Date.now()-new Date(t.createdAt).getTime())/864e5;if(n<1)return}var a=t.items.slice(0,2).map(function(i){return i.name}).join(", ");t.items.length>2&&(a+=" +"+(t.items.length-2)+" more");var o=document.createElement("div");o.className="reorder-toast",o.innerHTML='<div class="reorder-toast-text"><div class="reorder-toast-title">Welcome back! ðŸ‘‹</div><div class="reorder-toast-sub">'+a+'</div></div><button class="reorder-toast-btn" id="reorder-toast-btn">Order Again</button><button class="reorder-toast-close" id="reorder-toast-close">&times;</button>',document.body.appendChild(o),setTimeout(function(){o.classList.add("show")},100);var r=e[0].id;o.querySelector("#reorder-toast-btn").addEventListener("click",function(){typeof window.reorderFromHistory=="function"&&window.reorderFromHistory(r),o.classList.remove("show"),setTimeout(function(){o.remove()},400)}),o.querySelector("#reorder-toast-close").addEventListener("click",function(){o.classList.remove("show"),setTimeout(function(){o.remove()},400)}),setTimeout(function(){o.classList.remove("show"),setTimeout(function(){o.parentNode&&o.remove()},400)},8e3)}}}function It(){var e=document.getElementById("daily-special-section");if(e){var t=null;try{t=window.db}catch(n){}if(!t){e.style.display="none";return}t.collection("settings").doc("dailySpecial").get().then(function(n){if(!n.exists||!n.data().active){e.style.display="none";return}var a=n.data();e.style.display="";var o=e.querySelector(".daily-special-img"),r=e.querySelector(".daily-special-img-placeholder"),i=e.querySelector(".daily-special-title"),s=e.querySelector(".daily-special-desc"),l=e.querySelector(".daily-special-price"),c=e.querySelector(".daily-special-add-btn");a.imageUrl&&o&&(o.src=a.imageUrl,o.style.display="block",r&&(r.style.display="none")),i&&(i.textContent=a.title||"Chef's Special"),s&&(s.textContent=a.description||""),l&&(l.innerHTML="&#8377;"+(a.price||"")),c&&a.title&&(c.dataset.item=a.title,c.dataset.price=a.price||0);function d(){var p=new Date,g=new Date;g.setHours(24,0,0,0);var h=Math.max(0,g-p),x=Math.floor(h/36e5),C=Math.floor(h%36e5/6e4),L=Math.floor(h%6e4/1e3),q=e.querySelector(".cd-h"),T=e.querySelector(".cd-m"),H=e.querySelector(".cd-s");q&&(q.textContent=String(x).padStart(2,"0")),T&&(T.textContent=String(C).padStart(2,"0")),H&&(H.textContent=String(L).padStart(2,"0"))}d(),setInterval(d,1e3)}).catch(function(){e.style.display="none"})}}function kt(){var e=document.getElementById("combo-builder-section");if(!e)return;var t={starter:["Veg Manchurian","Paneer 65","Chicken 65","Chicken Hot Wings","Veg Spring Rolls","Chicken Lollipop","Paneer Tikka","Chicken Seekh Kebab","Tandoori Chicken"],main:["Paneer Butter Masala","Dal Tadka","Butter Chicken","Chicken Curry","Mutton Curry","Gongura Chicken","Veg Dum Biryani","Chicken Dum Biryani","Mutton Dum Biryani"],bread:["Butter Naan","Garlic Naan","Tandoori Roti","Butter Roti","Laccha Paratha"],drink:["Tea","Coffee","Lassi","Buttermilk","Fresh Lime Soda","Hot Chocolate"]},n={};try{document.querySelectorAll(".menu-item-card[data-id]").forEach(function(s){var l=s.querySelector(".add-to-cart");l&&(n[s.dataset.id]=parseFloat(l.dataset.price)||0)})}catch(s){}var a={"Veg Manchurian":169,"Paneer 65":189,"Chicken 65":200,"Chicken Hot Wings":220,"Veg Spring Rolls":149,"Chicken Lollipop":230,"Paneer Tikka":209,"Chicken Seekh Kebab":229,"Tandoori Chicken":269,"Paneer Butter Masala":199,"Dal Tadka":149,"Butter Chicken":249,"Chicken Curry":219,"Mutton Curry":319,"Gongura Chicken":239,"Veg Dum Biryani":199,"Chicken Dum Biryani":249,"Mutton Dum Biryani":349,"Butter Naan":40,"Garlic Naan":50,"Tandoori Roti":30,"Butter Roti":35,"Laccha Paratha":45,Tea:30,Coffee:40,Lassi:50,Buttermilk:35,"Fresh Lime Soda":45,"Hot Chocolate":60};Object.keys(a).forEach(function(s){n[s]||(n[s]=a[s])});function o(s,l){var c=e.querySelector("#"+s);c&&(c.innerHTML='<option value="">â€” Choose â€”</option>'+l.map(function(d){var p=n[d]||0;return'<option value="'+d+'" data-price="'+p+'">'+d+" (â‚¹"+p+")</option>"}).join(""))}o("combo-starter",t.starter),o("combo-main",t.main),o("combo-bread",t.bread),o("combo-drink",t.drink);function r(){var s=0;["combo-starter","combo-main","combo-bread","combo-drink"].forEach(function(x){var C=e.querySelector("#"+x);if(C&&C.value){var L=C.options[C.selectedIndex];s+=parseFloat(L.dataset.price)||0}});var l=Math.round(s*.8),c=s-l,d=e.querySelector(".combo-original"),p=e.querySelector(".combo-discounted"),g=e.querySelector(".combo-savings"),h=e.querySelector(".combo-add-btn");d&&(d.textContent=s>0?"â‚¹"+s:""),p&&(p.textContent=s>0?"â‚¹"+l:"â‚¹0"),g&&(g.textContent=s>0?"Save â‚¹"+c:""),h&&(h.disabled=s===0)}e.querySelectorAll("select").forEach(function(s){s.addEventListener("change",r)}),r();var i=e.querySelector(".combo-add-btn");i&&i.addEventListener("click",function(){var s=0;["combo-starter","combo-main","combo-bread","combo-drink"].forEach(function(l){var c=e.querySelector("#"+l);if(!(!c||!c.value)){var d=c.options[c.selectedIndex],p=parseFloat(d.dataset.price)||0,g=Math.round(p*.8);typeof window.finalizeAddToCart=="function"&&window.finalizeAddToCart(c.value,g,"medium",[]),s++}}),s>0&&(i.textContent="âœ“ Added to Cart!",i.style.background="linear-gradient(135deg,#27ae60,#2ecc71)",setTimeout(function(){i.textContent="Add Combo to Cart",i.style.background=""},2e3))})}function Lt(){const e=M();if(!e)return;const t=document.querySelector(".bar-ticker-track");t&&e.collection("orders").orderBy("createdAt","desc").limit(6).get().then(function(n){const a=[];if(n.forEach(function(i){const s=i.data(),l=s.items&&s.items[0]&&s.items[0].name?s.items[0].name:null,d=(s.customerName||s.userName||"").split(" ")[0]||"Someone";l&&a.push({firstName:d,itemName:l})}),a.length<3)return;function o(i,s){return'<div class="bar-ticker-item"><span>'.concat(i,"</span><span>").concat(s,'</span></div><span class="bar-dot"></span>')}const r=a.map(function(i){return o("ðŸ›","".concat(i.firstName," just ordered ").concat(i.itemName))}).join("");t.innerHTML=r+r}).catch(function(){})}window.initLiveOrderTicker=Lt;function Ba(){const e=document.getElementById("catering-modal");e&&(e.classList.add("active"),G())}window.openCateringModal=Ba;function Bt(){const e=document.getElementById("catering-modal");e&&(e.classList.remove("active"),D())}window.closeCateringModal=Bt;function Ma(){var c,d,p,g,h,x;const e=M(),t=(c=document.getElementById("catering-name"))==null?void 0:c.value.trim(),n=(d=document.getElementById("catering-phone"))==null?void 0:d.value.trim(),a=(p=document.getElementById("catering-event"))==null?void 0:p.value,o=(g=document.getElementById("catering-guests"))==null?void 0:g.value,r=(h=document.getElementById("catering-date"))==null?void 0:h.value,i=(x=document.getElementById("catering-message"))==null?void 0:x.value.trim(),s=document.getElementById("catering-submit-btn");if(!t||!n||!a||!o||!r){alert("Please fill in all required fields.");return}s&&(s.disabled=!0,s.textContent="Submittingâ€¦");const l={name:t,phone:n,eventType:a,guestCount:parseInt(o)||0,date:r,message:i||"",createdAt:new Date().toISOString()};(e?e.collection("cateringInquiries").add(l):Promise.reject("no db")).then(function(){Bt();const C=document.createElement("div");C.className="catering-toast",C.textContent="âœ… Catering enquiry received! We'll contact you within 24 hours.",document.body.appendChild(C),setTimeout(function(){C.classList.add("show")},10),setTimeout(function(){C.classList.remove("show"),setTimeout(function(){C.remove()},400)},4e3)}).catch(function(){alert("Could not submit. Please call us at +91 91210 04999."),s&&(s.disabled=!1,s.textContent="Submit Enquiry")})}window.submitCateringEnquiry=Ma;function Mt(){var e=document.getElementById("reorder-section"),t=document.getElementById("reorder-cards");if(!(!e||!t)){var n=A();if(!n){e.style.display="none";return}var a=null;try{a=JSON.parse(localStorage.getItem("amoghaMyOrders"))}catch(i){}if(!a||!a.length){e.style.display="none";return}var o=a.slice(0,3),r="";o.forEach(function(i){var s=i.data,l=s.createdAt?new Date(s.createdAt):new Date,c=l.toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"}),d=(s.items||[]).reduce(function(g,h){return g+(h.qty||1)},0),p=s.total||0;r+='<div class="reorder-card" style="min-width:220px;background:rgba(212,160,23,0.06);border:1px solid rgba(212,160,23,0.15);border-radius:14px;padding:1rem;scroll-snap-align:start;flex-shrink:0"><div style="font-size:0.8rem;color:#a09080;margin-bottom:0.4rem">'+c+'</div><div style="font-size:0.95rem;font-weight:600;color:var(--text-primary,#1a0f08);margin-bottom:0.3rem">'+d+" item"+(d!==1?"s":"")+'</div><div style="font-size:1.05rem;font-weight:700;color:#D4A017;margin-bottom:0.7rem">Rs.'+p+"</div><button onclick=\"reorderFromHistory('"+i.id+'\')" style="width:100%;padding:0.5rem;background:linear-gradient(135deg,#D4A017,#B8860B);color:#1a0f08;border:none;border-radius:8px;font-weight:700;cursor:pointer;font-size:0.85rem">Reorder</button></div>'}),t.innerHTML=r,e.style.display="block"}}window.initOrderAgainSection=Mt;function At(){var e=M();e&&e.collection("settings").doc("dynamicPricing").get().then(function(t){t.exists&&t.data().rules&&(te.length=0,t.data().rules.forEach(function(n){te.push(n)}),Pt())}).catch(function(t){console.error("Dynamic pricing load error:",t)})}window.loadDynamicPricingRules=At;function Tt(e,t){if(!te||te.length===0)return e;for(var n=new Date,a=n.getDay(),o=n.getHours(),r=(t||"").toLowerCase(),i=0;i<te.length;i++){var s=te[i],l=s.day==="all"||parseInt(s.day)===a;if(l&&!(o<parseInt(s.startHour)||o>=parseInt(s.endHour))){for(var c=s.categories||[],d=!1,p=0;p<c.length;p++)if(c[p].toLowerCase()===r){d=!0;break}if(d)return Math.round(e*parseFloat(s.multiplier))}}return e}window.getAdjustedPrice=Tt;function Pt(){!te||te.length===0||document.querySelectorAll(".menu-item-card").forEach(function(e){var t=e.querySelector(".price");if(t&&!t.classList.contains("hh-crossed")){var n=e.closest(".menu-category");if(n){var a="",o=n.querySelector("h2, h3, .category-title");o&&(a=o.textContent.trim()),a||(a=(n.id||"").replace("cat-",""));var r=parseInt(t.textContent.replace(/[^\d]/g,""));if(r){var i=Tt(r,a);if(i===r){var s=e.querySelector(".dp-price");s&&s.remove(),t.classList.remove("dp-crossed");return}t.classList.add("dp-crossed");var l=e.querySelector(".dp-price");if(l)l.textContent="â‚¹"+i;else{var c=document.createElement("span");c.className="dp-price",c.textContent="â‚¹"+i,t.after(c)}}}}})}window.applyDynamicPricing=Pt;async function Aa(){var e=document.getElementById("ai-for-you"),t=document.getElementById("ai-for-you-cards");if(!(!e||!t)){try{var n=JSON.parse(localStorage.getItem("ai_recommendations"));if(n&&Date.now()-n.ts<18e5){Qe(e,t,n.data);return}}catch(l){}var a=A(),o=[];try{var r=JSON.parse(localStorage.getItem("amoghaMyOrders"));r&&(o=r.map(function(l){return l.data}))}catch(l){}try{var i=await fetch("/api/recommend",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({orderHistory:o.slice(0,10),currentCart:I.map(function(l){return{name:l.name}}),timeOfDay:new Date().getHours(),isVegOnly:a&&(a.dietaryPrefs||[]).includes("Vegetarian")})}),s=await i.json();if(s.recommendations&&s.recommendations.length>0){Qe(e,t,s.recommendations);try{localStorage.setItem("ai_recommendations",JSON.stringify({ts:Date.now(),data:s.recommendations}))}catch(l){}}}catch(l){e.style.display="none"}}}function Qe(e,t,n){var a="";n.forEach(function(o){a+='<div class="ai-rec-card"><div class="ai-rec-name">'+o.name+'</div><div class="ai-rec-reason">'+(o.reason||"")+'</div><div class="ai-rec-price">&#8377;'+o.price+'</div><button class="add-to-cart" onclick="addToCart(\''+o.name.replace(/'/g,"\\'")+"', "+o.price+', this)">Add to Order</button></div>'}),t.innerHTML=a,e.style.display="block"}function Ta(){var e=document.getElementById("meal-planner-overlay");e&&e.remove();var t=document.createElement("div");t.id="meal-planner-overlay",t.className="meal-planner-overlay",t.onclick=function(n){n.target===t&&t.remove()},t.innerHTML='<div class="meal-planner-card"><div class="meal-planner-header"><h2><span class="ai-badge">AI</span> 7-Day Meal Planner</h2><button onclick="closeMealPlanner()" style="background:none;border:none;color:#a09080;font-size:1.5rem;cursor:pointer">&times;</button></div><div class="meal-planner-controls"><select id="mp-dietary"><option value="all">All</option><option value="veg">Veg Only</option><option value="non-veg">Non-Veg Only</option></select><input type="number" id="mp-budget" placeholder="Daily budget (Rs.)" min="100" max="5000" style="width:140px"><input type="number" id="mp-people" placeholder="People" min="1" max="10" value="1" style="width:80px"></div><button class="meal-planner-generate" onclick="generateMealPlan()">Generate AI Meal Plan</button><div id="meal-plan-result"></div></div>',document.body.appendChild(t)}function Pa(){var e=document.getElementById("meal-planner-overlay");e&&e.remove()}async function Na(){var e=document.getElementById("meal-plan-result");if(e){e.innerHTML='<div class="insights-loading">Generating your personalized meal plan...</div>';try{var t=await fetch("/api/meal-plan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({dietary:document.getElementById("mp-dietary").value,budget:parseInt(document.getElementById("mp-budget").value)||0,people:parseInt(document.getElementById("mp-people").value)||1})}),n=await t.json(),a='<div class="meal-plan-grid">';n.days&&n.days.forEach(function(o){a+='<div class="meal-day-card"><h4>'+o.day+"</h4>",(o.meals||[]).forEach(function(r){a+='<div style="font-size:.68rem;color:#D4A017;font-weight:600;text-transform:uppercase;margin-top:6px">'+r.mealType+"</div>",(r.items||[]).forEach(function(i){a+='<div class="meal-item">'+i.name+" x"+(i.qty||1)+" â€” &#8377;"+i.price+"</div>"})}),a+="</div>"}),a+="</div>",n.totalCost&&(a+='<div class="meal-plan-summary"><span>Total: &#8377;'+n.totalCost+"</span><span>Daily avg: &#8377;"+(n.dailyAverage||Math.round(n.totalCost/7))+"</span></div>"),n.tips&&n.tips.length>0&&(a+='<ul class="meal-plan-tips">',n.tips.forEach(function(o){a+="<li>"+o+"</li>"}),a+="</ul>"),e.innerHTML=a}catch(o){e.innerHTML='<p style="color:#e74c3c;font-size:.85rem;text-align:center">Failed to generate meal plan. Please try again.</p>'}}}window.openMealPlannerModal=Ta;window.closeMealPlanner=Pa;window.generateMealPlan=Na;var ue=[{id:"first_bite",name:"First Bite",description:"Place your first order",icon:"ðŸ½ï¸"},{id:"regular",name:"Regular",description:"5 orders completed",icon:"â­"},{id:"foodie",name:"Foodie",description:"10 orders completed",icon:"ðŸ…"},{id:"super_fan",name:"Super Fan",description:"25 orders completed",icon:"ðŸ†"},{id:"explorer",name:"Explorer",description:"Order from all menu categories",icon:"ðŸ—ºï¸"},{id:"streak_master",name:"Streak Master",description:"3 consecutive days with orders",icon:"ðŸ”¥"},{id:"big_spender",name:"Big Spender",description:"Single order over â‚¹1000",icon:"ðŸ’Ž"},{id:"critic",name:"Critic",description:"Write 5 reviews",icon:"ðŸ“"},{id:"night_owl",name:"Night Owl",description:"Order after 9 PM",icon:"ðŸ¦‰"},{id:"early_bird",name:"Early Bird",description:"Order before 10 AM",icon:"ðŸ¦"}],qa=["starters","curries","biryani","tandoor","noodles","rice","breads","beverages"];function Oa(){return ue.slice()}function Y(e,t){for(var n=e.badges||[],a=0;a<n.length;a++)if(n[a].badgeId===t)return!0;return!1}function Da(e,t){e.badges||(e.badges=[]),e.badges.push({badgeId:t,earnedAt:new Date().toISOString()}),_(e);var n=M();n&&e.phone&&n.collection("users").doc(e.phone).update({badges:e.badges}).catch(function(r){console.error("Badge save error:",r)});for(var a=null,o=0;o<ue.length;o++)if(ue[o].id===t){a=ue[o];break}a&&Ra(a)}function Ra(e){var t=document.getElementById("badge-toast");t||(t=document.createElement("div"),t.id="badge-toast",t.className="badge-toast",document.body.appendChild(t)),t.innerHTML='<span style="font-size:1.4rem">'+e.icon+"</span> Badge Unlocked: "+e.name+"!",t.classList.remove("visible"),t.offsetWidth,t.classList.add("visible"),setTimeout(function(){t.classList.remove("visible")},4e3)}function Ha(e,t){if(e){var n=[],a=(e.orderDates||[]).length,o=new Date().toISOString().split("T")[0],r=e.orderDates||[];if(r.indexOf(o)===-1&&a++,!Y(e,"first_bite")&&a>=1&&n.push("first_bite"),!Y(e,"regular")&&a>=5&&n.push("regular"),!Y(e,"foodie")&&a>=10&&n.push("foodie"),!Y(e,"super_fan")&&a>=25&&n.push("super_fan"),!Y(e,"explorer")){var i=e.categoriesOrdered||[];t&&t.items&&(t.items.forEach(function(q){q.category&&i.indexOf(q.category)===-1&&i.push(q.category)}),e.categoriesOrdered=i),i.length>=qa.length&&n.push("explorer")}if(!Y(e,"streak_master")){var s=(e.orderDates||[]).slice();if(s.indexOf(o)===-1&&s.push(o),s.length>=3){var l=s.slice(-3),c=new Date(l[0]),d=new Date(l[1]),p=new Date(l[2]),g=(d-c)/864e5,h=(p-d)/864e5;g===1&&h===1&&n.push("streak_master")}}if(!Y(e,"big_spender")&&t&&t.total>1e3&&n.push("big_spender"),!Y(e,"critic")&&(e.reviewCount||0)>=5&&n.push("critic"),!Y(e,"night_owl")){var x=new Date().getHours();x>=21&&n.push("night_owl")}if(!Y(e,"early_bird")){var C=new Date().getHours();C<10&&n.push("early_bird")}var L=0;n.forEach(function(q){setTimeout(function(){Da(e,q)},L),L+=1500})}}function Fa(){var e=A(),t=e&&e.badges?e.badges:[],n=document.getElementById("badge-gallery-modal");n||(n=document.createElement("div"),n.id="badge-gallery-modal",n.className="badge-gallery-modal",n.innerHTML='<div class="badge-gallery-content"></div>',document.body.appendChild(n),n.addEventListener("click",function(i){i.target===n&&Nt()}));var a=t.length,o=ue.length,r="";ue.forEach(function(i){for(var s=!1,l="",c=0;c<t.length;c++)if(t[c].badgeId===i.id){s=!0;var d=new Date(t[c].earnedAt);l=d.toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"});break}var p=s?"earned":"unearned";r+='<div class="badge-card '+p+'"><span class="badge-card-icon">'+i.icon+'</span><div class="badge-card-name">'+i.name+'</div><div class="badge-card-desc">'+i.description+"</div>"+(s?'<div class="badge-card-date">'+l+"</div>":"")+"</div>"}),n.querySelector(".badge-gallery-content").innerHTML='<button class="badge-gallery-close" onclick="closeBadgeGallery()">&times;</button><div class="badge-gallery-title">Your Badges</div><div class="badge-gallery-subtitle">'+a+" of "+o+' badges earned</div><div class="badge-grid">'+r+"</div>",n.classList.add("show")}function Nt(){var e=document.getElementById("badge-gallery-modal");e&&e.classList.remove("show")}Object.assign(window,{checkAndAwardBadges:Ha,openBadgeGallery:Fa,closeBadgeGallery:Nt,getBadgeDefinitions:Oa});var _a=["Vegetarian","Vegan","Gluten-Free"],za=["Nuts","Dairy","Gluten","Eggs","Soy","Shellfish","Sesame","Fish"];function Ve(){var e=A();if(!e){typeof window.openAuthModal=="function"&&window.openAuthModal();return}var t=document.getElementById("profile-modal");t||(t=document.createElement("div"),t.id="profile-modal",t.className="modal",t.innerHTML='<div class="modal-content" style="max-width:520px;max-height:90vh;overflow-y:auto;"></div>',document.body.appendChild(t),t.addEventListener("click",function(l){l.target===t&&pe()}));var n=e.dietaryPrefs||[],a=e.allergenAlerts||[],o=e.savedAddresses||[],r=_a.map(function(l){var c=n.indexOf(l)!==-1?" checked":"";return'<label style="display:flex;align-items:center;gap:8px;cursor:pointer;"><input type="checkbox" class="profile-dietary-cb" value="'+l+'"'+c+"> "+l+"</label>"}).join(""),i=za.map(function(l){var c=a.indexOf(l)!==-1?" checked":"";return'<label style="display:flex;align-items:center;gap:8px;cursor:pointer;"><input type="checkbox" class="profile-allergen-cb" value="'+l+'"'+c+"> "+l+"</label>"}).join(""),s=o.length>0?o.map(function(l,c){return'<div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg-light,#f9f9f9);border-radius:8px;margin-bottom:6px;"><div><strong>'+(l.label||"Address")+'</strong><br><span style="font-size:0.9em;color:#666;">'+(l.address||"")+'</span></div><button onclick="removeAddress('+c+')" style="background:none;border:none;color:#e53935;cursor:pointer;font-size:1.2em;" title="Remove">&times;</button></div>'}).join(""):'<p style="color:#999;font-size:0.9em;">No saved addresses yet.</p>';t.querySelector(".modal-content").innerHTML='<span class="close" onclick="closeProfileModal()">&times;</span><h2 style="margin:0 0 20px;font-size:1.4em;">My Profile</h2><div style="margin-bottom:14px;"><label style="font-weight:600;font-size:0.9em;display:block;margin-bottom:4px;">Name</label><input type="text" id="profile-name" value="'+(e.name||"").replace(/"/g,"&quot;")+'" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;font-size:1em;box-sizing:border-box;"></div><div style="margin-bottom:14px;"><label style="font-weight:600;font-size:0.9em;display:block;margin-bottom:4px;">Phone</label><input type="text" id="profile-phone" value="'+(e.phone||"")+'" readonly style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;font-size:1em;box-sizing:border-box;background:#f0f0f0;color:#888;cursor:not-allowed;"></div><div style="margin-bottom:14px;"><label style="font-weight:600;font-size:0.9em;display:block;margin-bottom:4px;">Date of Birth</label><input type="date" id="profile-dob" value="'+(e.dob||"")+'" style="width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:8px;font-size:1em;box-sizing:border-box;"></div><div style="margin-bottom:14px;"><label style="font-weight:600;font-size:0.9em;display:block;margin-bottom:8px;">Dietary Preferences</label><div style="display:flex;flex-wrap:wrap;gap:10px;">'+r+'</div></div><div style="margin-bottom:14px;"><label style="font-weight:600;font-size:0.9em;display:block;margin-bottom:8px;">Allergen Alerts</label><div style="display:flex;flex-wrap:wrap;gap:10px;">'+i+'</div></div><div style="margin-bottom:14px;"><label style="font-weight:600;font-size:0.9em;display:block;margin-bottom:8px;">Saved Addresses</label><div id="profile-address-list">'+s+'</div><div style="margin-top:10px;padding:12px;border:1px dashed #ccc;border-radius:8px;"><div style="display:flex;gap:8px;margin-bottom:8px;"><input type="text" id="profile-addr-label" placeholder="Label (e.g. Home, Office)" style="flex:1;padding:8px 10px;border:1px solid #ddd;border-radius:6px;font-size:0.9em;"></div><div style="display:flex;gap:8px;"><input type="text" id="profile-addr-address" placeholder="Full address" style="flex:1;padding:8px 10px;border:1px solid #ddd;border-radius:6px;font-size:0.9em;"><button onclick="addAddress()" style="padding:8px 16px;background:var(--accent,#ff9800);color:#fff;border:none;border-radius:6px;cursor:pointer;font-weight:600;white-space:nowrap;">Add</button></div></div></div><button onclick="saveProfile()" style="width:100%;padding:12px;background:var(--primary,#d4a259);color:#fff;border:none;border-radius:8px;font-size:1.05em;font-weight:600;cursor:pointer;margin-top:6px;">Save Profile</button>',t.style.display="block",G()}function pe(){var e=document.getElementById("profile-modal");e&&(e.style.display="none"),D()}function Ga(){var e=A();if(e){for(var t=document.getElementById("profile-name").value.trim(),n=document.getElementById("profile-dob").value,a=[],o=document.querySelectorAll(".profile-dietary-cb:checked"),r=0;r<o.length;r++)a.push(o[r].value);for(var i=[],s=document.querySelectorAll(".profile-allergen-cb:checked"),l=0;l<s.length;l++)i.push(s[l].value);if(!t){k("Please enter your name.");return}e.name=t,e.dob=n,e.dietaryPrefs=a,e.allergenAlerts=i,_(e);var c=M();c&&e.phone?c.collection("users").doc(e.phone).update({name:t,dob:n,dietaryPrefs:a,allergenAlerts:i,savedAddresses:e.savedAddresses||[]}).then(function(){k("Profile updated!"),pe(),typeof window.updateSignInUI=="function"&&window.updateSignInUI(e)}).catch(function(d){console.error("Profile save error:",d),k("Profile saved locally. Sync failed."),pe()}):(k("Profile updated!"),pe())}}function Ua(){var e=A();if(e){var t=document.getElementById("profile-addr-label"),n=document.getElementById("profile-addr-address"),a=t.value.trim(),o=n.value.trim();if(!o){k("Please enter an address.");return}e.savedAddresses||(e.savedAddresses=[]),e.savedAddresses.push({label:a||"Address",address:o}),_(e),Ve()}}function Wa(e){var t=A();!t||!t.savedAddresses||(t.savedAddresses.splice(e,1),_(t),Ve())}Object.assign(window,{openProfileModal:Ve,saveProfile:Ga,closeProfileModal:pe,addAddress:Ua,removeAddress:Wa});var W=null,Ne=null,Ae=!1;function qt(){var e=new URLSearchParams(window.location.search),t=e.get("group");t&&ja(t)}function Va(){var e=A();if(!e){typeof window.openAuthModal=="function"&&window.openAuthModal(),typeof window.showAuthToast=="function"&&window.showAuthToast("Please sign in to start group ordering");return}var t=M();if(t){var n={hostPhone:e.phone,hostName:e.name||"Host",participants:[{phone:e.phone,name:e.name||"Host",items:[]}],status:"open",createdAt:new Date().toISOString(),expiresAt:new Date(Date.now()+36e5).toISOString()};t.collection("groupCarts").add(n).then(function(a){W=a.id,Ae=!0;var o=window.location.origin+window.location.pathname+"?group="+W;Dt(o),Ot(W)}).catch(function(a){console.error("Create group cart error:",a),typeof window.showAuthToast=="function"&&window.showAuthToast("Failed to create group cart")})}}function ja(e){var t=M();t&&t.collection("groupCarts").doc(e).get().then(function(n){if(!n.exists){typeof window.showAuthToast=="function"&&window.showAuthToast("Group cart not found or expired");return}var a=n.data();if(a.status!=="open"){typeof window.showAuthToast=="function"&&window.showAuthToast("This group order has been closed");return}W=e,Ae=!1;var o=A();if(o){var r=a.participants.some(function(i){return i.phone===o.phone});r||(a.participants.push({phone:o.phone,name:o.name||"Guest",items:[]}),t.collection("groupCarts").doc(e).update({participants:a.participants}))}typeof window.showAuthToast=="function"&&window.showAuthToast("Joined group order by "+a.hostName),Ot(e),Ka()}).catch(function(n){console.error("Join group cart error:",n)})}function Ot(e){var t=M();t&&(Ne&&Ne(),Ne=t.collection("groupCarts").doc(e).onSnapshot(function(n){if(n.exists){var a=n.data();Ja(a)}}))}function Dt(e){var t=document.getElementById("group-modal");t&&t.remove();var n=document.createElement("div");n.id="group-modal",n.className="modal",n.style.display="block",G(),n.innerHTML='<div class="modal-content" style="max-width:420px;padding:1.5rem"><span class="close-modal" onclick="closeGroupModal()">&times;</span><h2 style="color:#D4A017;margin-bottom:1rem">Group Ordering</h2><p style="margin-bottom:0.8rem">Share this link with friends to order together:</p><div style="display:flex;gap:0.5rem;margin-bottom:1rem"><input type="text" id="group-share-url" value="'+e+'" readonly style="flex:1;padding:0.5rem;border-radius:8px;border:1px solid rgba(212,160,23,0.2);background:rgba(0,0,0,0.2);color:#e8d5b5;font-size:0.8rem"><button onclick="copyGroupLink()" style="padding:0.5rem 1rem;background:#D4A017;color:#1a0f08;border:none;border-radius:8px;font-weight:700;cursor:pointer">Copy</button></div><div id="group-participants" style="margin-bottom:1rem"></div><p style="font-size:0.75rem;color:#a09080">Cart expires in 1 hour. Only you (host) can checkout.</p><button onclick="lockGroupCart()" class="cta-button" style="width:100%;margin-top:0.5rem">Lock Cart & Checkout</button></div>',document.body.appendChild(n),n.addEventListener("click",function(a){a.target===n&&je()})}function je(){var e=document.getElementById("group-modal");e&&(e.style.display="none"),D()}function Ya(){var e=document.getElementById("group-share-url");e&&(e.select(),navigator.clipboard?navigator.clipboard.writeText(e.value):document.execCommand("copy"),typeof window.showAuthToast=="function"&&window.showAuthToast("Link copied!"))}function Ja(e){var t=document.getElementById("group-participants");if(t){var n='<h4 style="color:#D4A017;margin-bottom:0.5rem">Participants ('+e.participants.length+")</h4>";e.participants.forEach(function(a){var o=(a.items||[]).length;n+='<div style="display:flex;justify-content:space-between;padding:0.4rem 0;border-bottom:1px solid rgba(255,255,255,0.05)"><span>'+(a.name||a.phone)+(a.phone===e.hostPhone?" (Host)":"")+'</span><span style="color:#D4A017">'+o+" item"+(o!==1?"s":"")+"</span></div>"}),t.innerHTML=n}}function $a(e,t){if(W){var n=A();if(n){var a=M();a&&a.collection("groupCarts").doc(W).get().then(function(o){if(o.exists){var r=o.data(),i=r.participants.find(function(s){return s.phone===n.phone});i&&(i.items||(i.items=[]),i.items.push({name:e,price:t,qty:1}),a.collection("groupCarts").doc(W).update({participants:r.participants}),typeof window.showAuthToast=="function"&&window.showAuthToast("Added to group cart!"))}})}}}function Xa(){if(!(!W||!Ae)){var e=M();e&&e.collection("groupCarts").doc(W).update({status:"locked"}).then(function(){e.collection("groupCarts").doc(W).get().then(function(t){if(t.exists){var n=t.data();n.participants.forEach(function(a){(a.items||[]).forEach(function(o){typeof window.finalizeAddToCart=="function"&&window.finalizeAddToCart(o.name,o.price,1)})}),je(),typeof window.showAuthToast=="function"&&window.showAuthToast("Group cart locked! Proceed to checkout.")}})})}}function Ka(){var e=document.getElementById("group-indicator");e&&e.remove();var t=document.createElement("div");t.id="group-indicator",t.style.cssText="position:fixed;bottom:80px;right:20px;background:linear-gradient(135deg,#D4A017,#B8860B);color:#1a0f08;padding:0.5rem 1rem;border-radius:20px;font-size:0.8rem;font-weight:700;cursor:pointer;z-index:999;box-shadow:0 4px 12px rgba(0,0,0,0.3)",t.textContent="Group Order Active",t.onclick=function(){Ae&&Dt(window.location.origin+window.location.pathname+"?group="+W)},document.body.appendChild(t)}Object.assign(window,{createGroupCart:Va,closeGroupModal:je,copyGroupLink:Ya,addToGroupCart:$a,lockGroupCart:Xa,initGroupOrdering:qt});function Qa(e,t){var n=document.getElementById("split-bill-modal");n&&n.remove();var a=document.createElement("div");a.id="split-bill-modal",a.className="modal",a.style.display="block",G(),a.innerHTML='<div class="modal-content" style="max-width:420px;padding:1.5rem"><span class="close-modal" onclick="closeSplitBill()">&times;</span><h2 style="color:#D4A017;margin-bottom:1rem">Split Bill</h2><p style="margin-bottom:0.5rem">Order Total: <strong style="color:#D4A017">Rs.'+t+'</strong></p><div style="margin-bottom:1rem"><label style="font-size:0.85rem;color:#a09080">Split between how many people?</label><div style="display:flex;gap:0.5rem;margin-top:0.5rem"><button class="split-num-btn" onclick="setSplitCount(2)" style="flex:1;padding:0.5rem;border-radius:8px;border:1px solid rgba(212,160,23,0.2);background:rgba(212,160,23,0.1);color:#D4A017;font-weight:700;cursor:pointer">2</button><button class="split-num-btn" onclick="setSplitCount(3)" style="flex:1;padding:0.5rem;border-radius:8px;border:1px solid rgba(212,160,23,0.2);background:rgba(212,160,23,0.1);color:#D4A017;font-weight:700;cursor:pointer">3</button><button class="split-num-btn" onclick="setSplitCount(4)" style="flex:1;padding:0.5rem;border-radius:8px;border:1px solid rgba(212,160,23,0.2);background:rgba(212,160,23,0.1);color:#D4A017;font-weight:700;cursor:pointer">4</button><input type="number" id="split-custom-count" min="2" max="10" placeholder="Custom" style="width:70px;padding:0.5rem;border-radius:8px;border:1px solid rgba(212,160,23,0.2);background:rgba(0,0,0,0.2);color:#e8d5b5;text-align:center" onchange="setSplitCount(parseInt(this.value))"></div></div><div id="split-result" style="margin-bottom:1rem"></div><div id="split-links" style="margin-bottom:1rem"></div></div>',a.dataset.orderId=e,a.dataset.total=t,document.body.appendChild(a),a.addEventListener("click",function(o){o.target===a&&Rt()})}function Rt(){var e=document.getElementById("split-bill-modal");e&&(e.style.display="none"),D()}function Za(e){if(!(!e||e<2||e>10)){var t=document.getElementById("split-bill-modal");if(t){var n=parseInt(t.dataset.total)||0,a=t.dataset.orderId||"",o=Math.ceil(n/e),r=document.getElementById("split-result");r&&(r.innerHTML='<div style="background:rgba(212,160,23,0.08);border:1px solid rgba(212,160,23,0.15);border-radius:12px;padding:1rem;text-align:center"><div style="font-size:0.85rem;color:#a09080;margin-bottom:0.3rem">Each person pays</div><div style="font-size:1.8rem;font-weight:700;color:#D4A017">Rs.'+o+'</div><div style="font-size:0.75rem;color:#a09080">'+e+" people x Rs."+o+" = Rs."+o*e+"</div></div>");var i=document.getElementById("split-links");if(i){for(var s="9121004999@upi",l='<h4 style="color:#D4A017;margin:0.8rem 0 0.5rem;font-size:0.9rem">Share Payment Links</h4>',c=0;c<e;c++){var d=c===0?"You":"Person "+(c+1),p="upi://pay?pa="+s+"&pn=Amogha%20Cafe&am="+o+"&tn=Split%20Bill%20"+a.slice(-6);l+='<div style="display:flex;align-items:center;justify-content:space-between;padding:0.5rem 0;border-bottom:1px solid rgba(255,255,255,0.05)"><span style="font-size:0.85rem">'+d+'</span><a href="'+p+'" style="padding:0.3rem 0.8rem;background:linear-gradient(135deg,#D4A017,#B8860B);color:#1a0f08;border-radius:8px;font-weight:700;font-size:0.75rem;text-decoration:none">Pay Rs.'+o+"</a></div>"}l+='<button onclick="shareSplitBill('+e+","+o+')" style="width:100%;margin-top:0.8rem;padding:0.5rem;background:linear-gradient(135deg,#25D366,#128C7E);color:#fff;border:none;border-radius:10px;font-weight:700;cursor:pointer;font-size:0.85rem">Share via WhatsApp</button>',i.innerHTML=l}var g=M();g&&a&&g.collection("orders").doc(a).update({splitBill:{count:e,perPerson:o,total:n}}).catch(function(h){console.error("Split bill save error:",h)})}}}function eo(e,t){var n="Hey! Let's split the bill from Amogha Cafe. Each person pays Rs."+t+" ("+e+" ways). Pay via UPI to 9121004999@upi. Thanks!";navigator.share?navigator.share({text:n}).catch(function(){}):window.open("https://wa.me/?text="+encodeURIComponent(n),"_blank")}Object.assign(window,{openSplitBill:Qa,closeSplitBill:Rt,setSplitCount:Za,shareSplitBill:eo});function to(){var e=A();if(!e){typeof window.openAuthModal=="function"&&window.openAuthModal(),typeof window.showAuthToast=="function"&&window.showAuthToast("Please sign in to view meal plans");return}var t=document.getElementById("subscription-modal");t&&t.remove();var n=document.createElement("div");n.id="subscription-modal",n.className="modal",n.style.display="block",G();var a=M();a&&a.collection("subscriptionPlans").where("active","==",!0).get().then(function(o){var r=[];o.forEach(function(i){var s=i.data();s.id=i.id,r.push(s)}),r.length===0&&(r=He()),Ze(n,r,e)}).catch(function(){Ze(n,He(),e)})}function He(){return[{id:"lunch-basic",name:"Lunch Basic",description:"5 lunches per week (Mon-Fri)",mealsPerWeek:5,pricePerMonth:2499,regularPrice:3500,items:["Chicken Dum Biryani","Veg Dum Biryani","Dal Tadka + Butter Naan"],active:!0},{id:"lunch-premium",name:"Lunch Premium",description:"5 lunches + 2 dinners per week",mealsPerWeek:7,pricePerMonth:3999,regularPrice:5600,items:["Chicken Dum Biryani","Mutton Dum Biryani","Butter Chicken + Naan","Paneer Butter Masala + Naan"],active:!0},{id:"all-meals",name:"All Meals",description:"7 lunches + 7 dinners per week",mealsPerWeek:14,pricePerMonth:6999,regularPrice:9800,items:["Full menu rotation - Chef's choice daily"],active:!0}]}function Ze(e,t,n){var a='<div class="modal-content" style="max-width:500px;padding:1.5rem;max-height:85vh;overflow-y:auto"><span class="close-modal" onclick="closeSubscriptionModal()">&times;</span><h2 style="color:#D4A017;margin-bottom:0.5rem">Meal Plans</h2><p style="color:#a09080;font-size:0.85rem;margin-bottom:1.2rem">Save up to 30% with weekly subscriptions</p>';t.forEach(function(o){var r=o.regularPrice-o.pricePerMonth,i=Math.round(r/o.regularPrice*100);a+='<div style="background:rgba(212,160,23,0.06);border:1px solid rgba(212,160,23,0.15);border-radius:14px;padding:1.2rem;margin-bottom:1rem"><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:0.5rem"><h3 style="color:#e8d5b5;margin:0;font-size:1.1rem">'+o.name+'</h3><span style="background:#D4A017;color:#1a0f08;padding:0.15rem 0.5rem;border-radius:8px;font-size:0.7rem;font-weight:700">Save '+i+'%</span></div><p style="color:#a09080;font-size:0.8rem;margin-bottom:0.6rem">'+o.description+'</p><div style="display:flex;align-items:baseline;gap:0.5rem;margin-bottom:0.6rem"><span style="font-size:1.4rem;font-weight:700;color:#D4A017">Rs.'+o.pricePerMonth+'</span><span style="color:#a09080;font-size:0.8rem;text-decoration:line-through">Rs.'+o.regularPrice+'</span><span style="color:#a09080;font-size:0.75rem">/month</span></div><div style="margin-bottom:0.8rem"><div style="font-size:0.75rem;color:#a09080;margin-bottom:0.3rem">Includes:</div>'+o.items.map(function(s){return'<span style="display:inline-block;font-size:0.7rem;padding:0.15rem 0.4rem;border-radius:6px;background:rgba(255,255,255,0.05);color:#e8d5b5;margin:0.1rem">'+s+"</span>"}).join(" ")+"</div><button onclick=\"subscribeToPlan('"+o.id+'\')" style="width:100%;padding:0.55rem;background:linear-gradient(135deg,#D4A017,#B8860B);color:#1a0f08;border:none;border-radius:10px;font-weight:700;cursor:pointer;font-size:0.85rem">Subscribe Now</button></div>'}),n.activeSubscription&&(a+='<div style="background:rgba(76,175,80,0.08);border:1px solid rgba(76,175,80,0.2);border-radius:14px;padding:1rem;margin-bottom:1rem"><h4 style="color:#4CAF50;margin:0 0 0.3rem">Your Active Plan</h4><p style="color:#e8d5b5;font-size:0.85rem">'+n.activeSubscription.planName+'</p><p style="color:#a09080;font-size:0.75rem">Next delivery: '+(n.activeSubscription.nextDeliveryDate||"Tomorrow")+'</p><button onclick="cancelSubscription()" style="margin-top:0.5rem;padding:0.4rem 1rem;background:rgba(244,67,54,0.1);color:#f44336;border:1px solid rgba(244,67,54,0.2);border-radius:8px;font-size:0.75rem;cursor:pointer">Cancel Plan</button></div>'),a+="</div>",e.innerHTML=a,document.body.appendChild(e),e.addEventListener("click",function(o){o.target===e&&Te()})}function Te(){var e=document.getElementById("subscription-modal");e&&(e.style.display="none"),D()}function no(e){var t=A();if(t){var n=He(),a=n.find(function(i){return i.id===e});if(a){var o={planId:e,planName:a.name,userPhone:t.phone,userName:t.name,status:"active",pricePerMonth:a.pricePerMonth,mealsPerWeek:a.mealsPerWeek,startDate:new Date().toISOString(),nextDeliveryDate:oo(),createdAt:new Date().toISOString()},r=M();r&&r.collection("subscriptions").add(o).then(function(i){t.activeSubscription={id:i.id,planId:e,planName:a.name,nextDeliveryDate:o.nextDeliveryDate},_(t),r.collection("users").doc(t.phone).update({activeSubscription:t.activeSubscription}).catch(function(){}),Te(),typeof window.showAuthToast=="function"&&window.showAuthToast("Subscribed to "+a.name+"! Your first delivery is on the way.")}).catch(function(i){console.error("Subscribe error:",i),typeof window.showAuthToast=="function"&&window.showAuthToast("Failed to subscribe. Please try again.")})}}}function ao(){var e=A();if(!(!e||!e.activeSubscription)&&confirm("Are you sure you want to cancel your meal plan?")){var t=M();t&&e.activeSubscription.id&&t.collection("subscriptions").doc(e.activeSubscription.id).update({status:"cancelled",cancelledAt:new Date().toISOString()}).catch(function(){}),delete e.activeSubscription,_(e),t&&t.collection("users").doc(e.phone).update({activeSubscription:null}).catch(function(){}),Te(),typeof window.showAuthToast=="function"&&window.showAuthToast("Meal plan cancelled.")}}function oo(){var e=new Date;for(e.setDate(e.getDate()+1);e.getDay()===0;)e.setDate(e.getDate()+1);return e.toISOString().split("T")[0]}function ro(){}Object.assign(window,{openSubscriptionModal:to,closeSubscriptionModal:Te,subscribeToPlan:no,cancelSubscription:ao,initSubscriptions:ro});var qe=[],Oe=!1;function et(e){var t=document.createElement("div");return t.textContent=e,t.innerHTML}function Ht(){var e=document.createElement("button");e.id="ai-chat-fab",e.className="ai-chat-fab",e.innerHTML='<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><span class="ai-fab-badge">AI</span>',e.title="AI Chat Assistant",e.onclick=Ft,document.body.appendChild(e);var t=document.createElement("div");t.id="ai-chat-modal",t.className="ai-chat-modal",t.innerHTML='<div class="ai-chat-container"><div class="ai-chat-header"><div class="ai-chat-header-info"><span class="ai-chat-avatar">ðŸ¤–</span><div><strong>Amogha AI</strong><br><span class="ai-chat-status">Online</span></div></div><button class="ai-chat-close" onclick="toggleChat()">&times;</button></div><div class="ai-chat-messages" id="ai-chat-messages"><div class="ai-msg bot"><p>Hi! I\'m Amogha AI assistant. I can help you find dishes, answer questions, or take your order. Try:</p><div class="ai-chat-suggestions"><button class="ai-suggest-btn" onclick="sendChatMessage(\'What\\\'s good for lunch?\')">Good for lunch?</button><button class="ai-suggest-btn" onclick="sendChatMessage(\'Something spicy under 300\')">Spicy under &#8377;300</button><button class="ai-suggest-btn" onclick="sendChatMessage(\'Veg options\')">Veg options</button><button class="ai-suggest-btn" onclick="sendChatMessage(\'What are your hours?\')">Your hours?</button></div></div></div><div class="ai-chat-input-area"><input type="text" id="ai-chat-input" placeholder="Ask me anything..." autocomplete="off"><button id="ai-chat-send" onclick="sendChatMessage()"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/></svg></button></div></div>',document.body.appendChild(t),document.getElementById("ai-chat-input").addEventListener("keydown",function(n){n.key==="Enter"&&_t()})}function Ft(){Oe=!Oe;var e=document.getElementById("ai-chat-modal"),t=document.getElementById("ai-chat-fab");Oe?(e.classList.add("open"),t.classList.add("active"),document.getElementById("ai-chat-input").focus()):(e.classList.remove("open"),t.classList.remove("active"))}async function _t(e){var t=document.getElementById("ai-chat-input"),n=e||(t?t.value.trim():"");if(n){t&&(t.value="");var a=document.getElementById("ai-chat-messages"),o=document.createElement("div");o.className="ai-msg user",o.innerHTML="<p>"+et(n)+"</p>",a.appendChild(o),a.scrollTop=a.scrollHeight,qe.push({role:"user",text:n});var r=document.createElement("div");r.className="ai-msg bot ai-typing",r.innerHTML='<div class="typing-dots"><span></span><span></span><span></span></div>',a.appendChild(r),a.scrollTop=a.scrollHeight;try{var i=A(),s=await fetch("/api/chat",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({message:n,cart:I.map(function(g){return{name:g.name,qty:g.quantity,price:g.price}}),preferences:i?{name:i.name,isVeg:(i.dietaryPrefs||[]).includes("Vegetarian")}:{},history:qe.slice(-6)})}),l=await s.json();r.remove();var c=document.createElement("div");c.className="ai-msg bot";var d="<p>"+(l.reply||"Sorry, please try again.")+"</p>";l.suggestedItems&&l.suggestedItems.length>0&&(d+='<div class="ai-chat-items">',l.suggestedItems.forEach(function(g){d+='<button class="ai-item-btn" onclick="addToCart(\''+g.name.replace(/'/g,"\\'")+"', "+g.price+"); showAuthToast('Added "+g.name.replace(/'/g,"\\'")+" to cart');\">"+et(g.name)+" â€” &#8377;"+g.price+' <span class="ai-add">+</span></button>'}),d+="</div>"),c.innerHTML=d,a.appendChild(c),a.scrollTop=a.scrollHeight,qe.push({role:"assistant",text:l.reply}),l.action==="checkout"&&typeof window.checkout=="function"?window.checkout():l.action==="showMenu"&&document.getElementById("menu").scrollIntoView({behavior:"smooth"})}catch(g){r.remove();var p=document.createElement("div");p.className="ai-msg bot",p.innerHTML="<p>Sorry, I couldn't process that. Try again or call us at +91 91210 04999.</p>",a.appendChild(p)}}}Object.assign(window,{toggleChat:Ft,sendChatMessage:_t,initChatbot:Ht});Kn();$n();Yn();Jn();rn();cn();ln();yn();xe();En();Wn();Kt();ta();ra();Ia();It();kt();Lt();setTimeout(function(){var e=null;try{e=JSON.parse(localStorage.getItem("amoghaUser"))}catch(t){}e&&La()},2e3);Mt();qt();Ht();setTimeout(Aa,3e3);_e();window.displayCart=function(){he(),Ue()};window.loadMenuRatings=Fn;export{io as __vite_legacy_guard};
//# sourceMappingURL=script.js.map
