<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Self-Service Kiosk | Amogha Cafe & Restaurant</title>
    <meta name="theme-color" content="#D4A017">
    <meta name="description" content="Amogha Cafe & Restaurant - Self-Service Ordering Kiosk. Browse our menu and place your order.">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Amogha Kiosk">
    <meta name="format-detection" content="telephone=no">
    <link rel="icon" type="image/png" href="../amogha-logo.png">
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="../amogha-logo.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@500;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        :root{
            --bg:#080604;--bg2:rgba(14,11,9,.94);--bg-card:rgba(18,15,12,.82);
            --gold:#D4A017;--gold-l:#F5D76E;--gold-d:#B8860B;--gold-xl:#ffe6a0;
            --txt:#ede2d2;--txt2:#a09080;--txt3:#6a5a4a;--txt4:#4a3a2a;
            --grn:#27ae60;--red:#e74c3c;--r:14px;
            --mono:'JetBrains Mono',monospace;
            --shadow-s:0 1px 2px rgba(0,0,0,.2),0 4px 12px rgba(0,0,0,.12);
            --shadow-m:0 2px 6px rgba(0,0,0,.2),0 8px 24px rgba(0,0,0,.15),0 0 0 .5px rgba(212,160,23,.04);
            --shadow-glow:0 0 20px rgba(212,160,23,.1),0 0 40px rgba(212,160,23,.05);
            --ease:cubic-bezier(.4,0,.2,1);--ease-out:cubic-bezier(.16,1,.3,1);
            --ease-luxe:cubic-bezier(.22,1,.36,1);--ease-spring:cubic-bezier(.34,1.56,.64,1);
        }
        html{scroll-behavior:smooth}
        body{font-family:'Poppins',sans-serif;background:var(--bg);color:var(--txt);
            min-height:100vh;-webkit-tap-highlight-color:transparent;
            overflow-x:hidden;-webkit-font-smoothing:antialiased;
            padding-bottom:calc(80px + env(safe-area-inset-bottom,0px))}
        ::selection{background:rgba(212,160,23,.25);color:var(--gold-l)}

        /* ── Grain Texture Overlay ─────────────────────────────── */
        body::after{content:'';position:fixed;inset:0;pointer-events:none;z-index:9999;opacity:.025;
            background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")}

        /* ── Ambient Gold Aura ─────────────────────────────────── */
        body::before{content:'';position:fixed;inset:0;pointer-events:none;z-index:0;
            background:radial-gradient(ellipse at 30% 0%,rgba(212,160,23,.04) 0%,transparent 50%),
                        radial-gradient(ellipse at 70% 100%,rgba(139,26,26,.03) 0%,transparent 50%)}

        /* ── Ambient Floating Particles ────────────────────────── */
        .ambient-particles{position:fixed;inset:0;pointer-events:none;z-index:1;overflow:hidden}
        .ap{position:absolute;border-radius:50%;filter:blur(40px);opacity:0;
            background:radial-gradient(circle,rgba(212,160,23,.25),transparent 70%);
            animation:apFloat 20s ease-in-out infinite}
        .ap1{width:280px;height:280px;top:8%;left:5%;animation-delay:0s}
        .ap2{width:220px;height:220px;top:55%;right:8%;animation-delay:3s}
        .ap3{width:180px;height:180px;top:30%;left:60%;animation-delay:6s}
        .ap4{width:250px;height:250px;bottom:15%;left:15%;animation-delay:9s}
        .ap5{width:160px;height:160px;top:70%;right:35%;animation-delay:12s}
        .ap6{width:200px;height:200px;top:15%;right:20%;animation-delay:15s}
        @keyframes apFloat{
            0%,100%{opacity:.15;transform:translate(0,0) scale(1)}
            25%{opacity:.3;transform:translate(40px,-40px) scale(1.1)}
            50%{opacity:.15;transform:translate(-20px,-80px) scale(.95)}
            75%{opacity:.25;transform:translate(60px,-20px) scale(1.05)}}

        /* ── Premium Scrollbar ─────────────────────────────────── */
        ::-webkit-scrollbar{width:5px}
        ::-webkit-scrollbar-track{background:rgba(8,6,4,.5)}
        ::-webkit-scrollbar-thumb{background:linear-gradient(180deg,rgba(212,160,23,.4),rgba(212,160,23,.15),rgba(212,160,23,.4));
            border-radius:10px;border:1px solid rgba(212,160,23,.08)}
        ::-webkit-scrollbar-thumb:hover{background:linear-gradient(180deg,var(--gold-l),var(--gold),var(--gold-l))}

        /* ── Preloader ─────────────────────────────────────────── */
        .preloader{position:fixed;inset:0;z-index:10000;background:#080604;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;transition:opacity .6s var(--ease-luxe),filter .6s}
        .preloader.done{opacity:0;filter:blur(8px);pointer-events:none}
        .preloader-logo{width:100px;height:100px;border-radius:50%;object-fit:contain;
            background:#d4a017;padding:4px;
            animation:preBreathe 2.5s ease-in-out infinite;
            box-shadow:0 0 40px rgba(212,160,23,.2),0 0 80px rgba(212,160,23,.08)}
        @keyframes preBreathe{0%,100%{transform:scale(1);box-shadow:0 0 40px rgba(212,160,23,.2),0 0 80px rgba(212,160,23,.08)}
            50%{transform:scale(1.06);box-shadow:0 0 60px rgba(212,160,23,.3),0 0 120px rgba(212,160,23,.12)}}
        .preloader p{color:var(--gold);font-size:13px;font-weight:500;letter-spacing:.1em;text-transform:uppercase}
        .pre-bar{width:160px;height:3px;background:rgba(212,160,23,.1);border-radius:3px;overflow:hidden;margin-top:4px}
        .pre-bar-fill{height:100%;width:0;background:linear-gradient(90deg,var(--gold-d),var(--gold),var(--gold-l));border-radius:3px;animation:preBarFill 1.5s var(--ease-out) forwards}
        @keyframes preBarFill{to{width:100%}}

        /* ── Touch Ripple ──────────────────────────────────────── */
        .touch-ripple{position:absolute;border-radius:50%;background:radial-gradient(circle,rgba(212,160,23,.25),transparent 70%);
            pointer-events:none;transform:scale(0);animation:rippleOut .5s var(--ease-out) forwards;z-index:50}
        @keyframes rippleOut{to{transform:scale(4);opacity:0}}

        /* ── Header ────────────────────────────────────────────── */
        .header{position:sticky;top:0;z-index:100;
            background:linear-gradient(135deg,rgba(26,20,8,.97),rgba(14,11,7,.97));
            border-bottom:1px solid rgba(212,160,23,.12);
            padding:12px 16px;backdrop-filter:blur(24px);-webkit-backdrop-filter:blur(24px)}
        .header::after{content:'';position:absolute;bottom:-1px;left:0;right:0;height:1px;
            background:linear-gradient(90deg,transparent,rgba(212,160,23,.2),transparent)}
        .header-row{display:flex;align-items:center;gap:10px}
        .header-logo{width:42px;height:42px;border-radius:50%;object-fit:contain;flex-shrink:0;
            background:#d4a017;padding:2px;
            box-shadow:0 0 20px rgba(212,160,23,.15);transition:box-shadow .3s}
        .header-info{flex:1;min-width:0}
        .header-info h1{font-family:'Playfair Display',serif;font-size:17px;font-weight:700;color:var(--gold);line-height:1.2;
            letter-spacing:.03em;text-shadow:0 0 30px rgba(212,160,23,.1)}
        .header-info p{font-size:11px;color:var(--txt2);line-height:1.3;letter-spacing:.04em}
        .header-actions{display:flex;align-items:center;gap:6px;flex-shrink:0}
        .lang-toggle{display:flex;background:rgba(212,160,23,.08);border:1px solid rgba(212,160,23,.15);border-radius:22px;overflow:hidden;
            box-shadow:inset 0 1px 0 rgba(255,255,255,.03)}
        .lang-btn{padding:6px 10px;font-size:10px;font-weight:600;cursor:pointer;border:none;background:transparent;
            color:var(--txt3);transition:all .3s var(--ease-out);white-space:nowrap}
        .lang-btn.active{background:linear-gradient(135deg,var(--gold),var(--gold-d));color:#080604;
            box-shadow:0 2px 10px rgba(212,160,23,.25)}
        .fs-btn{width:34px;height:34px;border-radius:50%;border:1px solid rgba(212,160,23,.15);
            background:rgba(212,160,23,.06);color:var(--gold);cursor:pointer;flex-shrink:0;
            display:flex;align-items:center;justify-content:center;transition:all .3s var(--ease-spring)}
        .fs-btn:active{transform:scale(.88)}
        .fs-btn:hover{background:rgba(212,160,23,.12);box-shadow:0 0 16px rgba(212,160,23,.1)}
        .fs-btn svg{width:16px;height:16px}
        @media(min-width:480px){
            .lang-btn{padding:7px 13px;font-size:11px}
            .fs-btn{width:38px;height:38px}
            .fs-btn svg{width:18px;height:18px}
        }

        /* ── Featured Banner ───────────────────────────────────── */
        .featured-strip{overflow:hidden;padding:12px 0;border-bottom:1px solid rgba(212,160,23,.06);position:relative}
        .featured-strip::before,.featured-strip::after{content:'';position:absolute;top:0;bottom:0;width:40px;z-index:2;pointer-events:none}
        .featured-strip::before{left:0;background:linear-gradient(90deg,var(--bg),transparent)}
        .featured-strip::after{right:0;background:linear-gradient(-90deg,var(--bg),transparent)}
        .featured-track{display:flex;gap:12px;animation:marquee 25s linear infinite;width:max-content}
        .featured-track:hover{animation-play-state:paused}
        .featured-item{display:flex;align-items:center;gap:8px;padding:6px 14px;
            background:rgba(212,160,23,.06);border:1px solid rgba(212,160,23,.1);border-radius:20px;
            white-space:nowrap;flex-shrink:0;transition:all .25s}
        .featured-item:hover{background:rgba(212,160,23,.12);border-color:rgba(212,160,23,.2)}
        .featured-star{color:var(--gold);font-size:12px}
        .featured-name{font-size:12px;font-weight:500;color:var(--txt)}
        .featured-price{font-family:var(--mono);font-size:11px;font-weight:600;color:var(--gold)}
        @keyframes marquee{0%{transform:translateX(0)}100%{transform:translateX(-50%)}}

        /* ── Search ────────────────────────────────────────────── */
        .search-wrap{padding:14px 16px 0}
        .search-bar{display:flex;align-items:center;gap:8px;background:rgba(212,160,23,.06);
            border:1px solid rgba(212,160,23,.12);border-radius:14px;padding:11px 16px;
            transition:all .3s var(--ease-out);box-shadow:inset 0 1px 0 rgba(255,255,255,.02)}
        .search-bar:focus-within{border-color:var(--gold);box-shadow:0 0 0 3px rgba(212,160,23,.1),inset 0 1px 0 rgba(255,255,255,.02)}
        .search-bar svg{width:18px;height:18px;stroke:var(--txt3);flex-shrink:0;transition:stroke .25s}
        .search-bar:focus-within svg{stroke:var(--gold)}
        .search-bar input{flex:1;background:none;border:none;outline:none;color:var(--txt);font-family:inherit;font-size:14px}
        .search-bar input::placeholder{color:var(--txt3)}

        /* ── Filters ───────────────────────────────────────────── */
        .filter-row{display:flex;align-items:center;gap:8px;padding:10px 16px}
        .filter-chip{display:flex;align-items:center;gap:5px;padding:9px 16px;min-height:42px;
            border-radius:22px;font-size:13px;font-weight:500;cursor:pointer;position:relative;overflow:hidden;
            border:1px solid rgba(212,160,23,.15);background:rgba(212,160,23,.04);
            color:var(--txt2);transition:all .3s var(--ease-out);white-space:nowrap;user-select:none;
            box-shadow:inset 0 1px 0 rgba(255,255,255,.02)}
        .filter-chip.active{background:rgba(212,160,23,.12);color:var(--gold);border-color:rgba(212,160,23,.4);
            box-shadow:0 0 16px rgba(212,160,23,.08),inset 0 1px 0 rgba(255,255,255,.04)}
        .filter-chip .dot{width:9px;height:9px;border-radius:50%;flex-shrink:0;
            box-shadow:0 0 6px currentColor}
        .filter-chip .dot.veg{background:var(--grn);box-shadow:0 0 6px rgba(39,174,96,.4)}
        .filter-chip .dot.nv{background:var(--red);box-shadow:0 0 6px rgba(231,76,60,.4)}

        /* ── Layout: sidebar + grid ────────────────────────────── */
        .kiosk-body{display:flex;gap:0;position:relative}

        /* Category Sidebar (tablet ≥768px) */
        .cat-sidebar{display:none;width:175px;flex-shrink:0;position:sticky;top:70px;
            height:calc(100vh - 70px);overflow-y:auto;padding:8px 0 80px 8px;
            border-right:1px solid rgba(212,160,23,.08);scrollbar-width:none}
        .cat-sidebar::-webkit-scrollbar{display:none}
        .cat-item{display:flex;align-items:center;gap:8px;padding:13px 14px;margin:2px 4px;position:relative;
            border-radius:12px;font-size:13px;font-weight:500;color:var(--txt2);cursor:pointer;
            transition:all .3s var(--ease-out);user-select:none;border:none;background:none;width:100%;text-align:left;
            overflow:hidden}
        .cat-item::before{content:'';position:absolute;left:0;top:20%;height:60%;width:3px;border-radius:0 3px 3px 0;
            background:var(--gold);opacity:0;transform:scaleY(.5);transition:all .3s var(--ease-spring)}
        .cat-item:hover{background:rgba(212,160,23,.05)}
        .cat-item.active{background:rgba(212,160,23,.1);color:var(--gold);font-weight:600;
            box-shadow:0 0 20px rgba(212,160,23,.06)}
        .cat-item.active::before{opacity:1;transform:scaleY(1)}
        .cat-item .cat-count{margin-left:auto;font-size:11px;font-weight:400;
            background:rgba(212,160,23,.08);padding:2px 7px;border-radius:10px;color:var(--txt3)}
        .cat-item.active .cat-count{background:rgba(212,160,23,.15);color:var(--gold)}

        /* Category Tabs (phone <768px) */
        .cat-tabs{display:flex;gap:8px;padding:0 16px 10px;overflow-x:auto;-webkit-overflow-scrolling:touch;scrollbar-width:none}
        .cat-tabs::-webkit-scrollbar{display:none}
        .cat-tab{flex-shrink:0;padding:9px 18px;min-height:42px;border-radius:25px;font-size:12px;
            font-weight:600;cursor:pointer;border:1.5px solid rgba(212,160,23,.15);
            background:transparent;color:var(--txt2);transition:all .3s var(--ease-spring);user-select:none;
            display:inline-flex;align-items:center;gap:4px;position:relative;overflow:hidden}
        .cat-tab.active{background:linear-gradient(135deg,var(--gold),var(--gold-d));color:#080604;
            border-color:var(--gold);box-shadow:0 4px 20px rgba(212,160,23,.3),0 0 0 1px rgba(212,160,23,.5)}
        .cat-tab .ct-count{font-size:10px;opacity:.7}

        /* ── Menu Grid ─────────────────────────────────────────── */
        .menu-area{flex:1;min-width:0;padding:0 8px 20px}
        .menu-section{margin-bottom:20px}
        .section-title{font-family:'Playfair Display',serif;font-size:17px;font-weight:700;color:var(--gold);
            padding:10px 8px 12px;display:flex;align-items:center;gap:10px;letter-spacing:.03em;
            text-shadow:0 0 30px rgba(212,160,23,.08)}
        .section-title::before{content:'';width:3px;height:20px;border-radius:2px;
            background:linear-gradient(180deg,var(--gold-l),var(--gold-d));
            box-shadow:0 0 10px rgba(212,160,23,.3)}
        .item-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px;padding:0 4px}

        /* ── Item Card (Premium Glass) ─────────────────────────── */
        .item-card{background:var(--bg-card);border:1px solid rgba(212,160,23,.06);border-radius:16px;
            overflow:hidden;position:relative;
            transition:all .35s var(--ease-out);
            box-shadow:var(--shadow-s),inset 0 1px 0 rgba(255,255,255,.03);
            backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px)}
        .item-card::before{content:'';position:absolute;top:0;left:8%;right:8%;height:1px;z-index:2;
            background:linear-gradient(90deg,transparent,rgba(212,160,23,.2),transparent)}
        .item-card:hover{transform:translateY(-3px);border-color:rgba(212,160,23,.15);
            box-shadow:var(--shadow-m),0 0 24px rgba(212,160,23,.06)}
        .item-card:active{transform:scale(.97);transition-duration:.15s}
        .item-card.card-enter{opacity:0;transform:translateY(20px)}
        .item-card.card-visible{opacity:1;transform:translateY(0);transition:opacity .5s var(--ease-luxe),transform .5s var(--ease-luxe)}

        .item-img-wrap{position:relative;width:100%;aspect-ratio:4/3;background:linear-gradient(135deg,rgba(212,160,23,.04),rgba(212,160,23,.01));overflow:hidden}
        .item-img{width:100%;height:100%;object-fit:cover;transition:transform .6s var(--ease-luxe)}
        .item-card:hover .item-img{transform:scale(1.06)}
        .item-img-placeholder{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;
            background:linear-gradient(135deg,rgba(212,160,23,.06),rgba(212,160,23,.02))}
        .item-img-placeholder svg{width:36px;height:36px;stroke:var(--txt4);opacity:.5}
        .item-body{padding:10px 12px 14px}
        .item-type-badge{display:inline-flex;align-items:center;gap:4px;margin-bottom:5px}
        .item-type-badge .dot{width:8px;height:8px;border-radius:50%}
        .item-type-badge .dot.veg{background:var(--grn);box-shadow:0 0 5px rgba(39,174,96,.3)}
        .item-type-badge .dot.nv{background:var(--red);box-shadow:0 0 5px rgba(231,76,60,.3)}
        .item-type-badge span{font-size:9px;color:var(--txt3);text-transform:uppercase;font-weight:600;letter-spacing:.05em}
        .item-name{font-size:13px;font-weight:600;color:var(--txt);line-height:1.3;margin-bottom:2px;
            display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden}
        .bestseller-tag{display:inline-block;background:linear-gradient(135deg,#ff6b35,#e74c3c);color:#fff;
            font-size:8px;font-weight:700;padding:2px 6px;border-radius:4px;vertical-align:middle;margin-left:4px;
            letter-spacing:.03em;text-transform:uppercase;box-shadow:0 2px 8px rgba(231,76,60,.25)}
        .item-price{font-family:var(--mono);font-size:16px;font-weight:600;color:var(--gold);margin-top:5px;
            text-shadow:0 0 20px rgba(212,160,23,.1)}
        .item-bottom{display:flex;align-items:center;justify-content:space-between;margin-top:8px}

        /* ── Add Button (with shimmer) ─────────────────────────── */
        .add-btn{background:linear-gradient(135deg,var(--gold),var(--gold-d));color:#080604;border:none;
            padding:9px 22px;border-radius:10px;font-size:13px;font-weight:700;cursor:pointer;
            transition:all .25s var(--ease-spring);letter-spacing:.04em;min-height:42px;
            box-shadow:0 3px 12px rgba(212,160,23,.2),inset 0 1px 0 rgba(255,255,255,.15);
            position:relative;overflow:hidden;text-transform:uppercase}
        .add-btn::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;
            background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);
            transition:left .6s var(--ease-out);pointer-events:none}
        .add-btn:hover::after,.add-btn:focus::after{left:140%}
        .add-btn:active{transform:scale(.93);box-shadow:0 1px 6px rgba(212,160,23,.15)}

        .qty-ctrl{display:flex;align-items:center;gap:0;background:rgba(212,160,23,.1);
            border:1.5px solid var(--gold);border-radius:10px;overflow:hidden;
            box-shadow:0 0 12px rgba(212,160,23,.08)}
        .qty-ctrl button{width:38px;height:38px;border:none;background:transparent;color:var(--gold);
            font-size:18px;font-weight:700;cursor:pointer;display:flex;align-items:center;justify-content:center;
            transition:all .2s var(--ease-spring)}
        .qty-ctrl button:active{background:rgba(212,160,23,.2);transform:scale(.9)}
        .qty-ctrl span{min-width:30px;text-align:center;font-family:var(--mono);font-size:15px;font-weight:700;color:var(--gold)}

        /* ── No Results ────────────────────────────────────────── */
        .no-results{text-align:center;padding:60px 20px;color:var(--txt2)}
        .no-results.hidden{display:none}
        .no-results svg{width:48px;height:48px;stroke:var(--txt3);margin-bottom:12px}
        .no-results p{font-size:14px}

        /* ── Floating Cart Bar ─────────────────────────────────── */
        .cart-bar{position:fixed;bottom:0;left:0;right:0;z-index:200;
            padding:10px 16px calc(10px + env(safe-area-inset-bottom,0px));
            background:linear-gradient(to top,rgba(8,6,4,.98),rgba(8,6,4,.9));
            backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
            border-top:1px solid rgba(212,160,23,.12);
            transform:translateY(100%);transition:transform .4s var(--ease-spring);will-change:transform}
        .cart-bar.visible{transform:translateY(0)}
        .cart-bar.bounce{animation:barBounce .5s var(--ease-spring)}
        @keyframes barBounce{0%{transform:translateY(0)}30%{transform:translateY(-8px)}100%{transform:translateY(0)}}
        .cart-bar-inner{display:flex;align-items:center;justify-content:space-between;
            background:linear-gradient(135deg,var(--gold),var(--gold-d));
            border-radius:16px;padding:14px 18px;position:relative;overflow:hidden;
            box-shadow:0 4px 24px rgba(212,160,23,.3),0 0 0 1px rgba(212,160,23,.5)}
        .cart-bar-inner::after{content:'';position:absolute;top:0;left:0;right:0;height:1px;
            background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent)}
        .cart-info{display:flex;align-items:center;gap:12px}
        .cart-badge{width:32px;height:32px;border-radius:50%;background:rgba(8,6,4,.2);
            display:flex;align-items:center;justify-content:center;font-family:var(--mono);
            font-size:15px;font-weight:700;color:#080604;backdrop-filter:blur(4px)}
        .cart-summary{color:#080604}
        .cart-count{font-size:11px;opacity:.8;letter-spacing:.02em}
        .cart-total{font-family:var(--mono);font-size:17px;font-weight:700}
        .cart-btn{background:rgba(8,6,4,.15);color:#080604;border:none;padding:11px 22px;
            border-radius:12px;font-size:14px;font-weight:700;cursor:pointer;
            transition:all .25s var(--ease-spring);position:relative;overflow:hidden;letter-spacing:.02em}
        .cart-btn::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;
            background:linear-gradient(90deg,transparent,rgba(255,255,255,.15),transparent);
            transition:left .5s var(--ease-out);pointer-events:none}
        .cart-btn:hover::after{left:140%}
        .cart-btn:active{background:rgba(8,6,4,.25);transform:scale(.96)}

        /* ── Fly Animation ─────────────────────────────────────── */
        .fly-anim{position:fixed;pointer-events:none;z-index:999;font-family:var(--mono);
            font-size:18px;font-weight:700;color:var(--gold);text-shadow:0 0 10px rgba(212,160,23,.5);
            animation:flyUp .65s var(--ease-out) forwards}
        @keyframes flyUp{0%{opacity:1;transform:translateY(0) scale(1)}100%{opacity:0;transform:translateY(-70px) scale(.4)}}

        /* ── Checkout Overlay ──────────────────────────────────── */
        .co-overlay{position:fixed;inset:0;z-index:300;background:rgba(0,0,0,.65);
            backdrop-filter:blur(4px);-webkit-backdrop-filter:blur(4px);
            opacity:0;pointer-events:none;transition:opacity .35s var(--ease-out)}
        .co-overlay.open{opacity:1;pointer-events:auto}

        /* ── Checkout Sheet (Premium Glass) ────────────────────── */
        .co-sheet{position:fixed;bottom:0;left:0;right:0;z-index:310;
            max-height:90vh;
            background:linear-gradient(180deg,rgba(26,20,8,.96),rgba(14,11,7,.98));
            backdrop-filter:blur(30px);-webkit-backdrop-filter:blur(30px);
            border-top-left-radius:28px;border-top-right-radius:28px;
            border-top:1px solid rgba(212,160,23,.15);
            box-shadow:0 -8px 40px rgba(0,0,0,.4),inset 0 1px 0 rgba(255,255,255,.04);
            transform:translateY(100%);transition:transform .4s var(--ease-spring);
            overflow-y:auto;-webkit-overflow-scrolling:touch;
            padding-bottom:env(safe-area-inset-bottom,0px)}
        .co-sheet.open{transform:translateY(0)}
        .sheet-handle{width:40px;height:4px;border-radius:2px;background:rgba(212,160,23,.25);margin:12px auto}
        .sheet-header{display:flex;align-items:center;justify-content:space-between;padding:4px 20px 14px}
        .sheet-header h2{font-family:'Playfair Display',serif;font-size:22px;color:var(--gold);
            text-shadow:0 0 30px rgba(212,160,23,.1)}
        .sheet-close{width:34px;height:34px;border-radius:50%;border:1px solid rgba(212,160,23,.15);
            background:rgba(212,160,23,.06);color:var(--txt);font-size:20px;cursor:pointer;
            display:flex;align-items:center;justify-content:center;transition:all .25s var(--ease-spring)}
        .sheet-close:active{transform:scale(.88);background:rgba(212,160,23,.12)}
        .sheet-body{padding:0 20px 24px}

        .co-item{display:flex;align-items:center;padding:11px 0;border-bottom:1px solid rgba(212,160,23,.06)}
        .co-item-name{flex:1;font-size:13px;color:var(--txt)}
        .co-item-qty{font-family:var(--mono);font-size:12px;color:var(--txt2);margin:0 12px;white-space:nowrap}
        .co-item-price{font-family:var(--mono);font-size:14px;font-weight:600;color:var(--gold);white-space:nowrap}

        .co-totals{padding:14px 0;border-bottom:1px solid rgba(212,160,23,.08)}
        .co-row{display:flex;justify-content:space-between;padding:4px 0;font-size:13px;color:var(--txt2)}
        .co-row.total{font-size:18px;font-weight:700;color:var(--gold);padding:10px 0 0}
        .co-row.total span:last-child{font-family:var(--mono);text-shadow:0 0 20px rgba(212,160,23,.15)}

        .co-form label{display:block;font-size:12px;color:var(--txt2);margin:14px 0 6px;font-weight:500;
            letter-spacing:.03em;text-transform:uppercase}
        .co-form input,.co-form textarea{width:100%;padding:13px 16px;border-radius:12px;
            border:1px solid rgba(212,160,23,.1);background:rgba(212,160,23,.04);
            color:var(--txt);font-family:inherit;font-size:14px;outline:none;
            transition:all .3s var(--ease-out);
            box-shadow:inset 0 1px 0 rgba(255,255,255,.02)}
        .co-form input:focus,.co-form textarea:focus{border-color:var(--gold);
            box-shadow:0 0 0 3px rgba(212,160,23,.1),inset 0 1px 0 rgba(255,255,255,.03)}
        .co-form textarea{resize:none;height:60px}
        .co-form input::placeholder,.co-form textarea::placeholder{color:var(--txt3)}

        /* Pay Button (premium shimmer) */
        .pay-btn{width:100%;padding:17px;margin-top:20px;border:none;border-radius:16px;
            background:linear-gradient(135deg,var(--gold),var(--gold-d));color:#080604;
            font-size:17px;font-weight:700;cursor:pointer;letter-spacing:.03em;
            box-shadow:0 4px 24px rgba(212,160,23,.3),inset 0 1px 0 rgba(255,255,255,.2);
            transition:all .25s var(--ease-spring);min-height:56px;position:relative;overflow:hidden;
            text-transform:uppercase}
        .pay-btn::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;
            background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);
            animation:shimmerSweep 3s ease-in-out infinite;pointer-events:none}
        @keyframes shimmerSweep{0%,100%{left:-100%}50%{left:140%}}
        .pay-btn:active{transform:scale(.97)}
        .pay-btn:disabled{opacity:.6;cursor:not-allowed}
        .pay-btn:disabled::after{animation:none}
        .pay-divider{display:flex;align-items:center;gap:12px;margin-top:14px;color:var(--txt3);font-size:12px;
            letter-spacing:.05em;text-transform:uppercase}
        .pay-divider::before,.pay-divider::after{content:'';flex:1;height:1px;background:linear-gradient(90deg,transparent,rgba(212,160,23,.15),transparent)}
        .cod-btn{width:100%;padding:15px;margin-top:10px;border:1px solid rgba(212,160,23,.15);border-radius:14px;
            background:rgba(212,160,23,.04);color:var(--txt2);font-size:14px;font-weight:500;cursor:pointer;
            transition:all .25s var(--ease-spring);letter-spacing:.02em;
            box-shadow:inset 0 1px 0 rgba(255,255,255,.02)}
        .cod-btn:active{background:rgba(212,160,23,.1);transform:scale(.97)}

        /* ── Success Screen (Premium Celebration) ──────────────── */
        .success-screen{position:fixed;inset:0;z-index:500;background:rgba(8,6,4,.97);
            display:flex;align-items:center;justify-content:center;flex-direction:column;
            opacity:0;pointer-events:none;transition:opacity .5s var(--ease-luxe)}
        .success-screen.show{opacity:1;pointer-events:auto}
        .success-screen::before{content:'';position:absolute;top:50%;left:50%;width:400px;height:400px;
            transform:translate(-50%,-50%);border-radius:50%;pointer-events:none;
            background:radial-gradient(circle,rgba(212,160,23,.12),transparent 70%);
            animation:successGlow 3s ease-in-out infinite}
        @keyframes successGlow{0%,100%{opacity:.5;transform:translate(-50%,-50%) scale(1)}
            50%{opacity:1;transform:translate(-50%,-50%) scale(1.15)}}
        .success-confetti{position:absolute;inset:0;pointer-events:none;z-index:1}
        .success-content{text-align:center;padding:24px;max-width:420px;width:100%;position:relative;z-index:2}
        .success-check{width:88px;height:88px;border-radius:50%;
            background:linear-gradient(135deg,var(--grn),#2ecc71);
            display:flex;align-items:center;justify-content:center;margin:0 auto 22px;
            animation:scaleIn .5s var(--ease-spring);
            box-shadow:0 0 50px rgba(39,174,96,.3),0 0 100px rgba(39,174,96,.1),0 8px 32px rgba(0,0,0,.3)}
        @keyframes scaleIn{0%{transform:scale(0) rotate(-10deg)}60%{transform:scale(1.1) rotate(2deg)}100%{transform:scale(1) rotate(0)}}
        .success-check svg{width:42px;height:42px;stroke:#fff;stroke-width:3;
            stroke-dasharray:50;stroke-dashoffset:50;animation:drawCheck .6s .4s ease forwards}
        @keyframes drawCheck{to{stroke-dashoffset:0}}
        .success-content h2{font-family:'Playfair Display',serif;font-size:28px;color:var(--gold);margin-bottom:6px;
            text-shadow:0 0 40px rgba(212,160,23,.15);animation:blurReveal .6s .2s var(--ease-luxe) both}
        @keyframes blurReveal{from{opacity:0;filter:blur(8px);transform:translateY(-8px)}to{opacity:1;filter:blur(0);transform:none}}
        .success-subtitle{font-size:14px;color:var(--txt2);margin-bottom:24px;line-height:1.6;
            animation:blurReveal .6s .4s var(--ease-luxe) both}
        .success-order-card{background:rgba(212,160,23,.05);border:1px solid rgba(212,160,23,.12);
            border-radius:18px;padding:18px;margin-bottom:22px;text-align:left;
            box-shadow:inset 0 1px 0 rgba(255,255,255,.03);
            animation:blurReveal .6s .5s var(--ease-luxe) both}
        .soc-row{display:flex;justify-content:space-between;padding:7px 0}
        .soc-label{font-size:12px;color:var(--txt2);text-transform:uppercase;letter-spacing:.04em}
        .soc-value{font-family:var(--mono);font-size:13px;font-weight:600;color:var(--txt);
            text-shadow:0 0 15px rgba(212,160,23,.06)}
        .success-track-btn{display:inline-flex;align-items:center;gap:8px;padding:13px 26px;
            background:rgba(212,160,23,.1);border:1px solid rgba(212,160,23,.25);border-radius:14px;
            color:var(--gold);font-size:14px;font-weight:600;text-decoration:none;margin-bottom:14px;
            transition:all .25s var(--ease-spring);box-shadow:inset 0 1px 0 rgba(255,255,255,.03);
            animation:blurReveal .6s .6s var(--ease-luxe) both}
        .success-track-btn:active{background:rgba(212,160,23,.2);transform:scale(.96)}
        .success-new-order{width:100%;padding:17px;border:none;border-radius:16px;
            background:linear-gradient(135deg,var(--gold),var(--gold-d));color:#080604;
            font-size:16px;font-weight:700;cursor:pointer;margin-top:6px;
            transition:all .25s var(--ease-spring);position:relative;overflow:hidden;
            box-shadow:0 4px 20px rgba(212,160,23,.25),inset 0 1px 0 rgba(255,255,255,.15);
            text-transform:uppercase;letter-spacing:.03em;
            animation:blurReveal .6s .7s var(--ease-luxe) both}
        .success-new-order::after{content:'';position:absolute;top:0;left:-100%;width:60%;height:100%;
            background:linear-gradient(90deg,transparent,rgba(255,255,255,.2),transparent);
            transition:left .5s var(--ease-out);pointer-events:none}
        .success-new-order:hover::after{left:140%}
        .success-new-order:active{transform:scale(.97)}
        .auto-reset-text{font-family:var(--mono);font-size:12px;color:var(--txt3);margin-top:16px;
            letter-spacing:.05em;animation:blurReveal .6s .8s var(--ease-luxe) both}

        /* ── Kiosk Feedback ──────────────────────────────────────── */
        .kiosk-feedback{margin-top:20px;padding:20px;background:rgba(212,160,23,.05);border:1px solid rgba(212,160,23,.12);
            border-radius:18px;text-align:center;animation:blurReveal .6s .9s var(--ease-luxe) both}
        .kiosk-feedback-title{font-family:'Playfair Display',serif;font-size:1.1rem;color:var(--gold);margin-bottom:12px}
        .kiosk-feedback-emojis{display:flex;justify-content:center;gap:12px;margin-bottom:14px}
        .kiosk-feedback-emoji{width:56px;height:56px;border-radius:50%;border:2px solid rgba(212,160,23,.15);
            background:rgba(212,160,23,.06);display:flex;align-items:center;justify-content:center;font-size:1.8rem;
            cursor:pointer;transition:all .25s ease}
        .kiosk-feedback-emoji:hover,.kiosk-feedback-emoji.selected{border-color:var(--gold);background:rgba(212,160,23,.15);
            transform:scale(1.15);box-shadow:0 0 20px rgba(212,160,23,.2)}
        .kiosk-feedback-comment{width:100%;padding:10px 14px;background:rgba(255,255,255,.05);border:1px solid rgba(212,160,23,.12);
            border-radius:10px;color:var(--txt);font-family:inherit;font-size:.85rem;resize:none;outline:none;
            margin-bottom:12px;transition:border-color .2s}
        .kiosk-feedback-comment:focus{border-color:rgba(212,160,23,.3)}
        .kiosk-feedback-comment::placeholder{color:rgba(160,144,128,.5)}
        .kiosk-feedback-submit{padding:10px 28px;background:linear-gradient(135deg,var(--gold),var(--gold-d));color:#080604;
            border:none;border-radius:12px;font-size:.9rem;font-weight:700;cursor:pointer;transition:all .25s;
            text-transform:uppercase;letter-spacing:.03em}
        .kiosk-feedback-submit:hover{transform:scale(1.04);box-shadow:0 4px 20px rgba(212,160,23,.3)}
        .kiosk-feedback-submit:disabled{opacity:.5;cursor:not-allowed;transform:none}
        .kiosk-feedback-thanks{font-family:'Playfair Display',serif;font-size:1.2rem;color:var(--gold);padding:20px 0}
        body.light-mode .kiosk-feedback{background:rgba(212,160,23,.04);border-color:rgba(212,160,23,.1)}
        body.light-mode .kiosk-feedback-comment{background:rgba(0,0,0,.03);color:#333}

        /* ── Loader Overlay ────────────────────────────────────── */
        .loader-overlay{position:fixed;inset:0;z-index:400;background:rgba(8,6,4,.88);
            backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);
            display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;
            opacity:0;pointer-events:none;transition:opacity .3s}
        .loader-overlay.show{opacity:1;pointer-events:auto}
        .loader-spinner{width:48px;height:48px;border:3px solid rgba(212,160,23,.1);
            border-top-color:var(--gold);border-radius:50%;animation:spin .8s linear infinite;
            box-shadow:0 0 20px rgba(212,160,23,.1)}
        @keyframes spin{to{transform:rotate(360deg)}}
        .loader-overlay p{color:var(--gold);font-size:13px;font-weight:500;letter-spacing:.06em;text-transform:uppercase}

        /* ── Toast ─────────────────────────────────────────────── */
        .toast{position:fixed;top:20px;left:50%;transform:translateX(-50%) translateY(-120px);z-index:600;
            background:linear-gradient(135deg,rgba(26,20,8,.96),rgba(14,11,7,.96));
            backdrop-filter:blur(20px);-webkit-backdrop-filter:blur(20px);
            border:1px solid rgba(212,160,23,.25);
            border-radius:14px;padding:13px 22px;color:var(--gold);font-size:13px;font-weight:500;
            box-shadow:0 8px 40px rgba(0,0,0,.5),0 0 20px rgba(212,160,23,.08);
            transition:transform .4s var(--ease-spring);white-space:nowrap;letter-spacing:.02em}
        .toast.show{transform:translateX(-50%) translateY(0)}

        /* ── Tablet Layout (≥768px) ────────────────────────────── */
        @media(min-width:768px){
            .cat-sidebar{display:block}
            .cat-tabs{display:none}
            .item-grid{grid-template-columns:repeat(3,1fr);gap:14px}
            .search-wrap{padding:14px 20px 0}
            .filter-row{padding:10px 20px}
            .menu-area{padding:0 14px 20px}
            .co-sheet{max-width:480px;left:auto;right:0;border-top-left-radius:28px;border-top-right-radius:0;
                height:100vh;max-height:100vh;top:0;border-top:none;border-left:1px solid rgba(212,160,23,.15)}
            .co-sheet.open{transform:translateX(0)}
            .header{padding:12px 20px}
        }
        @media(min-width:1024px){
            .item-grid{grid-template-columns:repeat(4,1fr);gap:16px}
            .cat-sidebar{width:200px}
        }

        /* ── Spice Picker Overlay ────────────────────────────────── */
        .spice-overlay{position:fixed;inset:0;z-index:350;background:rgba(0,0,0,.7);backdrop-filter:blur(6px);
            display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s var(--ease-out)}
        .spice-overlay.open{opacity:1;pointer-events:auto}
        .spice-sheet{width:100%;max-width:420px;background:linear-gradient(180deg,rgba(26,20,8,.97),rgba(14,11,7,.98));
            border-top-left-radius:24px;border-top-right-radius:24px;padding:20px 20px 28px;
            border-top:1px solid rgba(212,160,23,.15);transform:translateY(100%);transition:transform .35s var(--ease-spring);
            box-shadow:0 -8px 40px rgba(0,0,0,.5)}
        .spice-overlay.open .spice-sheet{transform:translateY(0)}
        .spice-title{font-family:'Playfair Display',serif;font-size:18px;color:var(--gold);margin-bottom:4px;text-align:center}
        .spice-item-name{font-size:12px;color:var(--txt2);text-align:center;margin-bottom:16px}
        .spice-options{display:grid;grid-template-columns:repeat(4,1fr);gap:10px}
        .spice-opt{padding:14px 8px;border-radius:14px;border:1.5px solid rgba(212,160,23,.12);background:rgba(212,160,23,.04);
            text-align:center;cursor:pointer;transition:all .25s var(--ease-spring);user-select:none}
        .spice-opt:active{transform:scale(.93)}
        .spice-opt.selected{border-color:var(--gold);background:rgba(212,160,23,.15);box-shadow:0 0 16px rgba(212,160,23,.1)}
        .spice-emoji{font-size:22px;display:block;margin-bottom:4px}
        .spice-label{font-size:11px;font-weight:600;color:var(--txt2)}
        .spice-opt.selected .spice-label{color:var(--gold)}
        .spice-skip{width:100%;margin-top:12px;padding:12px;border:none;border-radius:12px;
            background:rgba(212,160,23,.06);color:var(--txt3);font-size:13px;cursor:pointer;transition:all .2s}
        .spice-skip:active{background:rgba(212,160,23,.12)}

        /* ── Addon Picker Sheet ──────────────────────────────────── */
        .addon-overlay{position:fixed;inset:0;z-index:360;background:rgba(0,0,0,.7);backdrop-filter:blur(6px);
            display:flex;align-items:flex-end;justify-content:center;opacity:0;pointer-events:none;transition:opacity .3s var(--ease-out)}
        .addon-overlay.open{opacity:1;pointer-events:auto}
        .addon-sheet{width:100%;max-width:420px;max-height:70vh;background:linear-gradient(180deg,rgba(26,20,8,.97),rgba(14,11,7,.98));
            border-top-left-radius:24px;border-top-right-radius:24px;padding:20px 20px 28px;
            border-top:1px solid rgba(212,160,23,.15);transform:translateY(100%);transition:transform .35s var(--ease-spring);
            box-shadow:0 -8px 40px rgba(0,0,0,.5);overflow-y:auto}
        .addon-overlay.open .addon-sheet{transform:translateY(0)}
        .addon-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px}
        .addon-header h3{font-family:'Playfair Display',serif;font-size:17px;color:var(--gold)}
        .addon-total-badge{font-family:var(--mono);font-size:13px;color:var(--gold);background:rgba(212,160,23,.1);
            padding:4px 12px;border-radius:10px}
        .addon-item{display:flex;align-items:center;gap:12px;padding:12px 0;border-bottom:1px solid rgba(212,160,23,.06)}
        .addon-check{width:22px;height:22px;border-radius:6px;border:2px solid rgba(212,160,23,.2);background:transparent;
            cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all .2s var(--ease-spring);flex-shrink:0}
        .addon-check.checked{background:var(--gold);border-color:var(--gold)}
        .addon-check.checked::after{content:'\2713';color:#080604;font-size:13px;font-weight:700}
        .addon-info{flex:1;min-width:0}
        .addon-name{font-size:13px;color:var(--txt)}
        .addon-cat{font-size:10px;color:var(--txt3);text-transform:uppercase}
        .addon-price{font-family:var(--mono);font-size:13px;font-weight:600;color:var(--gold);white-space:nowrap}
        .addon-confirm{width:100%;margin-top:16px;padding:15px;border:none;border-radius:14px;
            background:linear-gradient(135deg,var(--gold),var(--gold-d));color:#080604;font-size:15px;font-weight:700;
            cursor:pointer;transition:all .25s var(--ease-spring);text-transform:uppercase;letter-spacing:.03em}
        .addon-confirm:active{transform:scale(.97)}
        .addon-none{text-align:center;padding:20px;color:var(--txt3);font-size:13px}

        /* ── Pairings Banner ─────────────────────────────────────── */
        .pairings-bar{position:fixed;bottom:80px;left:8px;right:8px;z-index:190;
            background:linear-gradient(135deg,rgba(26,20,8,.96),rgba(14,11,7,.96));
            backdrop-filter:blur(20px);border:1px solid rgba(212,160,23,.15);border-radius:16px;
            padding:12px 14px;transform:translateY(120%);transition:transform .4s var(--ease-spring);
            box-shadow:0 4px 24px rgba(0,0,0,.4)}
        .pairings-bar.show{transform:translateY(0)}
        .pairings-label{font-size:11px;color:var(--gold);font-weight:600;margin-bottom:8px;letter-spacing:.04em;text-transform:uppercase}
        .pairings-chips{display:flex;gap:8px;overflow-x:auto;scrollbar-width:none;-webkit-overflow-scrolling:touch}
        .pairings-chips::-webkit-scrollbar{display:none}
        .pairing-chip{flex-shrink:0;display:flex;align-items:center;gap:6px;padding:8px 14px;
            border-radius:12px;border:1px solid rgba(212,160,23,.15);background:rgba(212,160,23,.06);
            cursor:pointer;transition:all .25s var(--ease-spring);white-space:nowrap}
        .pairing-chip:active{transform:scale(.95);background:rgba(212,160,23,.15)}
        .pairing-chip-name{font-size:12px;color:var(--txt);font-weight:500}
        .pairing-chip-price{font-family:var(--mono);font-size:11px;color:var(--gold);font-weight:600}
        .pairing-chip-add{font-size:14px;color:var(--gold);font-weight:700}

        /* ── Item Rating Stars ───────────────────────────────────── */
        .item-rating{display:flex;align-items:center;gap:4px;margin-top:2px}
        .item-stars{color:var(--gold);font-size:11px;letter-spacing:1px}
        .item-rating-count{font-size:10px;color:var(--txt3)}

        /* ── Screensaver ─────────────────────────────────────────── */
        .screensaver{position:fixed;inset:0;z-index:9000;background:#080604;
            display:flex;flex-direction:column;align-items:center;justify-content:center;gap:30px;
            opacity:0;pointer-events:none;transition:opacity .8s var(--ease-luxe)}
        .screensaver.show{opacity:1;pointer-events:auto}
        .screensaver-logo{width:140px;height:140px;border-radius:50%;object-fit:contain;
            background:#d4a017;padding:6px;animation:preBreathe 3s ease-in-out infinite;
            box-shadow:0 0 60px rgba(212,160,23,.3),0 0 120px rgba(212,160,23,.1)}
        .screensaver-text{font-family:'Playfair Display',serif;font-size:28px;color:var(--gold);
            text-align:center;letter-spacing:.05em;animation:ssPulse 2.5s ease-in-out infinite;
            text-shadow:0 0 40px rgba(212,160,23,.2)}
        @keyframes ssPulse{0%,100%{opacity:.6;transform:scale(1)}50%{opacity:1;transform:scale(1.03)}}
        .screensaver-sub{font-size:14px;color:var(--txt3);letter-spacing:.1em;text-transform:uppercase;animation:ssPulse 2.5s ease-in-out infinite .5s}

        /* ── Voice Overlay ───────────────────────────────────────── */
        .voice-overlay{position:fixed;inset:0;z-index:370;background:rgba(0,0,0,.85);backdrop-filter:blur(10px);
            display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px;
            opacity:0;pointer-events:none;transition:opacity .3s}
        .voice-overlay.show{opacity:1;pointer-events:auto}
        .voice-mic{width:80px;height:80px;border-radius:50%;background:linear-gradient(135deg,var(--gold),var(--gold-d));
            display:flex;align-items:center;justify-content:center;animation:voicePulse 1.5s ease-in-out infinite;
            box-shadow:0 0 40px rgba(212,160,23,.3)}
        @keyframes voicePulse{0%,100%{transform:scale(1);box-shadow:0 0 40px rgba(212,160,23,.3)}
            50%{transform:scale(1.08);box-shadow:0 0 60px rgba(212,160,23,.5)}}
        .voice-mic svg{width:32px;height:32px;fill:#080604}
        .voice-text{font-size:16px;color:var(--txt);text-align:center;max-width:300px;min-height:24px}
        .voice-hint{font-size:12px;color:var(--txt3);text-align:center}
        .voice-cancel{padding:10px 24px;border:1px solid rgba(212,160,23,.2);border-radius:12px;
            background:transparent;color:var(--txt2);font-size:13px;cursor:pointer;transition:all .2s}
        .voice-cancel:active{background:rgba(212,160,23,.1)}
        .mic-btn{width:36px;height:36px;border-radius:50%;border:1px solid rgba(212,160,23,.15);
            background:rgba(212,160,23,.06);color:var(--gold);cursor:pointer;flex-shrink:0;
            display:flex;align-items:center;justify-content:center;transition:all .3s var(--ease-spring)}
        .mic-btn:active{transform:scale(.88)}
        .mic-btn svg{width:16px;height:16px}

        /* ── Detail View Modal ───────────────────────────────────── */
        .detail-overlay{position:fixed;inset:0;z-index:340;background:rgba(0,0,0,.7);backdrop-filter:blur(6px);
            display:flex;align-items:center;justify-content:center;padding:20px;
            opacity:0;pointer-events:none;transition:opacity .3s var(--ease-out)}
        .detail-overlay.open{opacity:1;pointer-events:auto}
        .detail-card{width:100%;max-width:400px;background:linear-gradient(180deg,rgba(26,20,8,.97),rgba(14,11,7,.98));
            border-radius:20px;overflow:hidden;border:1px solid rgba(212,160,23,.12);
            transform:scale(.9);transition:transform .35s var(--ease-spring);
            box-shadow:0 16px 60px rgba(0,0,0,.5)}
        .detail-overlay.open .detail-card{transform:scale(1)}
        .detail-img{width:100%;aspect-ratio:16/10;object-fit:cover;background:linear-gradient(135deg,rgba(212,160,23,.06),rgba(212,160,23,.02))}
        .detail-body{padding:18px 20px 22px}
        .detail-badge-row{display:flex;align-items:center;gap:8px;margin-bottom:6px}
        .detail-name{font-family:'Playfair Display',serif;font-size:22px;color:var(--gold);margin-bottom:4px}
        .detail-desc{font-size:13px;color:var(--txt2);line-height:1.5;margin-bottom:12px}
        .detail-rating{display:flex;align-items:center;gap:6px;margin-bottom:14px}
        .detail-rating .stars{color:var(--gold);font-size:14px}
        .detail-rating .count{font-size:12px;color:var(--txt3)}
        .detail-bottom{display:flex;align-items:center;justify-content:space-between}
        .detail-price{font-family:var(--mono);font-size:24px;font-weight:700;color:var(--gold)}
        .detail-add-btn{padding:13px 28px;border-radius:12px;border:none;
            background:linear-gradient(135deg,var(--gold),var(--gold-d));color:#080604;font-size:14px;
            font-weight:700;cursor:pointer;text-transform:uppercase;letter-spacing:.03em;
            transition:all .25s var(--ease-spring);position:relative;overflow:hidden}
        .detail-add-btn:active{transform:scale(.93)}
        .detail-close{position:absolute;top:12px;right:12px;width:34px;height:34px;border-radius:50%;
            background:rgba(0,0,0,.5);backdrop-filter:blur(8px);border:none;color:#fff;font-size:18px;
            cursor:pointer;display:flex;align-items:center;justify-content:center;z-index:2;transition:all .2s}
        .detail-close:active{transform:scale(.88)}

        /* ── Staff Call Button ────────────────────────────────────── */
        .staff-call-btn{position:fixed;bottom:90px;left:16px;z-index:180;
            display:flex;align-items:center;gap:8px;padding:10px 16px;
            background:linear-gradient(135deg,rgba(26,20,8,.96),rgba(14,11,7,.96));
            backdrop-filter:blur(16px);border:1px solid rgba(212,160,23,.15);border-radius:14px;
            color:var(--txt2);font-size:12px;font-weight:500;cursor:pointer;
            transition:all .3s var(--ease-spring);box-shadow:0 4px 16px rgba(0,0,0,.3)}
        .staff-call-btn:active{transform:scale(.94);background:rgba(212,160,23,.1)}
        .staff-call-btn svg{width:16px;height:16px;stroke:var(--gold)}

        /* ── Light Mode ──────────────────────────────────────────── */
        body.light-mode{--bg:#f5f0e8;--bg2:rgba(245,240,232,.94);--bg-card:rgba(255,252,248,.92);
            --txt:#1a1610;--txt2:#5a5040;--txt3:#8a7a68;--txt4:#bab0a0;
            --shadow-s:0 1px 3px rgba(0,0,0,.08),0 4px 12px rgba(0,0,0,.05);
            --shadow-m:0 2px 8px rgba(0,0,0,.08),0 8px 24px rgba(0,0,0,.06)}
        body.light-mode::after{opacity:.015}
        body.light-mode::before{background:radial-gradient(ellipse at 30% 0%,rgba(212,160,23,.06) 0%,transparent 50%),
            radial-gradient(ellipse at 70% 100%,rgba(139,26,26,.04) 0%,transparent 50%)}
        body.light-mode .header{background:linear-gradient(135deg,rgba(245,240,232,.97),rgba(235,228,216,.97))}
        body.light-mode .item-card{border-color:rgba(0,0,0,.08)}
        body.light-mode .item-card::before{background:linear-gradient(90deg,transparent,rgba(212,160,23,.1),transparent)}
        body.light-mode .cart-bar{background:linear-gradient(to top,rgba(245,240,232,.98),rgba(245,240,232,.9))}
        body.light-mode .co-sheet{background:linear-gradient(180deg,rgba(255,252,248,.98),rgba(245,240,232,.98))}
        body.light-mode .success-screen{background:rgba(245,240,232,.97)}
        body.light-mode .screensaver{background:#f5f0e8}
        body.light-mode .ap{background:radial-gradient(circle,rgba(212,160,23,.1),transparent 70%)}
        .mode-btn{width:34px;height:34px;border-radius:50%;border:1px solid rgba(212,160,23,.15);
            background:rgba(212,160,23,.06);color:var(--gold);cursor:pointer;flex-shrink:0;
            display:flex;align-items:center;justify-content:center;transition:all .3s var(--ease-spring);font-size:16px}
        .mode-btn:active{transform:scale(.88)}

        /* ── Accessibility / Large Font ──────────────────────────── */
        body.large-font{font-size:120%}
        body.large-font .item-name{font-size:15px}
        body.large-font .item-price{font-size:19px}
        body.large-font .add-btn{min-height:48px;padding:11px 26px;font-size:15px}
        body.large-font .cat-tab,.large-font .cat-item{font-size:14px;min-height:48px}
        body.large-font .filter-chip{min-height:48px;font-size:15px}
        body.large-font .search-bar input{font-size:16px}

        /* ── Loyalty Display in Checkout ──────────────────────────── */
        .loyalty-bar{padding:12px 14px;margin:12px 0;border-radius:14px;
            background:rgba(212,160,23,.06);border:1px solid rgba(212,160,23,.12);display:none}
        .loyalty-bar.show{display:block}
        .loyalty-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:6px}
        .loyalty-tier-name{display:flex;align-items:center;gap:6px;font-size:13px;font-weight:600;color:var(--gold)}
        .loyalty-pts-text{font-family:var(--mono);font-size:12px;color:var(--txt2)}
        .loyalty-redeem{display:flex;align-items:center;justify-content:space-between;padding:8px 0 0;
            border-top:1px solid rgba(212,160,23,.08);margin-top:6px}
        .loyalty-redeem-label{font-size:12px;color:var(--txt2)}
        .loyalty-redeem-toggle{width:44px;height:24px;border-radius:12px;border:none;
            background:rgba(212,160,23,.15);position:relative;cursor:pointer;transition:background .2s}
        .loyalty-redeem-toggle.on{background:var(--gold)}
        .loyalty-redeem-toggle::after{content:'';width:20px;height:20px;border-radius:50%;background:#fff;
            position:absolute;top:2px;left:2px;transition:transform .2s var(--ease-spring)}
        .loyalty-redeem-toggle.on::after{transform:translateX(20px)}

        /* ── Wait Time Display ───────────────────────────────────── */
        .wait-time-row{display:flex;align-items:center;gap:8px;padding:10px 14px;margin:10px 0;
            background:rgba(212,160,23,.06);border:1px solid rgba(212,160,23,.1);border-radius:12px}
        .wait-time-icon{font-size:20px}
        .wait-time-text{font-size:13px;color:var(--txt)}
        .wait-time-mins{font-family:var(--mono);font-weight:700;color:var(--gold)}

        /* ── WhatsApp Receipt Button ─────────────────────────────── */
        .whatsapp-btn{display:inline-flex;align-items:center;gap:8px;padding:12px 22px;
            background:#25D366;border:none;border-radius:14px;color:#fff;font-size:13px;font-weight:600;
            cursor:pointer;transition:all .25s var(--ease-spring);margin-bottom:10px;
            box-shadow:0 4px 16px rgba(37,211,102,.25);text-decoration:none;
            animation:blurReveal .6s .55s var(--ease-luxe) both}
        .whatsapp-btn:active{transform:scale(.96)}
        .whatsapp-btn svg{width:18px;height:18px;fill:#fff}

        /* ── Recently Ordered Section ────────────────────────────── */
        .recent-section{margin:12px 0;padding:14px;border-radius:14px;
            background:rgba(212,160,23,.04);border:1px solid rgba(212,160,23,.08);display:none}
        .recent-section.show{display:block}
        .recent-title{font-size:12px;color:var(--gold);font-weight:600;margin-bottom:10px;
            letter-spacing:.04em;text-transform:uppercase}
        .recent-items{display:flex;flex-wrap:wrap;gap:8px}
        .recent-chip{padding:8px 14px;border-radius:10px;border:1px solid rgba(212,160,23,.12);
            background:rgba(212,160,23,.05);font-size:12px;color:var(--txt);cursor:pointer;
            transition:all .2s;white-space:nowrap}
        .recent-chip:active{background:rgba(212,160,23,.15)}
        .reorder-btn{width:100%;margin-top:10px;padding:11px;border:1px solid rgba(212,160,23,.2);
            border-radius:12px;background:rgba(212,160,23,.06);color:var(--gold);font-size:13px;
            font-weight:600;cursor:pointer;transition:all .2s}
        .reorder-btn:active{background:rgba(212,160,23,.15)}

        /* ── Spice Indicator in Cart ─────────────────────────────── */
        .co-item-spice{font-size:12px;margin-left:6px}
        .co-item-addons{font-size:10px;color:var(--txt3);display:block;margin-top:2px}

        /* ── Popular Badge ───────────────────────────────────────── */
        .popular-tag{display:inline-block;background:linear-gradient(135deg,#ff6b35,#ff4500);color:#fff;
            font-size:8px;font-weight:700;padding:2px 6px;border-radius:4px;vertical-align:middle;margin-left:4px;
            letter-spacing:.03em;text-transform:uppercase;box-shadow:0 2px 8px rgba(255,69,0,.25)}

        /* ── QR Scanner Overlay ───────────────────────────────────── */
        .qr-overlay{position:fixed;inset:0;z-index:380;background:rgba(0,0,0,.9);
            display:flex;flex-direction:column;align-items:center;justify-content:center;gap:16px;
            opacity:0;pointer-events:none;transition:opacity .3s}
        .qr-overlay.show{opacity:1;pointer-events:auto}
        .qr-video{width:280px;height:280px;border-radius:16px;object-fit:cover;border:2px solid var(--gold)}
        .qr-label{font-size:13px;color:var(--txt2)}
        .qr-close{padding:10px 24px;border:1px solid rgba(212,160,23,.2);border-radius:12px;
            background:transparent;color:var(--txt2);font-size:13px;cursor:pointer}
        .table-qr-btn{width:40px;height:40px;border-radius:10px;border:1px solid rgba(212,160,23,.12);
            background:rgba(212,160,23,.04);color:var(--gold);cursor:pointer;display:flex;
            align-items:center;justify-content:center;transition:all .2s;flex-shrink:0}
        .table-qr-btn:active{transform:scale(.92)}
        .table-qr-btn svg{width:18px;height:18px}
        .table-input-row{display:flex;gap:8px;align-items:stretch}
        .table-input-row input{flex:1}
    </style>
</head>
<body>

<!-- Ambient Floating Particles -->
<div class="ambient-particles" aria-hidden="true">
    <span class="ap ap1"></span><span class="ap ap2"></span><span class="ap ap3"></span>
    <span class="ap ap4"></span><span class="ap ap5"></span><span class="ap ap6"></span>
</div>

<!-- Preloader -->
<div class="preloader" id="preloader">
    <img class="preloader-logo" src="../amogha-logo.png" alt="Amogha">
    <p data-i18n="loading">Loading Menu</p>
    <div class="pre-bar"><div class="pre-bar-fill"></div></div>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Header -->
<header class="header">
    <div class="header-row">
        <img class="header-logo" src="../amogha-logo.png" alt="Amogha">
        <div class="header-info">
            <h1>Amogha Cafe</h1>
            <p data-i18n="selfService">Self-Service Ordering</p>
        </div>
        <div class="header-actions">
            <div class="lang-toggle">
                <button class="lang-btn active" onclick="setLang('en')">EN</button>
                <button class="lang-btn" onclick="setLang('te')">తెలుగు</button>
                <button class="lang-btn" onclick="setLang('hi')">हिंदी</button>
            </div>
            <button class="mode-btn" onclick="toggleLightMode()" title="Light/Dark Mode" id="mode-toggle">&#9788;</button>
            <button class="mode-btn" onclick="toggleAccessibility()" title="Accessibility" id="acc-toggle" style="font-size:13px;font-weight:700">Aa</button>
            <button class="fs-btn" onclick="toggleFullscreen()" title="Fullscreen">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                    <path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/>
                </svg>
            </button>
        </div>
    </div>
</header>

<!-- Featured Bestsellers Banner -->
<div class="featured-strip" id="featured-strip" style="display:none">
    <div class="featured-track" id="featured-track"></div>
</div>

<!-- Search -->
<div class="search-wrap">
    <div class="search-bar">
        <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round">
            <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
        </svg>
        <input type="text" id="search-input" data-i18n-placeholder="searchMenu" placeholder="Search menu..." autocomplete="off">
        <button class="mic-btn" onclick="startVoiceOrder()" title="Voice Order">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/>
            </svg>
        </button>
    </div>
</div>

<!-- Filters -->
<div class="filter-row">
    <div class="filter-chip active" data-filter="all" onclick="setFilter('all',this)" data-i18n="all">All</div>
    <div class="filter-chip" data-filter="veg" onclick="setFilter('veg',this)">
        <span class="dot veg"></span><span data-i18n="veg">Veg</span>
    </div>
    <div class="filter-chip" data-filter="nv" onclick="setFilter('nv',this)">
        <span class="dot nv"></span><span data-i18n="nonVeg">Non-Veg</span>
    </div>
    <div class="filter-chip" data-filter="popular" onclick="setFilter('popular',this)">&#128293; Popular</div>
    <div class="filter-chip" data-filter="chef" onclick="setFilter('chef',this)">&#11088; Chef's Pick</div>
</div>

<!-- Category Tabs (phone only) -->
<div class="cat-tabs" id="cat-tabs"></div>

<!-- Main Body -->
<div class="kiosk-body">
    <nav class="cat-sidebar" id="cat-sidebar"></nav>
    <main class="menu-area">
        <div id="menu-container"></div>
        <div class="no-results hidden" id="no-results">
            <svg viewBox="0 0 24 24" fill="none" stroke-width="1.5" stroke-linecap="round">
                <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>
                <line x1="8" y1="11" x2="14" y2="11"/>
            </svg>
            <p data-i18n="noItems">No items found. Try a different search.</p>
        </div>
    </main>
</div>

<!-- Floating Cart Bar -->
<div class="cart-bar" id="cart-bar">
    <div class="cart-bar-inner">
        <div class="cart-info">
            <div class="cart-badge" id="bar-count">0</div>
            <div class="cart-summary">
                <div class="cart-count" id="bar-label">items in cart</div>
                <div class="cart-total" id="bar-total">&#8377;0</div>
            </div>
        </div>
        <button class="cart-btn" onclick="openCheckout()" data-i18n="viewCart">View Cart &rarr;</button>
    </div>
</div>

<!-- Checkout Overlay -->
<div class="co-overlay" id="co-overlay" onclick="closeCheckout()"></div>

<!-- Checkout Sheet -->
<div class="co-sheet" id="co-sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-header">
        <h2 data-i18n="yourOrder">Your Order</h2>
        <button class="sheet-close" onclick="closeCheckout()">&times;</button>
    </div>
    <div class="sheet-body">
        <div id="co-items"></div>
        <div class="co-totals">
            <div class="co-row"><span data-i18n="subtotal">Subtotal</span><span id="co-subtotal">&#8377;0</span></div>
            <div class="co-row total"><span data-i18n="total">Total</span><span id="co-total">&#8377;0</span></div>
        </div>
        <div class="co-form" id="co-form">
            <label data-i18n="yourName">Your Name *</label>
            <input type="text" id="co-name" data-i18n-placeholder="enterName" placeholder="Enter your name" autocomplete="name">
            <label data-i18n="phoneNumber">Phone Number *</label>
            <input type="tel" id="co-phone" data-i18n-placeholder="enterPhone" placeholder="10-digit phone number" maxlength="10" autocomplete="tel">
            <div class="loyalty-bar" id="loyalty-bar">
                <div class="loyalty-top">
                    <span class="loyalty-tier-name" id="loyalty-tier-name"></span>
                    <span class="loyalty-pts-text" id="loyalty-pts-text"></span>
                </div>
                <div class="loyalty-redeem" id="loyalty-redeem" style="display:none">
                    <span class="loyalty-redeem-label" id="loyalty-redeem-label"></span>
                    <button class="loyalty-redeem-toggle" id="loyalty-redeem-toggle" onclick="toggleLoyaltyRedeem()"></button>
                </div>
            </div>
            <div class="recent-section" id="recent-section">
                <div class="recent-title">&#128260; Order Again</div>
                <div class="recent-items" id="recent-items"></div>
                <button class="reorder-btn" id="reorder-btn" onclick="reorderAll()">Reorder All</button>
            </div>
            <label data-i18n="tableLabel">Table Number (optional)</label>
            <div class="table-input-row">
                <input type="text" id="co-table" data-i18n-placeholder="enterTable" placeholder="e.g. 5" maxlength="3" autocomplete="off">
                <button class="table-qr-btn" onclick="openQRScanner()" title="Scan QR">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                        <rect x="2" y="2" width="8" height="8" rx="1"/><rect x="14" y="2" width="8" height="8" rx="1"/>
                        <rect x="2" y="14" width="8" height="8" rx="1"/><rect x="14" y="14" width="4" height="4"/>
                        <line x1="22" y1="14" x2="22" y2="18"/><line x1="18" y1="22" x2="22" y2="22"/>
                    </svg>
                </button>
            </div>
            <label data-i18n="notesLabel">Special Instructions (optional)</label>
            <textarea id="co-notes" data-i18n-placeholder="enterNotes" placeholder="Any allergies, preferences, or notes..."></textarea>
            <button class="pay-btn" id="pay-btn" onclick="initiatePayment()" data-i18n="payNow">Pay &#8377;0</button>
            <div class="pay-divider" data-i18n="orText">or</div>
            <button class="cod-btn" onclick="placeOrderCOD()" data-i18n="payAtCounter">Pay at Counter</button>
        </div>
    </div>
</div>

<!-- Success Screen -->
<div class="success-screen" id="success-screen">
    <canvas class="success-confetti" id="confetti-canvas"></canvas>
    <div class="success-content">
        <div class="success-check">
            <svg viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round">
                <polyline points="4 12 9 17 20 6"/>
            </svg>
        </div>
        <h2 data-i18n="orderConfirmed">Order Confirmed!</h2>
        <p class="success-subtitle" data-i18n="orderSentKitchen">Your order has been sent to the kitchen.<br>Sit back and relax!</p>
        <div class="success-order-card" id="success-card">
            <div class="soc-row"><span class="soc-label" data-i18n="orderId">Order ID</span><span class="soc-value" id="soc-id">--</span></div>
            <div class="soc-row"><span class="soc-label" data-i18n="items">Items</span><span class="soc-value" id="soc-items">--</span></div>
            <div class="soc-row"><span class="soc-label" data-i18n="total">Total</span><span class="soc-value" id="soc-total">--</span></div>
            <div class="soc-row"><span class="soc-label" data-i18n="paymentLabel">Payment</span><span class="soc-value" id="soc-payment">--</span></div>
        </div>
        <div class="wait-time-row" id="wait-time-row" style="display:none">
            <span class="wait-time-icon">&#9202;</span>
            <span class="wait-time-text">Estimated wait: <span class="wait-time-mins" id="wait-time-mins">~15 min</span></span>
        </div>
        <a class="whatsapp-btn" id="whatsapp-btn" href="#" target="_blank" style="display:none">
            <svg viewBox="0 0 24 24"><path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347z"/><path d="M12 0C5.373 0 0 5.373 0 12c0 2.625.846 5.059 2.284 7.034L.789 23.492a.5.5 0 0 0 .611.611l4.458-1.495A11.946 11.946 0 0 0 12 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 22c-2.34 0-4.508-.646-6.376-1.768l-.447-.275-2.912.976.976-2.912-.275-.447A9.955 9.955 0 0 1 2 12C2 6.486 6.486 2 12 2s10 4.486 10 10-4.486 10-10 10z"/></svg>
            Send Receipt via WhatsApp
        </a>
        <a class="success-track-btn" id="success-track" href="#" target="_blank">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" width="18" height="18" stroke-linecap="round">
                <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>
            </svg>
            <span data-i18n="trackOrder">Track Your Order</span>
        </a>
        <!-- Kiosk Feedback Section -->
        <div class="kiosk-feedback" id="kiosk-feedback">
            <div class="kiosk-feedback-title">How was your experience?</div>
            <div class="kiosk-feedback-emojis" id="feedback-emojis">
                <div class="kiosk-feedback-emoji" onclick="selectFeedbackRating(1)" data-rating="1">&#128544;</div>
                <div class="kiosk-feedback-emoji" onclick="selectFeedbackRating(2)" data-rating="2">&#128528;</div>
                <div class="kiosk-feedback-emoji" onclick="selectFeedbackRating(3)" data-rating="3">&#128522;</div>
                <div class="kiosk-feedback-emoji" onclick="selectFeedbackRating(4)" data-rating="4">&#128525;</div>
            </div>
            <textarea class="kiosk-feedback-comment" id="feedback-comment" placeholder="Any comments? (optional)" rows="2"></textarea>
            <button class="kiosk-feedback-submit" id="feedback-submit-btn" onclick="submitKioskFeedback()" disabled>Submit Feedback</button>
        </div>
        <div id="kiosk-feedback-thanks" style="display:none">
            <div class="kiosk-feedback-thanks">&#10024; Thank you for your feedback! &#10024;</div>
        </div>

        <button class="success-new-order" onclick="resetOrder()" data-i18n="newOrder">Place Another Order</button>
        <p class="auto-reset-text" id="auto-reset-text"></p>
    </div>
</div>

<!-- Spice Picker Overlay -->
<div class="spice-overlay" id="spice-overlay" onclick="if(event.target===this)closeSpicePicker()">
    <div class="spice-sheet">
        <div class="spice-title" data-i18n="selectSpice">Select Spice Level</div>
        <div class="spice-item-name" id="spice-item-name"></div>
        <div class="spice-options">
            <div class="spice-opt" onclick="pickSpice('none')"><span class="spice-emoji">&#128522;</span><span class="spice-label">No Spice</span></div>
            <div class="spice-opt" onclick="pickSpice('mild')"><span class="spice-emoji">&#127798;</span><span class="spice-label">Mild</span></div>
            <div class="spice-opt" onclick="pickSpice('medium')"><span class="spice-emoji">&#127798;&#127798;</span><span class="spice-label">Medium</span></div>
            <div class="spice-opt" onclick="pickSpice('hot')"><span class="spice-emoji">&#127798;&#127798;&#127798;</span><span class="spice-label">Hot</span></div>
        </div>
        <button class="spice-skip" onclick="pickSpice('medium')" data-i18n="skipDefault">Skip (Medium)</button>
    </div>
</div>

<!-- Addon Picker Overlay -->
<div class="addon-overlay" id="addon-overlay" onclick="if(event.target===this)confirmAddons()">
    <div class="addon-sheet">
        <div class="addon-header">
            <h3 data-i18n="addExtras">Add Extras</h3>
            <span class="addon-total-badge" id="addon-total-badge">+&#8377;0</span>
        </div>
        <div id="addon-list"></div>
        <button class="addon-confirm" id="addon-confirm-btn" onclick="confirmAddons()" data-i18n="addToCart">Add to Cart</button>
    </div>
</div>

<!-- Pairings Banner -->
<div class="pairings-bar" id="pairings-bar">
    <div class="pairings-label">&#10024; Perfect Pairings</div>
    <div class="pairings-chips" id="pairings-chips"></div>
</div>

<!-- Voice Overlay -->
<div class="voice-overlay" id="voice-overlay">
    <div class="voice-mic">
        <svg viewBox="0 0 24 24"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23" stroke="#080604" stroke-width="2"/><line x1="8" y1="23" x2="16" y2="23" stroke="#080604" stroke-width="2"/></svg>
    </div>
    <div class="voice-text" id="voice-text">Listening...</div>
    <div class="voice-hint">Say "Add 2 Butter Chicken" or "Checkout"</div>
    <button class="voice-cancel" onclick="stopVoiceOrder()">Cancel</button>
</div>

<!-- Screensaver -->
<div class="screensaver" id="screensaver" onclick="dismissScreensaver()">
    <img class="screensaver-logo" src="../amogha-logo.png" alt="Amogha" loading="lazy">
    <div class="screensaver-text">Amogha Cafe &amp; Restaurant</div>
    <div class="screensaver-sub">Touch to Order</div>
</div>

<!-- Detail View Modal -->
<div class="detail-overlay" id="detail-overlay" onclick="if(event.target===this)closeDetail()">
    <div class="detail-card">
        <button class="detail-close" onclick="closeDetail()">&times;</button>
        <img class="detail-img" id="detail-img" src="" alt="" loading="lazy">
        <div class="detail-body">
            <div class="detail-badge-row" id="detail-badge-row"></div>
            <div class="detail-name" id="detail-name"></div>
            <div class="detail-desc" id="detail-desc"></div>
            <div class="detail-rating" id="detail-rating"></div>
            <div class="detail-bottom">
                <div class="detail-price" id="detail-price"></div>
                <button class="detail-add-btn" id="detail-add-btn">ADD</button>
            </div>
        </div>
    </div>
</div>

<!-- Staff Call Button -->
<div class="staff-call-btn" id="staff-call-btn" onclick="callStaff()">
    <svg viewBox="0 0 24 24" fill="none" stroke-width="2" stroke-linecap="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
    <span data-i18n="needHelp">Need Help?</span>
</div>

<!-- QR Scanner Overlay -->
<div class="qr-overlay" id="qr-overlay">
    <div class="qr-label">Scan table QR code</div>
    <video class="qr-video" id="qr-video" autoplay playsinline></video>
    <button class="qr-close" onclick="closeQRScanner()">Close</button>
</div>

<!-- Loader -->
<div class="loader-overlay" id="loader">
    <div class="loader-spinner"></div>
    <p data-i18n="placingOrder">Placing your order...</p>
</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>
<!-- Razorpay SDK -->
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>

<script>
// ── XSS Prevention ─────────────────────────────────────────────
function escHtml(str) {
    if (!str) return '';
    return String(str).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;').replace(/'/g,'&#039;');
}

// ── Firebase Init ──────────────────────────────────────────────
firebase.initializeApp({
    apiKey: "AIzaSyCM0LIBRVreGCYBknlk_xEXoomzM3JAVBw",
    authDomain: "amogha-cafe.firebaseapp.com",
    projectId: "amogha-cafe",
    storageBucket: "amogha-cafe.firebasestorage.app",
    messagingSenderId: "1000994409697",
    appId: "1:1000994409697:web:983214bafab529d6a2fba0"
});
var db = firebase.firestore();

// ── Capacitor Native App Detection ──────────────────────────────
var isCapacitorApp = typeof window.Capacitor !== 'undefined';
if (isCapacitorApp) {
    // Hide fullscreen button (native app is always fullscreen)
    var fsBtn = document.querySelector('.fs-btn');
    if (fsBtn) fsBtn.style.display = 'none';
    // Flag to skip SW registration
    window.__SKIP_SW = true;
}

// ── Translations ───────────────────────────────────────────────
var TR = {
    en: {
        selfService: 'Self-Service Ordering',
        searchMenu: 'Search menu...',
        all: 'All', veg: 'Veg', nonVeg: 'Non-Veg',
        noItems: 'No items found. Try a different search.',
        viewCart: 'View Cart \u2192',
        yourOrder: 'Your Order',
        subtotal: 'Subtotal', total: 'Total',
        yourName: 'Your Name *', enterName: 'Enter your name',
        phoneNumber: 'Phone Number *', enterPhone: '10-digit phone number',
        tableLabel: 'Table Number (optional)', enterTable: 'e.g. 5',
        notesLabel: 'Special Instructions (optional)',
        enterNotes: 'Any allergies, preferences, or notes...',
        payNow: 'Pay', payAtCounter: 'Pay at Counter', orText: 'or',
        orderConfirmed: 'Order Confirmed!',
        orderSentKitchen: 'Your order has been sent to the kitchen.<br>Sit back and relax!',
        orderId: 'Order ID', items: 'Items', paymentLabel: 'Payment',
        trackOrder: 'Track Your Order', newOrder: 'Place Another Order',
        placingOrder: 'Placing your order...', loading: 'Loading Menu',
        autoReset: 'Auto-reset in {s}s',
        itemsInCart: 'items in cart', oneItem: '1 item',
        addToOrder: 'ADD',
        selectSpice: 'Select Spice Level', skipDefault: 'Skip (Medium)',
        addExtras: 'Add Extras', addToCart: 'Add to Cart',
        needHelp: 'Need Help?', staffNotified: 'Staff has been notified!',
        estimatedWait: 'Estimated wait'
    },
    hi: {
        selfService: '\u0938\u0947\u0932\u094D\u092B\u094D-\u0938\u0930\u094D\u0935\u093F\u0938 \u0911\u0930\u094D\u0921\u0930\u093F\u0902\u0917',
        searchMenu: '\u092E\u0947\u0928\u094D\u092F\u0942 \u0916\u094B\u091C\u0947\u0902...',
        all: '\u0938\u092D\u0940', veg: '\u0936\u093E\u0915\u093E\u0939\u093E\u0930\u0940', nonVeg: '\u092E\u093E\u0902\u0938\u093E\u0939\u093E\u0930\u0940',
        noItems: '\u0915\u094B\u0908 \u0906\u0907\u091F\u092E \u0928\u0939\u0940\u0902 \u092E\u093F\u0932\u093E\u0964 \u0926\u0942\u0938\u0930\u093E \u0916\u094B\u091C\u0947\u0902\u0964',
        viewCart: '\u0915\u093E\u0930\u094D\u091F \u0926\u0947\u0916\u0947\u0902 \u2192',
        yourOrder: '\u0906\u092A\u0915\u093E \u0911\u0930\u094D\u0921\u0930',
        subtotal: '\u0909\u092A \u0915\u0941\u0932', total: '\u0915\u0941\u0932',
        yourName: '\u0906\u092A\u0915\u093E \u0928\u093E\u092E *', enterName: '\u0928\u093E\u092E \u0926\u0930\u094D\u091C \u0915\u0930\u0947\u0902',
        phoneNumber: '\u092B\u094B\u0928 \u0928\u0902\u092C\u0930 *', enterPhone: '10-\u0905\u0902\u0915\u094B\u0902 \u0915\u093E \u092B\u094B\u0928 \u0928\u0902\u092C\u0930',
        tableLabel: '\u091F\u0947\u092C\u0932 \u0928\u0902\u092C\u0930 (\u0935\u0948\u0915\u0932\u094D\u092A\u093F\u0915)', enterTable: '\u091C\u0948\u0938\u0947 5',
        notesLabel: '\u0935\u093F\u0936\u0947\u0937 \u0928\u093F\u0930\u094D\u0926\u0947\u0936 (\u0935\u0948\u0915\u0932\u094D\u092A\u093F\u0915)',
        enterNotes: '\u090F\u0932\u0930\u094D\u091C\u0940, \u092A\u0938\u0902\u0926...',
        payNow: '\u092D\u0941\u0917\u0924\u093E\u0928 \u0915\u0930\u0947\u0902', payAtCounter: '\u0915\u093E\u0909\u0902\u091F\u0930 \u092A\u0930 \u092D\u0941\u0917\u0924\u093E\u0928', orText: '\u092F\u093E',
        orderConfirmed: '\u0911\u0930\u094D\u0921\u0930 \u0915\u0928\u094D\u092B\u0930\u094D\u092E!',
        orderSentKitchen: '\u0906\u092A\u0915\u093E \u0911\u0930\u094D\u0921\u0930 \u0915\u093F\u091A\u0928 \u092E\u0947\u0902 \u092D\u0947\u091C \u0926\u093F\u092F\u093E \u0917\u092F\u093E \u0939\u0948\u0964<br>\u0906\u0930\u093E\u092E \u0938\u0947 \u092C\u0948\u0920\u0947\u0902!',
        orderId: '\u0911\u0930\u094D\u0921\u0930 ID', items: '\u0906\u0907\u091F\u092E\u094D\u0938', paymentLabel: '\u092D\u0941\u0917\u0924\u093E\u0928',
        trackOrder: '\u0911\u0930\u094D\u0921\u0930 \u091F\u094D\u0930\u0948\u0915 \u0915\u0930\u0947\u0902', newOrder: '\u0928\u092F\u093E \u0911\u0930\u094D\u0921\u0930 \u0926\u0947\u0902',
        placingOrder: '\u0911\u0930\u094D\u0921\u0930 \u0926\u0947 \u0930\u0939\u0947 \u0939\u0948\u0902...', loading: '\u092E\u0947\u0928\u094D\u092F\u0942 \u0932\u094B\u0921 \u0939\u094B \u0930\u0939\u093E \u0939\u0948',
        autoReset: '{s}\u0938\u0947\u0915\u0902\u0921 \u092E\u0947\u0902 \u0930\u0940\u0938\u0947\u091F',
        itemsInCart: '\u0915\u093E\u0930\u094D\u091F \u092E\u0947\u0902 \u0906\u0907\u091F\u092E', oneItem: '1 \u0906\u0907\u091F\u092E',
        addToOrder: '\u091C\u094B\u0921\u093C\u0947\u0902',
        selectSpice: '\u0924\u0940\u0916\u093E\u092A\u0928 \u091A\u0941\u0928\u0947\u0902', skipDefault: '\u0938\u094D\u0915\u093F\u092A (\u092E\u0940\u0921\u093F\u092F\u092E)',
        addExtras: '\u090F\u0915\u094D\u0938\u094D\u091F\u094D\u0930\u093E \u091C\u094B\u0921\u093C\u0947\u0902', addToCart: '\u0915\u093E\u0930\u094D\u091F \u092E\u0947\u0902 \u091C\u094B\u0921\u093C\u0947\u0902',
        needHelp: '\u092E\u0926\u0926 \u091A\u093E\u0939\u093F\u090F?', staffNotified: '\u0938\u094D\u091F\u093E\u092B \u0915\u094B \u0938\u0942\u091A\u093F\u0924 \u0915\u0930 \u0926\u093F\u092F\u093E!',
        estimatedWait: '\u0905\u0928\u0941\u092E\u093E\u0928\u093F\u0924 \u092A\u094D\u0930\u0924\u0940\u0915\u094D\u0937\u093E'
    },
    te: {
        selfService: '\u0C38\u0C46\u0C32\u0C4D\u0C2B\u0C4D-\u0C38\u0C30\u0C4D\u0C35\u0C40\u0C38\u0C4D \u0C06\u0C30\u0C4D\u0C21\u0C30\u0C3F\u0C02\u0C17\u0C4D',
        searchMenu: '\u0C2E\u0C46\u0C28\u0C42 \u0C35\u0C46\u0C24\u0C15\u0C02\u0C21\u0C3F...',
        all: '\u0C05\u0C28\u0C4D\u0C28\u0C40', veg: '\u0C36\u0C3E\u0C15\u0C3E\u0C39\u0C3E\u0C30\u0C02', nonVeg: '\u0C2E\u0C3E\u0C02\u0C38\u0C3E\u0C39\u0C3E\u0C30\u0C02',
        noItems: '\u0C0F\u0C2E\u0C40 \u0C15\u0C28\u0C41\u0C17\u0C4A\u0C28\u0C32\u0C47\u0C26\u0C41. \u0C35\u0C47\u0C30\u0C47 \u0C35\u0C46\u0C24\u0C15\u0C02\u0C21\u0C3F.',
        viewCart: '\u0C15\u0C3E\u0C30\u0C4D\u0C1F\u0C4D \u0C1A\u0C42\u0C21\u0C02\u0C21\u0C3F \u2192',
        yourOrder: '\u0C2E\u0C40 \u0C06\u0C30\u0C4D\u0C21\u0C30\u0C4D',
        subtotal: '\u0C09\u0C2A \u0C2E\u0C4A\u0C24\u0C4D\u0C24\u0C02', total: '\u0C2E\u0C4A\u0C24\u0C4D\u0C24\u0C02',
        yourName: '\u0C2E\u0C40 \u0C2A\u0C47\u0C30\u0C41 *', enterName: '\u0C2A\u0C47\u0C30\u0C41 \u0C28\u0C2E\u0C4B\u0C26\u0C41 \u0C1A\u0C47\u0C2F\u0C02\u0C21\u0C3F',
        phoneNumber: '\u0C2B\u0C4B\u0C28\u0C4D \u0C28\u0C02\u0C2C\u0C30\u0C4D *', enterPhone: '10-\u0C05\u0C02\u0C15\u0C46\u0C32 \u0C2B\u0C4B\u0C28\u0C4D \u0C28\u0C02\u0C2C\u0C30\u0C4D',
        tableLabel: '\u0C1F\u0C47\u0C2C\u0C41\u0C32\u0C4D \u0C28\u0C02\u0C2C\u0C30\u0C4D (\u0C10\u0C1A\u0C4D\u0C1B\u0C3F\u0C15\u0C02)', enterTable: '\u0C09\u0C26\u0C3E: 5',
        notesLabel: '\u0C2A\u0C4D\u0C30\u0C24\u0C4D\u0C2F\u0C47\u0C15 \u0C38\u0C42\u0C1A\u0C28\u0C32\u0C41 (\u0C10\u0C1A\u0C4D\u0C1B\u0C3F\u0C15\u0C02)',
        enterNotes: '\u0C05\u0C32\u0C30\u0C4D\u0C1C\u0C40\u0C32\u0C41, \u0C07\u0C37\u0C4D\u0C1F\u0C3E\u0C32\u0C41...',
        payNow: '\u0C1A\u0C46\u0C32\u0C4D\u0C32\u0C3F\u0C02\u0C1A\u0C02\u0C21\u0C3F', payAtCounter: '\u0C15\u0C4C\u0C02\u0C1F\u0C30\u0C4D \u0C35\u0C26\u0C4D\u0C26 \u0C1A\u0C46\u0C32\u0C4D\u0C32\u0C3F\u0C02\u0C1A\u0C02\u0C21\u0C3F', orText: '\u0C32\u0C47\u0C26\u0C3E',
        orderConfirmed: '\u0C06\u0C30\u0C4D\u0C21\u0C30\u0C4D \u0C15\u0C28\u0C4D\u0C2B\u0C30\u0C4D\u0C2E\u0C4D!',
        orderSentKitchen: '\u0C2E\u0C40 \u0C06\u0C30\u0C4D\u0C21\u0C30\u0C4D \u0C35\u0C02\u0C1F\u0C17\u0C26\u0C3F\u0C15\u0C3F \u0C2A\u0C02\u0C2A\u0C2C\u0C21\u0C3F\u0C02\u0C26\u0C3F.<br>\u0C15\u0C42\u0C30\u0C4D\u0C1A\u0C4A\u0C28\u0C3F \u0C30\u0C3F\u0C32\u0C3E\u0C15\u0C4D\u0C38\u0C4D \u0C05\u0C35\u0C4D\u0C35\u0C02\u0C21\u0C3F!',
        orderId: '\u0C06\u0C30\u0C4D\u0C21\u0C30\u0C4D ID', items: '\u0C10\u0C1F\u0C2E\u0C4D\u0C38\u0C4D', paymentLabel: '\u0C1A\u0C46\u0C32\u0C4D\u0C32\u0C3F\u0C02\u0C2A\u0C41',
        trackOrder: '\u0C2E\u0C40 \u0C06\u0C30\u0C4D\u0C21\u0C30\u0C4D \u0C1F\u0C4D\u0C30\u0C3E\u0C15\u0C4D \u0C1A\u0C47\u0C2F\u0C02\u0C21\u0C3F', newOrder: '\u0C15\u0C4A\u0C24\u0C4D\u0C24 \u0C06\u0C30\u0C4D\u0C21\u0C30\u0C4D \u0C07\u0C35\u0C4D\u0C35\u0C02\u0C21\u0C3F',
        placingOrder: '\u0C06\u0C30\u0C4D\u0C21\u0C30\u0C4D \u0C2A\u0C46\u0C1F\u0C4D\u0C1F\u0C2C\u0C21\u0C41\u0C24\u0C41\u0C02\u0C26\u0C3F...', loading: '\u0C2E\u0C46\u0C28\u0C42 \u0C32\u0C4B\u0C21\u0C4D \u0C05\u0C35\u0C41\u0C24\u0C41\u0C02\u0C26\u0C3F',
        autoReset: '{s}\u0C38\u0C46\u0C15\u0C28\u0C4D\u0C32\u0C32\u0C4B \u0C30\u0C40\u0C38\u0C46\u0C1F\u0C4D',
        itemsInCart: '\u0C15\u0C3E\u0C30\u0C4D\u0C1F\u0C4D\u0C32\u0C4B \u0C10\u0C1F\u0C2E\u0C4D\u0C38\u0C4D', oneItem: '1 \u0C10\u0C1F\u0C2E\u0C4D',
        addToOrder: '\u0C1C\u0C4B\u0C21\u0C3F\u0C02\u0C1A\u0C41',
        selectSpice: '\u0C2E\u0C38\u0C3E\u0C32\u0C3E \u0C38\u0C4D\u0C25\u0C3E\u0C2F\u0C3F \u0C0E\u0C02\u0C1A\u0C41\u0C15\u0C4B\u0C02\u0C21\u0C3F', skipDefault: '\u0C38\u0C4D\u0C15\u0C3F\u0C2A\u0C4D (\u0C2E\u0C40\u0C21\u0C3F\u0C2F\u0C02)',
        addExtras: '\u0C0E\u0C15\u0C4D\u0C38\u0C4D\u0C1F\u0C4D\u0C30\u0C3E\u0C32\u0C41 \u0C1C\u0C4B\u0C21\u0C3F\u0C02\u0C1A\u0C02\u0C21\u0C3F', addToCart: '\u0C15\u0C3E\u0C30\u0C4D\u0C1F\u0C4D\u0C32\u0C4B \u0C1C\u0C4B\u0C21\u0C3F\u0C02\u0C1A\u0C02\u0C21\u0C3F',
        needHelp: '\u0C38\u0C39\u0C3E\u0C2F\u0C02 \u0C15\u0C3E\u0C35\u0C3E\u0C32\u0C3E?', staffNotified: '\u0C38\u0C3F\u0C2C\u0C4D\u0C2C\u0C02\u0C26\u0C3F\u0C15\u0C3F \u0C24\u0C46\u0C32\u0C3F\u0C2F\u0C1C\u0C47\u0C36\u0C3E\u0C30\u0C41!',
        estimatedWait: '\u0C05\u0C02\u0C1A\u0C28\u0C3E \u0C35\u0C47\u0C1A\u0C3F \u0C09\u0C02\u0C21\u0C47 \u0C38\u0C2E\u0C2F\u0C02'
    }
};
var CAT_TR = {
    hi: {
        'All':'\u0938\u092D\u0940','Starters':'\u0938\u094D\u091F\u093E\u0930\u094D\u091F\u0930\u094D\u0938',
        'Curries':'\u0915\u0930\u0940','Biryanis':'\u092C\u093F\u0930\u092F\u093E\u0928\u0940',
        'Kebabs':'\u0915\u092C\u093E\u092C','Noodles':'\u0928\u0942\u0921\u0932\u094D\u0938',
        'Fried Rice':'\u092B\u094D\u0930\u093E\u0907\u0921 \u0930\u093E\u0907\u0938','Breads':'\u0930\u094B\u091F\u0940',
        'Beverages':'\u092A\u0947\u092F'
    },
    te: {
        'All':'\u0C05\u0C28\u0C4D\u0C28\u0C40','Starters':'\u0C38\u0C4D\u0C1F\u0C3E\u0C30\u0C4D\u0C1F\u0C30\u0C4D\u0C38\u0C4D',
        'Curries':'\u0C15\u0C30\u0C4D\u0C30\u0C40\u0C32\u0C41','Biryanis':'\u0C2C\u0C3F\u0C30\u0C4D\u0C2F\u0C3E\u0C28\u0C40\u0C32\u0C41',
        'Kebabs':'\u0C15\u0C2C\u0C3E\u0C2C\u0C4D\u0C38\u0C4D','Noodles':'\u0C28\u0C42\u0C21\u0C41\u0C32\u0C4D\u0C38\u0C4D',
        'Fried Rice':'\u0C2B\u0C4D\u0C30\u0C48\u0C21\u0C4D \u0C30\u0C48\u0C38\u0C4D','Breads':'\u0C30\u0C4B\u0C1F\u0C40\u0C32\u0C41',
        'Beverages':'\u0C2A\u0C3E\u0C28\u0C40\u0C2F\u0C3E\u0C32\u0C41'
    }
};

var currentLang = 'en';
function setLang(lang) {
    currentLang = lang;
    var langMap = {'en':'EN','te':'\u0C24\u0C46\u0C32\u0C41\u0C17\u0C41','hi':'\u0939\u093F\u0902\u0926\u0940'};
    document.querySelectorAll('.lang-btn').forEach(function(b) {
        b.classList.toggle('active', b.textContent.trim() === langMap[lang]);
    });
    document.querySelectorAll('[data-i18n]').forEach(function(el) {
        var key = el.getAttribute('data-i18n');
        if (TR[lang] && TR[lang][key]) el.innerHTML = TR[lang][key];
    });
    document.querySelectorAll('[data-i18n-placeholder]').forEach(function(el) {
        var key = el.getAttribute('data-i18n-placeholder');
        if (TR[lang] && TR[lang][key]) el.placeholder = TR[lang][key];
    });
    renderCatTabs(); renderCatSidebar(); renderMenu(); updateCartBar(); updatePayBtn(); renderFeatured();
}
function t(key) { return (TR[currentLang] && TR[currentLang][key]) || TR.en[key] || key; }
function catName(cat) { return (currentLang !== 'en' && CAT_TR[currentLang] && CAT_TR[currentLang][cat]) || cat; }

// ── Menu Data ──────────────────────────────────────────────────
var menu = [];
var menuLoaded = false;
var catMap = {'Noodles':'Noodles','Fried Rice':'Fried Rice','Rotis & Naan':'Breads','Kebabs & Grill':'Kebabs','Noodles & Fried Rice':'Noodles'};

function loadMenuFromFirestore() {
    if (typeof db === 'undefined') { useFallbackMenu(); return; }
    db.collection('menu').onSnapshot(function(snapshot) {
        menu = [];
        snapshot.forEach(function(doc) {
            var d = doc.data();
            if (!d.available) return;
            menu.push({ name: d.name, price: d.price, cat: catMap[d.category] || d.category,
                type: d.type === 'non-veg' ? 'nv' : 'veg', best: d.badge === 'Bestseller',
                chef: d.badge === "Chef's Pick", img: d.imageUrl || '', desc: d.description || '', badge: d.badge || '' });
        });
        categories = ['All'];
        menu.forEach(function(item) { if (categories.indexOf(item.cat) === -1) categories.push(item.cat); });
        menuLoaded = true;
        renderCatTabs(); renderCatSidebar(); renderMenu(); renderFeatured();
    }, function(err) { console.error('Menu error:', err); useFallbackMenu(); });
    setTimeout(function() { if (!menuLoaded) useFallbackMenu(); }, 5000);
}

function useFallbackMenu() {
    if (menuLoaded) return;
    menu = [
        {name:'Veg Manchurian',price:169,cat:'Starters',type:'veg',best:false,img:''},
        {name:'Paneer 65',price:189,cat:'Starters',type:'veg',best:false,img:''},
        {name:'Chicken 65',price:200,cat:'Starters',type:'nv',best:true,img:''},
        {name:'Chicken Hot Wings',price:220,cat:'Starters',type:'nv',best:false,img:''},
        {name:'Veg Spring Rolls',price:149,cat:'Starters',type:'veg',best:false,img:''},
        {name:'Chicken Lollipop',price:230,cat:'Starters',type:'nv',best:false,img:''},
        {name:'Paneer Butter Masala',price:199,cat:'Curries',type:'veg',best:false,img:''},
        {name:'Dal Tadka',price:149,cat:'Curries',type:'veg',best:false,img:''},
        {name:'Butter Chicken',price:249,cat:'Curries',type:'nv',best:true,img:''},
        {name:'Chicken Curry',price:219,cat:'Curries',type:'nv',best:false,img:''},
        {name:'Mutton Curry',price:319,cat:'Curries',type:'nv',best:false,img:''},
        {name:'Gongura Chicken',price:239,cat:'Curries',type:'nv',best:false,img:''},
        {name:'Veg Dum Biryani',price:199,cat:'Biryanis',type:'veg',best:false,img:''},
        {name:'Chicken Dum Biryani',price:249,cat:'Biryanis',type:'nv',best:true,img:''},
        {name:'Chicken 65 Biryani',price:249,cat:'Biryanis',type:'nv',best:false,img:''},
        {name:'Mutton Dum Biryani',price:349,cat:'Biryanis',type:'nv',best:false,img:''},
        {name:'Egg Biryani',price:199,cat:'Biryanis',type:'nv',best:false,img:''},
        {name:'Paneer Biryani',price:229,cat:'Biryanis',type:'veg',best:false,img:''},
        {name:'Paneer Tikka',price:209,cat:'Kebabs',type:'veg',best:false,img:''},
        {name:'Chicken Seekh Kebab',price:229,cat:'Kebabs',type:'nv',best:false,img:''},
        {name:'Tandoori Chicken',price:269,cat:'Kebabs',type:'nv',best:false,img:''},
        {name:'Mutton Seekh Kebab',price:289,cat:'Kebabs',type:'nv',best:false,img:''},
        {name:'Veg Hakka Noodles',price:169,cat:'Noodles',type:'veg',best:false,img:''},
        {name:'Chicken Hakka Noodles',price:199,cat:'Noodles',type:'nv',best:false,img:''},
        {name:'Egg Noodles',price:179,cat:'Noodles',type:'nv',best:false,img:''},
        {name:'Schezwan Noodles',price:189,cat:'Noodles',type:'veg',best:false,img:''},
        {name:'Veg Fried Rice',price:169,cat:'Fried Rice',type:'veg',best:false,img:''},
        {name:'Chicken Fried Rice',price:199,cat:'Fried Rice',type:'nv',best:false,img:''},
        {name:'Egg Fried Rice',price:179,cat:'Fried Rice',type:'nv',best:false,img:''},
        {name:'Schezwan Fried Rice',price:189,cat:'Fried Rice',type:'veg',best:false,img:''},
        {name:'Butter Naan',price:40,cat:'Breads',type:'veg',best:false,img:''},
        {name:'Garlic Naan',price:50,cat:'Breads',type:'veg',best:false,img:''},
        {name:'Tandoori Roti',price:30,cat:'Breads',type:'veg',best:false,img:''},
        {name:'Butter Roti',price:35,cat:'Breads',type:'veg',best:false,img:''},
        {name:'Laccha Paratha',price:45,cat:'Breads',type:'veg',best:false,img:''},
        {name:'Tea',price:30,cat:'Beverages',type:'veg',best:false,img:''},
        {name:'Coffee',price:40,cat:'Beverages',type:'veg',best:false,img:''},
        {name:'Hot Chocolate',price:60,cat:'Beverages',type:'veg',best:false,img:''},
        {name:'Lassi',price:50,cat:'Beverages',type:'veg',best:false,img:''},
        {name:'Buttermilk',price:35,cat:'Beverages',type:'veg',best:false,img:''},
        {name:'Fresh Lime Soda',price:45,cat:'Beverages',type:'veg',best:false,img:''}
    ];
    categories = ['All'];
    menu.forEach(function(item) { if (categories.indexOf(item.cat) === -1) categories.push(item.cat); });
    menuLoaded = true;
    renderCatTabs(); renderCatSidebar(); renderMenu(); renderFeatured();
}
loadMenuFromFirestore();

// ── State ──────────────────────────────────────────────────────
var cart = [];
var activeFilter = 'all';
var activeCat = 'All';
var searchQuery = '';
var categories = ['All'];
var autoResetTimer = null;

// ── Helpers ────────────────────────────────────────────────────
function haptic() { if (navigator.vibrate) navigator.vibrate(10); }
function debounce(fn, ms) { var t; return function() { var a=arguments,c=this; clearTimeout(t); t=setTimeout(function(){fn.apply(c,a)},ms); }; }
function showToast(msg) {
    var el = document.getElementById('toast');
    el.textContent = msg; el.classList.add('show');
    setTimeout(function() { el.classList.remove('show'); }, 2500);
}

// ── Touch Ripple ───────────────────────────────────────────────
function createRipple(e, el) {
    var rect = el.getBoundingClientRect();
    var rip = document.createElement('span');
    rip.className = 'touch-ripple';
    var size = Math.max(rect.width, rect.height);
    rip.style.width = rip.style.height = size + 'px';
    var x = (e.touches ? e.touches[0].clientX : e.clientX) - rect.left - size/2;
    var y = (e.touches ? e.touches[0].clientY : e.clientY) - rect.top - size/2;
    rip.style.left = x + 'px'; rip.style.top = y + 'px';
    el.style.position = el.style.position || 'relative';
    el.appendChild(rip);
    setTimeout(function() { rip.remove(); }, 500);
}
document.addEventListener('touchstart', function(e) {
    var card = e.target.closest('.item-card,.filter-chip,.cat-tab,.cat-item');
    if (card) createRipple(e, card);
}, { passive: true });

// ── Featured Banner ────────────────────────────────────────────
function renderFeatured() {
    var bestsellers = menu.filter(function(i) { return i.best; });
    if (bestsellers.length < 2) { document.getElementById('featured-strip').style.display = 'none'; return; }
    document.getElementById('featured-strip').style.display = '';
    var html = '';
    // Duplicate for seamless loop
    var items = bestsellers.concat(bestsellers);
    items.forEach(function(item) {
        html += '<div class="featured-item" onclick="scrollToItem(\'' + escHtml(item.name).replace(/'/g,"&#039;") + '\')">';
        html += '<span class="featured-star">\u2605</span>';
        html += '<span class="featured-name">' + escHtml(item.name) + '</span>';
        html += '<span class="featured-price">\u20B9' + item.price + '</span>';
        html += '</div>';
    });
    document.getElementById('featured-track').innerHTML = html;
}
function scrollToItem(name) {
    // Set category to All and scroll to the item
    activeCat = 'All'; activeFilter = 'all'; searchQuery = '';
    document.getElementById('search-input').value = '';
    document.querySelectorAll('.filter-chip').forEach(function(c,i) { c.classList.toggle('active', i === 0); });
    renderCatTabs(); renderCatSidebar(); renderMenu();
    // Find the card with this name
    setTimeout(function() {
        var cards = document.querySelectorAll('.item-card');
        for (var i = 0; i < cards.length; i++) {
            if (cards[i].querySelector('.item-name') && cards[i].querySelector('.item-name').textContent.indexOf(name) !== -1) {
                var headerH = document.querySelector('.header').offsetHeight;
                var top = cards[i].getBoundingClientRect().top + window.scrollY - headerH - 20;
                window.scrollTo({ top: top, behavior: 'smooth' });
                cards[i].style.boxShadow = '0 0 30px rgba(212,160,23,.2),0 0 60px rgba(212,160,23,.08)';
                setTimeout(function() { cards[i].style.boxShadow = ''; }, 1500);
                break;
            }
        }
    }, 100);
}

// ── Category counts ────────────────────────────────────────────
function getCatCount(cat) {
    return menu.filter(function(item) {
        if (cat !== 'All' && item.cat !== cat) return false;
        if (activeFilter === 'veg' && item.type !== 'veg') return false;
        if (activeFilter === 'nv' && item.type !== 'nv') return false;
        if (activeFilter === 'popular' && !item.popular && !item.best) return false;
        if (activeFilter === 'chef' && !item.chef) return false;
        return true;
    }).length;
}

// ── Render Categories ──────────────────────────────────────────
function renderCatTabs() {
    var html = '';
    categories.forEach(function(cat) {
        var count = getCatCount(cat);
        html += '<div class="cat-tab' + (cat === activeCat ? ' active' : '') +
                '" onclick="setCat(\'' + escHtml(cat) + '\',this)">' +
                escHtml(catName(cat)) + ' <span class="ct-count">(' + count + ')</span></div>';
    });
    document.getElementById('cat-tabs').innerHTML = html;
}
function renderCatSidebar() {
    var html = '';
    categories.forEach(function(cat) {
        var count = getCatCount(cat);
        html += '<button class="cat-item' + (cat === activeCat ? ' active' : '') +
                '" onclick="setCat(\'' + escHtml(cat) + '\',this)">' +
                escHtml(catName(cat)) + '<span class="cat-count">' + count + '</span></button>';
    });
    document.getElementById('cat-sidebar').innerHTML = html;
}
function setCat(cat, el) {
    haptic(); activeCat = cat;
    renderCatTabs(); renderCatSidebar(); renderMenu();
    if (cat !== 'All') {
        var secId = 'sec-' + cat.replace(/\s/g, '-');
        var sec = document.getElementById(secId);
        if (sec) {
            var headerH = document.querySelector('.header').offsetHeight;
            window.scrollTo({ top: sec.getBoundingClientRect().top + window.scrollY - headerH - 20, behavior: 'smooth' });
        }
    } else { window.scrollTo({ top: 0, behavior: 'smooth' }); }
}
function setFilter(f, el) {
    haptic(); activeFilter = f;
    document.querySelectorAll('.filter-chip').forEach(function(c) { c.classList.remove('active'); });
    if (el) el.classList.add('active');
    renderCatTabs(); renderCatSidebar(); renderMenu();
}

// ── Search ─────────────────────────────────────────────────────
var debouncedRender = debounce(function() { renderCatTabs(); renderCatSidebar(); renderMenu(); }, 200);
document.getElementById('search-input').addEventListener('input', function(e) {
    searchQuery = e.target.value.trim().toLowerCase(); debouncedRender();
});

function getFilteredItems() {
    return menu.filter(function(item) {
        if (activeFilter === 'veg' && item.type !== 'veg') return false;
        if (activeFilter === 'nv' && item.type !== 'nv') return false;
        if (activeFilter === 'popular' && !item.popular && !item.best) return false;
        if (activeFilter === 'chef' && !item.chef) return false;
        if (activeCat !== 'All' && item.cat !== activeCat) return false;
        if (searchQuery && item.name.toLowerCase().indexOf(searchQuery) === -1) return false;
        return true;
    });
}

// ── Cart ───────────────────────────────────────────────────────
function getCartQty(name) { var total = 0; cart.forEach(function(c) { if (c.name === name) total += c.qty; }); return total; }

// Spice/addon flow state
var pendingItem = null;
var pendingSpice = 'medium';
var selectedAddons = [];
var cachedAddons = [];
var addonCacheTime = 0;

function addToCart(name, price, btnEl) {
    haptic(); resetIdleTimer();
    pendingItem = { name: name, price: price, btnEl: btnEl };
    selectedAddons = [];
    document.getElementById('spice-item-name').textContent = name;
    document.querySelectorAll('.spice-opt').forEach(function(o) { o.classList.remove('selected'); });
    document.getElementById('spice-overlay').classList.add('open');
}
function closeSpicePicker() {
    document.getElementById('spice-overlay').classList.remove('open');
    pendingItem = null;
}
function pickSpice(level) {
    haptic();
    pendingSpice = level;
    document.getElementById('spice-overlay').classList.remove('open');
    showAddonPicker();
}
function showAddonPicker() {
    selectedAddons = [];
    var list = document.getElementById('addon-list');
    if (cachedAddons.length === 0) { finalizeCartAdd(); return; }
    var html = '';
    cachedAddons.forEach(function(a, i) {
        html += '<div class="addon-item" onclick="toggleAddon(' + i + ',this)">';
        html += '<div class="addon-check" id="addon-chk-' + i + '"></div>';
        html += '<div class="addon-info"><div class="addon-name">' + escHtml(a.name) + '</div>';
        if (a.category) html += '<div class="addon-cat">' + escHtml(a.category) + '</div>';
        html += '</div><div class="addon-price">+\u20B9' + a.price + '</div></div>';
    });
    list.innerHTML = html || '<div class="addon-none">No extras available</div>';
    updateAddonTotal();
    document.getElementById('addon-overlay').classList.add('open');
}
function toggleAddon(idx) {
    haptic();
    var chk = document.getElementById('addon-chk-' + idx);
    var a = cachedAddons[idx];
    var pos = -1;
    selectedAddons.forEach(function(s, i) { if (s.name === a.name) pos = i; });
    if (pos >= 0) { selectedAddons.splice(pos, 1); chk.classList.remove('checked'); }
    else { selectedAddons.push({ name: a.name, price: a.price }); chk.classList.add('checked'); }
    updateAddonTotal();
}
function updateAddonTotal() {
    var sum = 0; selectedAddons.forEach(function(a) { sum += a.price; });
    document.getElementById('addon-total-badge').textContent = '+\u20B9' + sum;
}
function confirmAddons() {
    document.getElementById('addon-overlay').classList.remove('open');
    finalizeCartAdd();
}
function finalizeCartAdd() {
    if (!pendingItem) return;
    var addonTotal = 0; selectedAddons.forEach(function(a) { addonTotal += a.price; });
    var cartKey = pendingItem.name + '|' + pendingSpice + '|' + selectedAddons.map(function(a){return a.name}).sort().join(',');
    var f = cart.find(function(c) { return c.key === cartKey; });
    if (f) { f.qty++; }
    else { cart.push({ key: cartKey, name: pendingItem.name, price: pendingItem.price, qty: 1, spice: pendingSpice, addons: selectedAddons.slice(), addonTotal: addonTotal }); }
    triggerFlyAnim(pendingItem.btnEl);
    renderMenu(); updateCartBar();
    var bar = document.getElementById('cart-bar');
    bar.classList.remove('bounce'); void bar.offsetWidth; bar.classList.add('bounce');
    showPairings(pendingItem.name);
    pendingItem = null;
}
function changeQty(name, delta) {
    var f = cart.find(function(c) { return c.name === name; });
    if (!f) return; f.qty += delta;
    if (f.qty <= 0) { cart = cart.filter(function(c) { return c !== f; }); }
    haptic(); renderMenu(); updateCartBar();
}
// Load addons from Firestore
function loadAddons() {
    if (Date.now() - addonCacheTime < 600000 && cachedAddons.length > 0) return;
    var cached = null;
    try { cached = JSON.parse(localStorage.getItem('kiosk_addons')); } catch(e) {}
    if (cached && cached.ts && Date.now() - cached.ts < 600000) {
        cachedAddons = cached.data; addonCacheTime = cached.ts; return;
    }
    if (typeof db === 'undefined') return;
    db.collection('addons').get().then(function(snap) {
        cachedAddons = [];
        snap.forEach(function(doc) { var d = doc.data(); if (d.name && d.price) cachedAddons.push({ name: d.name, price: d.price, category: d.category || '' }); });
        addonCacheTime = Date.now();
        try { localStorage.setItem('kiosk_addons', JSON.stringify({ data: cachedAddons, ts: addonCacheTime })); } catch(e) {}
    }).catch(function(e) { console.error('Addons load error:', e); });
}
function triggerFlyAnim(btnEl) {
    if (!btnEl) return;
    var rect = btnEl.getBoundingClientRect();
    var el = document.createElement('div');
    el.className = 'fly-anim'; el.textContent = '+1';
    el.style.cssText = 'left:' + (rect.left + rect.width/2 - 10) + 'px;top:' + rect.top + 'px;';
    document.body.appendChild(el);
    setTimeout(function() { el.remove(); }, 650);
}
function updateCartBar() {
    var count = 0, total = 0;
    cart.forEach(function(c) { count += c.qty; total += (c.price + (c.addonTotal || 0)) * c.qty; });
    document.getElementById('bar-count').textContent = count;
    document.getElementById('bar-total').textContent = '\u20B9' + total;
    document.getElementById('bar-label').textContent = count === 1 ? t('oneItem') : count + ' ' + t('itemsInCart');
    var bar = document.getElementById('cart-bar');
    if (count > 0) { bar.classList.add('visible'); } else { bar.classList.remove('visible'); }
}
function updatePayBtn() {
    var total = 0; cart.forEach(function(c) { total += (c.price + (c.addonTotal || 0)) * c.qty; });
    // Apply loyalty discount if active
    if (loyaltyRedeemActive && loyaltyRedeemAmount > 0) total = Math.max(0, total - loyaltyRedeemAmount);
    document.getElementById('pay-btn').textContent = t('payNow') + ' \u20B9' + total;
}

// ── Render Menu Grid ───────────────────────────────────────────
var catOrder = ['Starters','Curries','Biryanis','Kebabs','Noodles','Fried Rice','Breads','Beverages'];
var placeholderSvg = '<svg viewBox="0 0 24 24" fill="none" stroke-width="1.2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="2" width="20" height="20" rx="3"/><circle cx="8.5" cy="8.5" r="1.5"/><path d="m21 15-5-5L5 21"/></svg>';

function renderMenu() {
    var items = getFilteredItems();
    var container = document.getElementById('menu-container');
    var noRes = document.getElementById('no-results');
    if (items.length === 0) { container.innerHTML = ''; noRes.classList.remove('hidden'); return; }
    noRes.classList.add('hidden');

    var grouped = {};
    items.forEach(function(item) { if (!grouped[item.cat]) grouped[item.cat] = []; grouped[item.cat].push(item); });

    var html = '';
    catOrder.forEach(function(cat) {
        if (!grouped[cat]) return;
        html += '<div class="menu-section" id="sec-' + cat.replace(/\s/g, '-') + '">';
        html += '<div class="section-title">' + escHtml(catName(cat)) + '</div>';
        html += '<div class="item-grid">';
        grouped[cat].forEach(function(item) {
            var qty = getCartQty(item.name);
            var eName = escHtml(item.name).replace(/'/g, "&#039;");
            html += '<div class="item-card card-enter" onclick="openDetail(\'' + eName + '\')" style="cursor:pointer">';
            html += '<div class="item-img-wrap">';
            if (item.img) {
                html += '<img class="item-img" src="' + escHtml(item.img) + '" alt="' + eName + '" loading="lazy" onerror="this.style.display=\'none\';this.nextElementSibling.style.display=\'flex\'">';
                html += '<div class="item-img-placeholder" style="display:none">' + placeholderSvg + '</div>';
            } else {
                html += '<div class="item-img-placeholder">' + placeholderSvg + '</div>';
            }
            html += '</div><div class="item-body">';
            html += '<div class="item-type-badge"><span class="dot ' + item.type + '"></span><span>' + (item.type === 'veg' ? 'VEG' : 'NON-VEG') + '</span></div>';
            html += '<div class="item-name">' + escHtml(item.name);
            if (item.best) html += '<span class="bestseller-tag">Bestseller</span>';
            if (item.popular) html += '<span class="popular-tag">\uD83D\uDD25 Popular</span>';
            html += '</div>';
            // Rating stars
            var r = itemRatings[item.name];
            if (r && r.count > 0) {
                html += '<div class="item-rating"><span class="item-stars">' + getStarStr(r.avg) + '</span><span class="item-rating-count">(' + r.count + ')</span></div>';
            }
            html += '<div class="item-bottom">';
            html += '<div class="item-price">\u20B9' + item.price + '</div>';
            if (qty === 0) {
                html += '<button class="add-btn" onclick="event.stopPropagation();addToCart(\'' + eName + '\',' + item.price + ',this)">' + t('addToOrder') + '</button>';
            } else {
                html += '<div class="qty-ctrl" onclick="event.stopPropagation()"><button onclick="changeQty(\'' + eName + '\',-1)">&minus;</button><span>' + qty + '</span><button onclick="changeQty(\'' + eName + '\',1)">+</button></div>';
            }
            html += '</div></div></div>';
        });
        html += '</div></div>';
    });
    container.innerHTML = html;
    // Trigger staggered entrance
    observeCards();
}

// ── IntersectionObserver for card entrance ─────────────────────
var cardObserver = null;
function observeCards() {
    if (!('IntersectionObserver' in window)) {
        document.querySelectorAll('.card-enter').forEach(function(c) { c.classList.add('card-visible'); c.classList.remove('card-enter'); });
        return;
    }
    if (cardObserver) cardObserver.disconnect();
    cardObserver = new IntersectionObserver(function(entries) {
        entries.forEach(function(entry, i) {
            if (entry.isIntersecting) {
                var el = entry.target;
                var delay = Array.prototype.indexOf.call(el.parentElement.children, el) * 60;
                setTimeout(function() { el.classList.add('card-visible'); el.classList.remove('card-enter'); }, delay);
                cardObserver.unobserve(el);
            }
        });
    }, { threshold: 0.1, rootMargin: '40px' });
    document.querySelectorAll('.card-enter').forEach(function(c) { cardObserver.observe(c); });
}

// ── Checkout ───────────────────────────────────────────────────
function openCheckout() {
    if (cart.length === 0) return;
    var html = '', subtotal = 0;
    var spiceEmoji = { none:'', mild:'\uD83C\uDF36', medium:'\uD83C\uDF36\uD83C\uDF36', hot:'\uD83C\uDF36\uD83C\uDF36\uD83C\uDF36' };
    cart.forEach(function(c) {
        var itemTotal = (c.price + (c.addonTotal || 0)) * c.qty; subtotal += itemTotal;
        html += '<div class="co-item"><span class="co-item-name">' + escHtml(c.name);
        if (c.spice && c.spice !== 'none') html += ' <span class="co-item-spice">' + (spiceEmoji[c.spice] || '') + '</span>';
        if (c.addons && c.addons.length > 0) html += '<span class="co-item-addons">+ ' + c.addons.map(function(a){return escHtml(a.name)}).join(', ') + '</span>';
        html += '</span><span class="co-item-qty">x' + c.qty + '</span>';
        html += '<span class="co-item-price">\u20B9' + itemTotal + '</span></div>';
    });
    document.getElementById('co-items').innerHTML = html;
    document.getElementById('co-subtotal').textContent = '\u20B9' + subtotal;
    var finalTotal = subtotal;
    if (loyaltyRedeemActive && loyaltyRedeemAmount > 0) finalTotal = Math.max(0, finalTotal - loyaltyRedeemAmount);
    document.getElementById('co-total').textContent = '\u20B9' + finalTotal;
    updatePayBtn();
    document.getElementById('co-overlay').classList.add('open');
    document.getElementById('co-sheet').classList.add('open');
    document.body.style.overflow = 'hidden';
}
function closeCheckout() {
    document.getElementById('co-overlay').classList.remove('open');
    document.getElementById('co-sheet').classList.remove('open');
    document.body.style.overflow = '';
}

// ── Razorpay Payment ───────────────────────────────────────────
function initiatePayment() {
    var name = document.getElementById('co-name').value.trim();
    var phone = document.getElementById('co-phone').value.trim();
    if (!name) { showToast('Please enter your name'); return; }
    if (!phone || !/^\d{10}$/.test(phone)) { showToast('Please enter a valid 10-digit phone number'); return; }
    if (typeof Razorpay === 'undefined') { showToast('Payment gateway loading...'); return; }

    var total = 0; cart.forEach(function(c) { total += (c.price + (c.addonTotal || 0)) * c.qty; });
    if (loyaltyRedeemActive && loyaltyRedeemAmount > 0) total = Math.max(0, total - loyaltyRedeemAmount);
    var btn = document.getElementById('pay-btn'); btn.disabled = true;

    var rzp = new Razorpay({
        key: 'rzp_test_1DP5mmOlF5G5ag',
        amount: Math.round(total * 100), currency: 'INR',
        name: 'AMOGHA CAFE & RESTAURANT',
        description: 'Kiosk Order - Amogha Cafe',
        image: window.location.origin + '/amogha-logo.png',
        handler: function(r) { btn.disabled = false; placeOrderToFirestore('Razorpay', r.razorpay_payment_id, 'paid'); },
        prefill: { name: name, contact: phone, method: 'upi' },
        method: { upi: true, card: true, netbanking: true, wallet: true },
        config: { display: { blocks: { upi: { name: 'Pay via UPI', instruments: [{ method: 'upi', flows: ['qrcode','collect','intent'] }] } }, sequence: ['block.upi'], preferences: { show_default_blocks: true } } },
        notes: { items: cart.map(function(i) { return i.name + ' x' + i.qty; }).join(', '), orderType: 'kiosk' },
        theme: { color: '#D4A017', backdrop_color: 'rgba(8,6,4,0.85)' },
        modal: { ondismiss: function() { btn.disabled = false; } }
    });
    rzp.on('payment.failed', function(resp) { btn.disabled = false; showToast('Payment failed. Please try again.'); });
    rzp.open();
}

function placeOrderCOD() {
    var name = document.getElementById('co-name').value.trim();
    var phone = document.getElementById('co-phone').value.trim();
    if (!name) { showToast('Please enter your name'); return; }
    if (!phone || !/^\d{10}$/.test(phone)) { showToast('Please enter a valid 10-digit phone number'); return; }
    placeOrderToFirestore('Pay at Counter', null, 'cod-pending');
}

function placeOrderToFirestore(payMethod, paymentId, status) {
    var name = document.getElementById('co-name').value.trim();
    var phone = document.getElementById('co-phone').value.trim();
    var table = document.getElementById('co-table').value.trim();
    var notes = document.getElementById('co-notes').value.trim();
    document.getElementById('loader').classList.add('show');

    var subtotal = 0, count = 0;
    var orderItems = cart.map(function(c) {
        count += c.qty;
        var lineTotal = (c.price + (c.addonTotal || 0)) * c.qty;
        subtotal += lineTotal;
        var item = { name: c.name, qty: c.qty, price: c.price };
        if (c.spice && c.spice !== 'none') item.spiceLevel = c.spice;
        if (c.addons && c.addons.length > 0) item.addons = c.addons;
        if (c.addonTotal) item.addonTotal = c.addonTotal;
        return item;
    });

    var finalTotal = subtotal;
    if (loyaltyRedeemActive && loyaltyRedeemAmount > 0) {
        finalTotal = Math.max(0, finalTotal - loyaltyRedeemAmount);
    }

    var orderData = { customer: name, phone: phone, items: orderItems, subtotal: subtotal, total: finalTotal,
        orderType: 'kiosk', notes: notes, status: status, createdAt: new Date().toISOString(), payment: payMethod };
    if (table) orderData.tableNumber = table;
    if (paymentId) orderData.paymentId = paymentId;
    if (loyaltyRedeemActive && loyaltyRedeemAmount > 0) orderData.loyaltyDiscount = loyaltyRedeemAmount;

    var lastOrderPhone = phone;
    var lastOrderItems = orderItems.slice();

    db.collection('orders').add(orderData).then(function(docRef) {
        document.getElementById('loader').classList.remove('show');
        closeCheckout();
        if (isCapacitorApp) {
            document.getElementById('success-track').style.display = 'none';
        } else {
            document.getElementById('success-track').href = window.location.origin + '/track/index.html?id=' + docRef.id;
        }
        document.getElementById('soc-id').textContent = '#' + docRef.id.slice(-6).toUpperCase();
        document.getElementById('soc-items').textContent = count + (count === 1 ? ' item' : ' items');
        document.getElementById('soc-total').textContent = '\u20B9' + finalTotal;
        document.getElementById('soc-payment').textContent = payMethod;
        document.getElementById('success-screen').classList.add('show');
        document.body.style.overflow = 'hidden';
        launchConfetti();
        // Store order ID for feedback
        lastKioskOrderId = docRef.id;
        resetKioskFeedback();
        // Show wait time
        estimateWaitTime();
        // Show WhatsApp button
        showWhatsAppBtn(docRef.id, lastOrderPhone, lastOrderItems, finalTotal, payMethod);
        // Award loyalty points
        awardPoints(lastOrderPhone, finalTotal);
        cart = []; loyaltyRedeemActive = false; loyaltyRedeemAmount = 0;
        updateCartBar(); renderMenu();
        startAutoReset();
    }).catch(function(err) {
        document.getElementById('loader').classList.remove('show');
        if (isCapacitorApp) {
            // Queue order for retry when back online
            var queue = JSON.parse(localStorage.getItem('kiosk_order_queue') || '[]');
            queue.push(orderData);
            localStorage.setItem('kiosk_order_queue', JSON.stringify(queue));
            showToast('Order saved — will sync when online.');
            closeCheckout();
            document.getElementById('success-screen').classList.add('show');
            cart = []; updateCartBar(); renderMenu(); startAutoReset();
        } else {
            showToast('Failed to place order. Please try again.');
        }
        console.error('Order error:', err);
    });
}

// Retry queued offline orders (Capacitor only)
if (isCapacitorApp) {
    setInterval(function() {
        var queue = JSON.parse(localStorage.getItem('kiosk_order_queue') || '[]');
        if (queue.length === 0) return;
        db.collection('orders').add(queue[0]).then(function() {
            queue.shift();
            localStorage.setItem('kiosk_order_queue', JSON.stringify(queue));
        }).catch(function() {});
    }, 30000);
}

// ── Confetti ───────────────────────────────────────────────────
function launchConfetti() {
    var canvas = document.getElementById('confetti-canvas');
    if (!canvas) return;
    var ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth; canvas.height = window.innerHeight;
    var particles = [];
    var colors = ['#D4A017','#F5D76E','#B8860B','#ffe6a0','#ede2d2','#27ae60','#e74c3c','#fff'];

    for (var i = 0; i < 60; i++) {
        particles.push({
            x: canvas.width / 2 + (Math.random() - .5) * 100,
            y: canvas.height / 2,
            vx: (Math.random() - .5) * 16,
            vy: (Math.random() - 1) * 18 - 4,
            w: Math.random() * 8 + 4,
            h: Math.random() * 6 + 3,
            color: colors[Math.floor(Math.random() * colors.length)],
            rot: Math.random() * 360,
            rotV: (Math.random() - .5) * 12,
            gravity: .25 + Math.random() * .15,
            opacity: 1
        });
    }
    var frame = 0;
    function animate() {
        frame++;
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        var alive = false;
        particles.forEach(function(p) {
            p.x += p.vx; p.y += p.vy; p.vy += p.gravity;
            p.rot += p.rotV; p.vx *= .99;
            if (frame > 40) p.opacity -= .015;
            if (p.opacity <= 0) return;
            alive = true;
            ctx.save();
            ctx.translate(p.x, p.y);
            ctx.rotate(p.rot * Math.PI / 180);
            ctx.globalAlpha = Math.max(0, p.opacity);
            ctx.fillStyle = p.color;
            ctx.fillRect(-p.w / 2, -p.h / 2, p.w, p.h);
            ctx.restore();
        });
        if (alive && frame < 180) requestAnimationFrame(animate);
        else ctx.clearRect(0, 0, canvas.width, canvas.height);
    }
    requestAnimationFrame(animate);
}

// ── Auto-Reset ─────────────────────────────────────────────────
function startAutoReset() {
    var s = 60;
    var el = document.getElementById('auto-reset-text');
    el.textContent = t('autoReset').replace('{s}', s);
    if (autoResetTimer) clearInterval(autoResetTimer);
    autoResetTimer = setInterval(function() {
        s--; el.textContent = t('autoReset').replace('{s}', s);
        if (s <= 0) { clearInterval(autoResetTimer); autoResetTimer = null; resetOrder(); }
    }, 1000);
}
function resetOrder() {
    if (autoResetTimer) { clearInterval(autoResetTimer); autoResetTimer = null; }
    document.getElementById('success-screen').classList.remove('show');
    document.body.style.overflow = '';
    document.getElementById('co-name').value = '';
    document.getElementById('co-phone').value = '';
    document.getElementById('co-table').value = '';
    document.getElementById('co-notes').value = '';
    cart = []; loyaltyRedeemActive = false; loyaltyRedeemAmount = 0;
    document.getElementById('loyalty-bar').classList.remove('show');
    document.getElementById('recent-section').classList.remove('show');
    document.getElementById('wait-time-row').style.display = 'none';
    document.getElementById('whatsapp-btn').style.display = 'none';
    // Reset feedback state
    resetKioskFeedback();
    updateCartBar(); renderMenu();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// ── Kiosk Feedback ─────────────────────────────────────────────
var kioskFeedbackRating = 0;
var lastKioskOrderId = null;

function selectFeedbackRating(rating) {
    kioskFeedbackRating = rating;
    var emojis = document.querySelectorAll('.kiosk-feedback-emoji');
    emojis.forEach(function(el) {
        var r = parseInt(el.getAttribute('data-rating'));
        if (r === rating) {
            el.classList.add('selected');
        } else {
            el.classList.remove('selected');
        }
    });
    var submitBtn = document.getElementById('feedback-submit-btn');
    if (submitBtn) submitBtn.disabled = false;
}

function submitKioskFeedback() {
    if (kioskFeedbackRating === 0) return;
    var comment = document.getElementById('feedback-comment').value.trim();
    var submitBtn = document.getElementById('feedback-submit-btn');
    if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = 'Submitting...'; }

    var reviewData = {
        rating: kioskFeedbackRating,
        comment: comment || '',
        source: 'kiosk',
        createdAt: new Date().toISOString(),
        orderId: lastKioskOrderId || null
    };

    if (typeof db !== 'undefined' && db) {
        db.collection('reviews').add(reviewData).then(function() {
            showFeedbackThanks();
        }).catch(function(err) {
            console.error('Feedback save error:', err);
            showFeedbackThanks();
        });
    } else {
        showFeedbackThanks();
    }
}

function showFeedbackThanks() {
    var feedbackSection = document.getElementById('kiosk-feedback');
    var thanksSection = document.getElementById('kiosk-feedback-thanks');
    if (feedbackSection) feedbackSection.style.display = 'none';
    if (thanksSection) thanksSection.style.display = 'block';
    // Auto-reset after 3 seconds
    setTimeout(function() {
        resetOrder();
    }, 3000);
}

function resetKioskFeedback() {
    kioskFeedbackRating = 0;
    var feedbackSection = document.getElementById('kiosk-feedback');
    var thanksSection = document.getElementById('kiosk-feedback-thanks');
    var submitBtn = document.getElementById('feedback-submit-btn');
    var comment = document.getElementById('feedback-comment');
    if (feedbackSection) feedbackSection.style.display = '';
    if (thanksSection) thanksSection.style.display = 'none';
    if (submitBtn) { submitBtn.disabled = true; submitBtn.textContent = 'Submit Feedback'; }
    if (comment) comment.value = '';
    var emojis = document.querySelectorAll('.kiosk-feedback-emoji');
    emojis.forEach(function(el) { el.classList.remove('selected'); });
}

// ── Fullscreen ─────────────────────────────────────────────────
function toggleFullscreen() {
    if (!document.fullscreenElement && !document.webkitFullscreenElement) {
        var el = document.documentElement;
        if (el.requestFullscreen) el.requestFullscreen();
        else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
    } else {
        if (document.exitFullscreen) document.exitFullscreen();
        else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
    }
}

// ── Prevent double-tap zoom ────────────────────────────────────
document.addEventListener('touchend', function(e) {
    if (e.target.closest('.add-btn,.qty-ctrl button,.cat-tab,.cat-item,.filter-chip,.cart-btn,.pay-btn,.cod-btn,.success-new-order,.lang-btn,.fs-btn,.featured-item,.mode-btn,.mic-btn,.staff-call-btn,.spice-opt,.spice-skip,.addon-item,.addon-confirm,.pairing-chip,.detail-add-btn,.detail-close,.whatsapp-btn,.table-qr-btn,.reorder-btn,.recent-chip,.voice-cancel,.kiosk-feedback-emoji,.kiosk-feedback-submit')) {
        e.preventDefault(); e.target.click();
    }
}, { passive: false });

// ── Preloader ──────────────────────────────────────────────────
window.addEventListener('load', function() {
    setTimeout(function() {
        var pre = document.getElementById('preloader');
        if (pre) pre.classList.add('done');
        setTimeout(function() { if (pre) pre.remove(); }, 700);
    }, 1200);
});

// ── ITEM PAIRINGS ─────────────────────────────────────────────
var ITEM_PAIRINGS = {
    'Chicken Dum Biryani': ['Raita', 'Mirchi ka Salan', 'Buttermilk'],
    'Chicken 65 Biryani': ['Raita', 'Mirchi ka Salan', 'Fresh Lime Soda'],
    'Veg Dum Biryani': ['Raita', 'Dal Tadka', 'Lassi'],
    'Mutton Dum Biryani': ['Raita', 'Mirchi ka Salan', 'Buttermilk'],
    'Egg Biryani': ['Raita', 'Buttermilk'],
    'Paneer Biryani': ['Raita', 'Dal Tadka'],
    'Butter Chicken': ['Butter Naan', 'Garlic Naan', 'Laccha Paratha'],
    'Paneer Butter Masala': ['Butter Naan', 'Garlic Naan', 'Tandoori Roti'],
    'Chicken Curry': ['Butter Naan', 'Butter Roti', 'Veg Fried Rice'],
    'Mutton Curry': ['Butter Naan', 'Laccha Paratha'],
    'Dal Tadka': ['Butter Naan', 'Tandoori Roti', 'Veg Fried Rice'],
    'Chicken 65': ['Chicken Dum Biryani', 'Fresh Lime Soda'],
    'Paneer 65': ['Veg Dum Biryani', 'Lassi'],
    'Veg Manchurian': ['Veg Hakka Noodles', 'Veg Fried Rice'],
    'Chicken Lollipop': ['Chicken Dum Biryani', 'Fresh Lime Soda'],
    'Veg Hakka Noodles': ['Veg Manchurian', 'Veg Spring Rolls'],
    'Chicken Hakka Noodles': ['Chicken 65', 'Fresh Lime Soda']
};
var pairingsTimer = null;
function showPairings(itemName) {
    var pairs = ITEM_PAIRINGS[itemName];
    if (!pairs || pairs.length === 0) return;
    var html = '';
    pairs.forEach(function(pName) {
        var mi = menu.find(function(m) { return m.name === pName; });
        if (!mi) return;
        html += '<div class="pairing-chip" onclick="addPairing(\'' + escHtml(pName).replace(/'/g,"&#039;") + '\',' + mi.price + ')">';
        html += '<span class="pairing-chip-name">' + escHtml(pName) + '</span>';
        html += '<span class="pairing-chip-price">\u20B9' + mi.price + '</span>';
        html += '<span class="pairing-chip-add">+</span></div>';
    });
    if (!html) return;
    document.getElementById('pairings-chips').innerHTML = html;
    document.getElementById('pairings-bar').classList.add('show');
    if (pairingsTimer) clearTimeout(pairingsTimer);
    pairingsTimer = setTimeout(function() { document.getElementById('pairings-bar').classList.remove('show'); }, 6000);
}
function addPairing(name, price) {
    haptic();
    var f = cart.find(function(c) { return c.name === name && c.spice === 'medium' && (!c.addons || c.addons.length === 0); });
    if (f) { f.qty++; }
    else { cart.push({ key: name + '|medium|', name: name, price: price, qty: 1, spice: 'medium', addons: [], addonTotal: 0 }); }
    renderMenu(); updateCartBar();
    showToast(name + ' added!');
    document.getElementById('pairings-bar').classList.remove('show');
}

// ── ITEM RATINGS ──────────────────────────────────────────────
var itemRatings = {};
function getStarStr(avg) {
    var full = Math.floor(avg); var half = avg - full >= 0.5;
    var s = ''; for (var i = 0; i < full; i++) s += '\u2605';
    if (half) s += '\u00BD'; return s + avg.toFixed(1);
}
function loadRatings() {
    var cached = null;
    try { cached = JSON.parse(localStorage.getItem('kiosk_ratings')); } catch(e) {}
    if (cached && cached.ts && Date.now() - cached.ts < 600000) {
        itemRatings = cached.data; return;
    }
    if (typeof db === 'undefined') return;
    db.collection('reviews').get().then(function(snap) {
        var agg = {};
        snap.forEach(function(doc) {
            var d = doc.data();
            if (!d.menuItem || !d.rating) return;
            if (!agg[d.menuItem]) agg[d.menuItem] = { sum: 0, count: 0 };
            agg[d.menuItem].sum += d.rating; agg[d.menuItem].count++;
        });
        for (var k in agg) { itemRatings[k] = { avg: agg[k].sum / agg[k].count, count: agg[k].count }; }
        try { localStorage.setItem('kiosk_ratings', JSON.stringify({ data: itemRatings, ts: Date.now() })); } catch(e) {}
        renderMenu();
    }).catch(function(e) { console.error('Ratings load error:', e); });
}

// ── SCREENSAVER (2min idle) ───────────────────────────────────
var idleTimer = null;
var IDLE_TIMEOUT = 120000;
function resetIdleTimer() {
    if (idleTimer) clearTimeout(idleTimer);
    idleTimer = setTimeout(showScreensaver, IDLE_TIMEOUT);
}
function showScreensaver() {
    if (document.getElementById('success-screen').classList.contains('show')) return;
    if (document.getElementById('co-sheet').classList.contains('open')) return;
    document.getElementById('screensaver').classList.add('show');
}
function dismissScreensaver() {
    document.getElementById('screensaver').classList.remove('show');
    resetIdleTimer();
}
['touchstart','mousedown','keydown','scroll'].forEach(function(evt) {
    document.addEventListener(evt, function() { resetIdleTimer(); }, { passive: true });
});
resetIdleTimer();

// ── VOICE ORDERING ────────────────────────────────────────────
var voiceRecognition = null;
function startVoiceOrder() {
    haptic();
    var SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    if (!SpeechRecognition) { showToast('Voice not supported on this device'); return; }
    voiceRecognition = new SpeechRecognition();
    voiceRecognition.lang = currentLang === 'hi' ? 'hi-IN' : currentLang === 'te' ? 'te-IN' : 'en-IN';
    voiceRecognition.interimResults = true;
    voiceRecognition.continuous = false;
    document.getElementById('voice-overlay').classList.add('show');
    document.getElementById('voice-text').textContent = 'Listening...';
    voiceRecognition.onresult = function(e) {
        var transcript = '';
        for (var i = e.resultIndex; i < e.results.length; i++) transcript += e.results[i][0].transcript;
        document.getElementById('voice-text').textContent = transcript;
        if (e.results[e.resultIndex].isFinal) { processVoiceCommand(transcript); }
    };
    voiceRecognition.onerror = function() { stopVoiceOrder(); showToast('Could not hear you. Try again.'); };
    voiceRecognition.onend = function() { document.getElementById('voice-overlay').classList.remove('show'); };
    voiceRecognition.start();
}
function stopVoiceOrder() {
    if (voiceRecognition) { voiceRecognition.abort(); voiceRecognition = null; }
    document.getElementById('voice-overlay').classList.remove('show');
}
function processVoiceCommand(text) {
    text = text.toLowerCase().trim();
    if (text.indexOf('checkout') !== -1 || text.indexOf('pay') !== -1 || text.indexOf('cart') !== -1) {
        stopVoiceOrder(); openCheckout(); return;
    }
    if (text.indexOf('clear') !== -1) {
        cart = []; updateCartBar(); renderMenu(); stopVoiceOrder(); showToast('Cart cleared'); return;
    }
    // Parse: "add 2 butter chicken" or "butter chicken"
    var qtyMatch = text.match(/(?:add\s+)?(\d+)\s+(.+)/i);
    var qty = 1, itemText = text.replace(/^add\s+/i, '');
    if (qtyMatch) { qty = parseInt(qtyMatch[1]) || 1; itemText = qtyMatch[2]; }
    // Fuzzy match
    var bestMatch = null, bestScore = 0;
    menu.forEach(function(m) {
        var mName = m.name.toLowerCase();
        var score = 0;
        var words = itemText.split(/\s+/);
        words.forEach(function(w) { if (mName.indexOf(w) !== -1) score += w.length; });
        if (score > bestScore) { bestScore = score; bestMatch = m; }
    });
    if (bestMatch && bestScore >= 3) {
        for (var v = 0; v < qty; v++) {
            var f = cart.find(function(c) { return c.name === bestMatch.name && c.spice === 'medium' && (!c.addons || c.addons.length === 0); });
            if (f) f.qty++; else cart.push({ key: bestMatch.name + '|medium|', name: bestMatch.name, price: bestMatch.price, qty: 1, spice: 'medium', addons: [], addonTotal: 0 });
        }
        renderMenu(); updateCartBar();
        showToast(qty + 'x ' + bestMatch.name + ' added!');
    } else {
        showToast('Could not find "' + itemText + '"');
    }
    stopVoiceOrder();
}

// ── LOYALTY SYSTEM ────────────────────────────────────────────
var LOYALTY_TIERS = [
    { name: 'Bronze', min: 0, color: '#cd7f32', icon: '\uD83E\uDD49' },
    { name: 'Silver', min: 500, color: '#c0c0c0', icon: '\uD83E\uDD48' },
    { name: 'Gold', min: 1000, color: '#D4A017', icon: '\uD83E\uDD47' }
];
var loyaltyRedeemActive = false;
var loyaltyRedeemAmount = 0;
var loyaltyUserData = null;

function getLoyaltyTier(points) {
    for (var i = LOYALTY_TIERS.length - 1; i >= 0; i--) {
        if (points >= LOYALTY_TIERS[i].min) return LOYALTY_TIERS[i];
    }
    return LOYALTY_TIERS[0];
}
function lookupLoyalty(phone) {
    if (!phone || phone.length !== 10 || typeof db === 'undefined') return;
    db.collection('users').doc(phone).get().then(function(doc) {
        if (!doc.exists) { document.getElementById('loyalty-bar').classList.remove('show'); return; }
        var d = doc.data();
        loyaltyUserData = d;
        var points = d.loyaltyPoints || 0;
        var tier = getLoyaltyTier(points);
        var redeemable = Math.floor(points / 100) * 10;
        document.getElementById('loyalty-tier-name').innerHTML = tier.icon + ' ' + tier.name;
        document.getElementById('loyalty-pts-text').textContent = points + ' pts';
        if (redeemable > 0) {
            document.getElementById('loyalty-redeem').style.display = 'flex';
            document.getElementById('loyalty-redeem-label').textContent = 'Redeem \u20B9' + redeemable + ' discount';
            loyaltyRedeemAmount = redeemable;
        } else {
            document.getElementById('loyalty-redeem').style.display = 'none';
        }
        document.getElementById('loyalty-bar').classList.add('show');
        // Also lookup recent orders
        lookupRecentOrders(phone);
    }).catch(function() {});
}
function toggleLoyaltyRedeem() {
    loyaltyRedeemActive = !loyaltyRedeemActive;
    var tog = document.getElementById('loyalty-redeem-toggle');
    tog.classList.toggle('on', loyaltyRedeemActive);
    openCheckout(); // Refresh totals
}
function awardPoints(phone, total) {
    if (!phone || phone.length !== 10 || typeof db === 'undefined') return;
    var points = Math.floor(total / 10);
    db.collection('users').doc(phone).set({
        loyaltyPoints: firebase.firestore.FieldValue.increment(points),
        lastOrder: new Date().toISOString()
    }, { merge: true }).catch(function() {});
}

// Phone input listener for loyalty lookup
document.getElementById('co-phone').addEventListener('input', debounce(function(e) {
    var phone = e.target.value.trim();
    if (phone.length === 10 && /^\d{10}$/.test(phone)) lookupLoyalty(phone);
}, 500));

// ── RECENTLY ORDERED ──────────────────────────────────────────
function lookupRecentOrders(phone) {
    if (typeof db === 'undefined') return;
    db.collection('orders').where('phone', '==', phone).orderBy('createdAt', 'desc').limit(3).get().then(function(snap) {
        if (snap.empty) { document.getElementById('recent-section').classList.remove('show'); return; }
        var itemSet = {};
        snap.forEach(function(doc) {
            var items = doc.data().items || [];
            items.forEach(function(i) { if (!itemSet[i.name]) itemSet[i.name] = i.price; });
        });
        var names = Object.keys(itemSet);
        if (names.length === 0) return;
        var html = '';
        names.slice(0, 8).forEach(function(n) {
            html += '<div class="recent-chip" onclick="addRecentItem(\'' + escHtml(n).replace(/'/g,"&#039;") + '\',' + itemSet[n] + ')">' + escHtml(n) + '</div>';
        });
        document.getElementById('recent-items').innerHTML = html;
        document.getElementById('recent-section').classList.add('show');
        // Store for reorder
        window._recentItems = names.map(function(n) { return { name: n, price: itemSet[n] }; });
    }).catch(function() {});
}
function addRecentItem(name, price) {
    haptic();
    var f = cart.find(function(c) { return c.name === name && c.spice === 'medium' && (!c.addons || c.addons.length === 0); });
    if (f) f.qty++; else cart.push({ key: name + '|medium|', name: name, price: price, qty: 1, spice: 'medium', addons: [], addonTotal: 0 });
    renderMenu(); updateCartBar(); openCheckout();
    showToast(name + ' added!');
}
function reorderAll() {
    if (!window._recentItems) return;
    haptic();
    window._recentItems.forEach(function(ri) {
        var f = cart.find(function(c) { return c.name === ri.name && c.spice === 'medium' && (!c.addons || c.addons.length === 0); });
        if (f) f.qty++; else cart.push({ key: ri.name + '|medium|', name: ri.name, price: ri.price, qty: 1, spice: 'medium', addons: [], addonTotal: 0 });
    });
    renderMenu(); updateCartBar(); openCheckout();
    showToast('Previous order added!');
}

// ── ESTIMATED WAIT TIME ───────────────────────────────────────
function estimateWaitTime() {
    if (typeof db === 'undefined') { showWaitTime(15); return; }
    var thirtyMinAgo = new Date(Date.now() - 30 * 60000).toISOString();
    db.collection('orders').where('status', 'in', ['pending', 'paid', 'preparing', 'cod-pending'])
      .where('createdAt', '>=', thirtyMinAgo).get().then(function(snap) {
        var ahead = snap.size;
        var mins = 10 + Math.min(ahead, 10) * 3;
        showWaitTime(mins);
    }).catch(function() { showWaitTime(15); });
}
function showWaitTime(mins) {
    document.getElementById('wait-time-mins').textContent = '~' + mins + ' min';
    document.getElementById('wait-time-row').style.display = 'flex';
}

// ── WHATSAPP RECEIPT ──────────────────────────────────────────
function showWhatsAppBtn(orderId, phone, items, total, payMethod) {
    if (!phone || isCapacitorApp) return;
    var msg = '*Amogha Cafe - Order Receipt*\n';
    msg += 'Order: #' + orderId.slice(-6).toUpperCase() + '\n\n';
    items.forEach(function(i) {
        msg += '\u2022 ' + i.name + ' x' + i.qty + ' - \u20B9' + (i.price * i.qty) + '\n';
    });
    msg += '\n*Total: \u20B9' + total + '*\n';
    msg += 'Payment: ' + payMethod + '\n\n';
    msg += 'Track: ' + window.location.origin + '/track/?id=' + orderId;
    var waUrl = 'https://wa.me/91' + phone + '?text=' + encodeURIComponent(msg);
    var btn = document.getElementById('whatsapp-btn');
    btn.href = waUrl; btn.style.display = 'inline-flex';
}

// ── STAFF CALL ────────────────────────────────────────────────
function callStaff() {
    haptic();
    var table = document.getElementById('co-table').value.trim() || 'N/A';
    if (typeof db === 'undefined') { showToast(t('staffNotified')); return; }
    db.collection('notifications').add({
        type: 'staff-call', table: table, source: 'kiosk',
        createdAt: new Date().toISOString(), read: false
    }).then(function() {
        showToast(t('staffNotified'));
    }).catch(function() {
        showToast(t('staffNotified'));
    });
}

// ── LIGHT/DARK MODE ───────────────────────────────────────────
function toggleLightMode() {
    haptic();
    document.body.classList.toggle('light-mode');
    var isLight = document.body.classList.contains('light-mode');
    document.getElementById('mode-toggle').innerHTML = isLight ? '&#9789;' : '&#9788;';
    try { localStorage.setItem('kiosk_light', isLight ? '1' : '0'); } catch(e) {}
}
// Restore light mode preference
try { if (localStorage.getItem('kiosk_light') === '1') { document.body.classList.add('light-mode'); document.getElementById('mode-toggle').innerHTML = '&#9789;'; } } catch(e) {}

// ── ACCESSIBILITY MODE ────────────────────────────────────────
function toggleAccessibility() {
    haptic();
    document.body.classList.toggle('large-font');
    var isLarge = document.body.classList.contains('large-font');
    document.getElementById('acc-toggle').style.background = isLarge ? 'var(--gold)' : '';
    document.getElementById('acc-toggle').style.color = isLarge ? '#080604' : '';
    try { localStorage.setItem('kiosk_largefont', isLarge ? '1' : '0'); } catch(e) {}
}
try { if (localStorage.getItem('kiosk_largefont') === '1') { document.body.classList.add('large-font'); var ab = document.getElementById('acc-toggle'); if(ab){ab.style.background='var(--gold)';ab.style.color='#080604';} } } catch(e) {}

// ── QR TABLE SCANNER ──────────────────────────────────────────
var qrStream = null;
function openQRScanner() {
    haptic();
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
        showToast('Camera not available on this device'); return;
    }
    document.getElementById('qr-overlay').classList.add('show');
    navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } }).then(function(stream) {
        qrStream = stream;
        var video = document.getElementById('qr-video');
        video.srcObject = stream;
        // Use BarcodeDetector if available
        if ('BarcodeDetector' in window) {
            var detector = new BarcodeDetector({ formats: ['qr_code'] });
            var scanInterval = setInterval(function() {
                if (!qrStream) { clearInterval(scanInterval); return; }
                detector.detect(video).then(function(barcodes) {
                    if (barcodes.length > 0) {
                        var val = barcodes[0].rawValue;
                        var tableNum = val.replace(/\D/g, '');
                        if (tableNum) {
                            document.getElementById('co-table').value = tableNum;
                            showToast('Table ' + tableNum + ' detected!');
                            closeQRScanner();
                            clearInterval(scanInterval);
                        }
                    }
                }).catch(function() {});
            }, 500);
        }
    }).catch(function() {
        showToast('Camera access denied');
        closeQRScanner();
    });
}
function closeQRScanner() {
    document.getElementById('qr-overlay').classList.remove('show');
    if (qrStream) { qrStream.getTracks().forEach(function(t) { t.stop(); }); qrStream = null; }
}

// ── DETAIL VIEW ───────────────────────────────────────────────
function openDetail(name) {
    var item = menu.find(function(m) { return m.name === name; });
    if (!item) return;
    var ov = document.getElementById('detail-overlay');
    document.getElementById('detail-name').textContent = item.name;
    document.getElementById('detail-price').textContent = '\u20B9' + item.price;
    var img = document.getElementById('detail-img');
    if (item.img) { img.src = item.img; img.style.display = ''; }
    else { img.src = ''; img.style.display = 'none'; }
    // Badge
    var badgeHtml = '<span class="dot ' + item.type + '" style="width:10px;height:10px;border-radius:50%;display:inline-block"></span> ';
    badgeHtml += '<span style="font-size:11px;color:var(--txt3);text-transform:uppercase">' + (item.type === 'veg' ? 'VEG' : 'NON-VEG') + '</span>';
    if (item.best) badgeHtml += ' <span class="bestseller-tag">Bestseller</span>';
    if (item.popular) badgeHtml += ' <span class="popular-tag">\uD83D\uDD25 Popular</span>';
    document.getElementById('detail-badge-row').innerHTML = badgeHtml;
    // Description
    document.getElementById('detail-desc').textContent = item.desc || 'A delicious ' + (item.type === 'veg' ? 'vegetarian' : 'non-vegetarian') + ' dish from our kitchen.';
    // Rating
    var r = itemRatings[item.name];
    if (r && r.count > 0) {
        document.getElementById('detail-rating').innerHTML = '<span class="stars">' + getStarStr(r.avg) + '</span><span class="count">(' + r.count + ' reviews)</span>';
    } else {
        document.getElementById('detail-rating').innerHTML = '';
    }
    // Add button
    var eName = escHtml(item.name).replace(/'/g, "&#039;");
    document.getElementById('detail-add-btn').onclick = function() { closeDetail(); addToCart(item.name, item.price, null); };
    ov.classList.add('open');
}
function closeDetail() {
    document.getElementById('detail-overlay').classList.remove('open');
}

// ── POPULAR BADGE ─────────────────────────────────────────────
function loadPopularItems() {
    // Mark items that have the 'Chef\'s Pick' badge or high order frequency
    menu.forEach(function(m) {
        if (m.best) m.popular = true;
        // Items with badge field from Firestore
    });
    // Also try to load recent order frequency
    if (typeof db === 'undefined') return;
    var twoHoursAgo = new Date(Date.now() - 2 * 3600000).toISOString();
    db.collection('orders').where('createdAt', '>=', twoHoursAgo).limit(50).get().then(function(snap) {
        var freq = {};
        snap.forEach(function(doc) {
            (doc.data().items || []).forEach(function(i) { freq[i.name] = (freq[i.name] || 0) + i.qty; });
        });
        // Top 5 most ordered
        var sorted = Object.keys(freq).sort(function(a, b) { return freq[b] - freq[a]; });
        sorted.slice(0, 5).forEach(function(n) {
            var mi = menu.find(function(m) { return m.name === n; });
            if (mi) mi.popular = true;
        });
        // Also mark chef items
        menu.forEach(function(m) { if (m.badge === "Chef's Pick") m.chef = true; });
        renderMenu();
    }).catch(function() {});
}

// ── Init ───────────────────────────────────────────────────────
updateCartBar();
loadAddons();
loadRatings();
setTimeout(loadPopularItems, 2000);
</script>

<!-- Service Worker -->
<script>
if ('serviceWorker' in navigator && !window.__SKIP_SW) {
    navigator.serviceWorker.register('./sw.js').then(function(reg) { reg.update(); });
}
</script>
</body>
</html>
